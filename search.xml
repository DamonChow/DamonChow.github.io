<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹æ¨¡æ¿æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2F2019%2F03%2F11%2Fdesign-pattern-template-method%2F</url>
    <content type="text"><![CDATA[æ¨¡æ¿æ–¹æ³•æ¨¡å¼Define the skeleton of an algorithm in an operation, deferring some steps to subclasses. Template method lets subclasses redefine certain steps of an algorithm without changing the algorithmâ€™s structure.ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼ŒæŠŠç®—æ³•çš„æ¡†æ¶å®šä¹‰å¥½ï¼Œå¯ä»¥å°†æŸäº›æ­¥æŠ½è±¡å‡ºæ¥æ”¾åˆ°å­ç±»å»å®ç°ã€‚æ¨¡æ¿æ–¹æ³•å…è®¸å­ç±»åœ¨ä¸æ”¹å˜ç®—æ³•æ¡†æ¶çš„æƒ…å†µä¸‹é‡æ–°å®ç°ç®—æ³•çš„æŸäº›æ­¥éª¤ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼UMLå›¾UMLå›¾ æŠ½è±¡ç±»AbstractClasså®šä¹‰äº†ç®—æ³•æ¡†æ¶templateMethod()æ–¹æ³•ï¼Œå…¶ä¸­æœ‰2ä¸ªæ–¹æ³•primitve1()å’Œprimitve2()è¢«æŠ½è±¡å‡ºæ¥ï¼Œå­ç±»SubClass1ç»§æ‰¿äº†æŠ½è±¡ç±»AbstractClassï¼Œä»è€Œå®ç°äº†primitve1()å’Œprimitve2()ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼è§’è‰²æŠ½è±¡ç±»(AbstractClass)ï¼š å®šä¹‰äº†ç®—æ³•æ ¸å¿ƒæ¡†æ¶ï¼ŒåŒæ—¶æŠŠå±€éƒ¨çš„ç®—æ³•è¡Œä¸ºå°è£…æˆæ­¥éª¤ï¼Œè®©å­ç±»å»å®ç°ã€‚ å­ç±»(SubClass): ç»§æ‰¿äº†æŠ½è±¡ç±»ï¼Œå®ç°æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“å®ç°äº†ç®—æ³•éƒ¨åˆ†é€»è¾‘ã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼æºç ç¤ºä¾‹æºç åœ°å€ï¼šTemplate-method æŠ½è±¡æ–¹æ³•å…ˆå®šä¹‰æŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»AbstractProcessorä¸­æ ¸å¿ƒç®—æ³•handleæ–¹æ³•ä¸­å¤§ä½“åˆ†3éƒ¨ï¼Œç¬¬ä¸€å…ˆæ ¡éªŒå‚æ•°å…·ä½“æ€ä¹ˆæ ¡éªŒæ”¾åœ¨å­ç±»ä¸­å®ç°ï¼Œç¬¬äºŒè·å–ç»“æœä¹Ÿæ”¾åœ¨å­ç±»å®ç°ï¼Œç¬¬ä¸‰è·å–ç»“æœåçš„æ“ä½œä¹Ÿæ”¾åœ¨å­ç±»å®ç°ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859@Slf4jpublic abstract class AbstractProcessor&lt;P extends Request, R extends Response&gt; &#123; /** * é€»è¾‘å¤„ç† * * @param request * @return */ public R handle(P request) &#123; // 1.æ ¡éªŒå‚æ•° log.info("å¼€å§‹å¤„ç†, è¯·æ±‚å‚æ•°=&#123;&#125;", request); validRequest(request); // 2.è·å–ç»“æœ R response = getResponse(request); log.info("è·å–ç»“æœ, å“åº”ç»“æœ=&#123;&#125;", response); // 3.ç»“æœä¹‹åçš„å¤„ç† afterHandle(response); return response; &#125; /** * ç»“æœä¹‹åçš„å¤„ç† å¯ä»¥æ›´æ–°å…¶ä»–ä¸šåŠ¡æˆ–è€…å¤„ç†ç¼“å­˜ * * @param response */ protected abstract void afterHandle(R response); /** * æ ¡éªŒè¯·æ±‚å‚æ•° * * @param request */ protected void validRequest(P request) &#123; if (Objects.isNull(request.getToken())) &#123; throw new RuntimeException("tokenä¸èƒ½ä¸ºç©º"); &#125; if (Objects.isNull(request.getVersion())) &#123; throw new RuntimeException("versionä¸èƒ½ä¸ºç©º"); &#125; validRequestParam(request); &#125; /** * æ ¡éªŒè¯·æ±‚çœŸæ­£çš„å‚æ•° * @param request */ protected abstract void validRequestParam(P request); /** * è·å–åˆ°ç»“æœ * @param request * @return */ protected abstract R getResponse(P request);&#125; RequestResponseåŸºæœ¬è¯·æ±‚ 12345678910@Data@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class Request &#123;â€‹ private String version;â€‹ private String token;&#125;åŸºæœ¬å“åº” 12345678910111213@Data@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class Response &#123;â€‹ private String msg;â€‹ private int code;â€‹ private boolean success;&#125; å­ç±»å®ç°OneProcessorOneRequestOneResponseç¬¬ä¸€ä¸ªå­ç±»å®ç° 12345678910111213141516171819202122232425262728@Slf4jpublic class OneProcessor extends AbstractProcessor&lt;OneRequest, OneResponse&gt; &#123;â€‹ public OneProcessor() &#123;â€‹ ProcessorFactory.putProcess(â€œtwoâ€, this);â€‹ &#125;â€‹ @Overrideâ€‹ protected void afterHandle(OneResponse response) &#123;â€‹ log.info(â€œå¤„ç†Oneç»“æœï¼š &#123;&#125;â€, response.getOne());â€‹ &#125;â€‹ @Overrideâ€‹ protected void validRequestParam(OneRequest request) &#123;â€‹ log.info(â€œæ ¡éªŒoneå‚æ•°â€¦çœç•¥â€¦â€¦â€);â€‹ &#125;â€‹ @Overrideâ€‹ protected OneResponse getResponse(OneRequest request) &#123;â€‹ String name = request.getName();â€‹ return OneResponse.builder()â€‹ .one(name + â€œoneâ€)â€‹ .success(true)â€‹ .code(0)â€‹ .msg(â€œæˆåŠŸâ€)â€‹ .build();â€‹ &#125;&#125;ç¬¬ä¸€ä¸ªå­ç±»çš„è¯·æ±‚ 12345678910111213@Data@ToString(callSuper = true)@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class OneRequest extends Request &#123;â€‹ private String name;â€‹ @Builder.Defaultâ€‹ private int a = 0;&#125;ç¬¬ä¸€ä¸ªå­ç±»çš„å“åº” 12345678910@Data@ToString(callSuper = true)@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class OneResponse extends Response &#123;â€‹ private String one;&#125; OneProcessorTwoRequestTwoResponseç¬¬äºŒä¸ªå­ç±»å®ç° 12345678910111213141516171819202122232425262728@Slf4jpublic class TwoProcessor extends AbstractProcessor&lt;TwoRequest, TwoResponse&gt; &#123;â€‹ public TwoProcessor() &#123;â€‹ ProcessorFactory.putProcess(â€œtwoâ€, this);â€‹ &#125;â€‹ @Overrideâ€‹ protected void afterHandle(TwoResponse response) &#123;â€‹ log.info(â€œå¤„ç†ç»“æœTWO, &#123;&#125;â€, response);â€‹ &#125;â€‹ @Overrideâ€‹ protected void validRequestParam(TwoRequest request) &#123;â€‹ log.info(â€œæ ¡éªŒTWOå‚æ•°â€¦çœç•¥â€¦â€¦â€);â€‹ &#125;â€‹ @Overrideâ€‹ protected TwoResponse getResponse(TwoRequest request) &#123;â€‹ Long id = request.getId();â€‹ return TwoResponse.builder()â€‹ .two(â€œidä¸ºâ€+id)â€‹ .success(true)â€‹ .code(0)â€‹ .msg(â€œæˆåŠŸâ€)â€‹ .build();â€‹ &#125;&#125;ç¬¬äºŒä¸ªå­ç±»çš„è¯·æ±‚ 123456789@Data@ToString(callSuper = true)@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class TwoRequest extends Request &#123;â€‹ private Long id;&#125;ç¬¬äºŒä¸ªå­ç±»çš„å“åº” 123456789@Data@ToString(callSuper = true)@SuperBuilder@NoArgsConstructor@AllArgsConstructorpublic class TwoResponse extends Response &#123;â€‹ private String two;&#125; æ‰©å±•ä¸ºå·¥å‚æœ‰çš„æ—¶å€™æˆ‘ä»¬å®šä¹‰çš„å­ç±»åœ¨Springå®¹å™¨çš„æ—¶å€™ç”±Springå®šä¹‰å¥½åï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥å€Ÿç”¨å·¥å‚æ¨¡å¼æ–¹æ³•ï¼Œåœ¨å­ç±»åˆå§‹åŒ–çš„æ—¶å€™å°±æŠŠå­ç±»æ”¾ç½®åœ¨ProcessorFactoryä¸­ï¼Œåç»­åªéœ€è¦æ ¹æ®keyä»ä¸­æ‹¿å–å³å¯ï¼Œå®é™…é¡¹ç›®ä¸­ç”¨è¿™ç§æ–¹å¼è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ã€‚ 12345678910111213public class ProcessorFactory &#123; private static Map&lt;String, AbstractProcessor&gt; factories = new HashMap(); public static void putProcess(String key, AbstractProcessor process) &#123; factories.put(key, process); &#125; public static AbstractProcessor selectProcess(String key) &#123; return factories.get(key); &#125;&#125; æ‰§è¡Œç¨‹åº1234567891011121314151617181920212223@Slf4jpublic class TemplateMethodApplication &#123; public static void main(String[] args) &#123; OneRequest oneRequest = OneRequest.builder() .version("2312312") .token("23423") .name("å¼ ä¸‰") .build(); new OneProcessor().handle(oneRequest); log.info("--------------------------"); TwoRequest twoRequest = TwoRequest.builder() .version("2312312") .token("23423") .id(23456L) .build(); new TwoProcessor().handle(twoRequest); &#125;&#125; ç»“æœ æ€»ä½“ä¸Šæ¥è®²ï¼ŒæŠ½è±¡ç±»ä¸­å®šä¹‰äº†ç®—æ³•çš„æ¡†æ¶ï¼Œç„¶åæŠŠéƒ¨åˆ†ç®—æ³•æ­¥éª¤æŠ½è±¡å‡ºæ¥ä¾›å­ç±»å®ç°ï¼Œæœ‰çš„æ—¶å€™æœ‰äº›æ–¹æ³•åªæœ‰ä¸ªåˆ«å­ç±»ä¼šå»å®ç°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŠ½è±¡ç±»ä¸­å®ç°ä¸ºç©ºå®ç°ï¼Œåœ¨æœ‰éœ€è¦çš„å­ç±»ä¸­æˆ‘ä»¬å¯ä»¥è¦†ç›–æŠ½è±¡ç±»çš„å®ç°ï¼Œè¿™æ ·é¿å…äº†æ‰€æœ‰çš„å­ç±»éƒ½å»å®ç°ï¼Œå…¶å®ä¸å…³å¿ƒçš„è¯éƒ½æ˜¯ç©ºå®ç°äº†ã€‚æœ¬ç¤ºä¾‹ç”¨åˆ°äº†lombokçš„@SuperBuilderç‰¹æ€§ï¼Œå¯èƒ½åœ¨ä¸‹è½½å®Œå®Œæ•´çš„ä»£ç åä¼šå‡ºç°ç¼–è¯‘é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸ºLombokçš„æ’ä»¶æš‚æ—¶è¿˜ä¸æ”¯æŒ@SuperBuilderã€‚ æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ€»ç»“æ¨¡æ¿æ–¹æ³•ç»å¸¸å’Œå…¶ä»–æ¨¡å¼æ··åˆä½¿ç”¨ï¼Œæ¯”å¦‚å·¥å‚ã€ç­–ç•¥ç­‰ç­‰ã€‚å…¶å®åœ¨Springä¸­å¤§é‡ä½¿ç”¨äº†æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œå…¶å®ä¹Ÿä¸å…‰åœ¨Springä¸­ï¼Œåƒå¹³æ—¶jdbcTemplateæˆ–è€…RedisTemplateï¼Œåƒè¿™ç§å¸¦æœ‰Templateçš„ã€‚ ä¼˜ç‚¹ï¼š 1ã€å°è£…ä¸å˜éƒ¨åˆ†ï¼Œæ‰©å±•å¯å˜éƒ¨åˆ†ã€‚ 2ã€æå–å…¬å…±ä»£ç ï¼Œä¾¿äºç»´æŠ¤ã€‚ 3ã€è¡Œä¸ºç”±çˆ¶ç±»æ§åˆ¶ï¼Œå­ç±»å®ç°ã€‚ ç¼ºç‚¹ï¼šæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä½¿å¾—ç³»ç»Ÿæ›´åŠ åºå¤§ã€‚ ä½¿ç”¨åœºæ™¯ï¼š 1ã€æœ‰å¤šä¸ªå­ç±»å…±æœ‰çš„æ–¹æ³•ï¼Œä¸”é€»è¾‘ç›¸åŒã€‚ 2ã€é‡è¦çš„ã€å¤æ‚çš„æ–¹æ³•ï¼Œå¯ä»¥è€ƒè™‘ä½œä¸ºæ¨¡æ¿æ–¹æ³•ã€‚ æ³¨æ„äº‹é¡¹ï¼š ä¸ºé˜²æ­¢æ¶æ„æ“ä½œï¼Œä¸€èˆ¬æ¨¡æ¿æ–¹æ³•éƒ½åŠ ä¸Š final å…³é”®è¯ã€‚ å‚è€ƒæ¨¡æ¿æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Template method pattern]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>æ¨¡æ¿æ–¹æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[spring-bootçš„spring-cacheä¸­çš„æ‰©å±•redisç¼“å­˜çš„ttlå’Œkeyå]]></title>
    <url>%2F2019%2F01%2F31%2Fspring-boot-redis-cache-ext%2F</url>
    <content type="text"><![CDATA[å‰æspring-cacheå¤§å®¶éƒ½ç”¨è¿‡ï¼Œå…¶ä¸­ä½¿ç”¨redis-cacheå¤§å®¶ä¹Ÿç”¨è¿‡ï¼Œè‡³äºå¦‚ä½•ä½¿ç”¨æ€ä¹ˆé…ç½®ï¼Œæœ¬ç¯‡å°±ä¸é‡ç‚¹æè¿°äº†ã€‚æœ¬ç¯‡ä¸»è¦è§£å†³2ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ä½¿ç”¨redisåšç¼“å­˜æ—¶å¯¹æ¯ä¸ªkeyè¿›è¡Œè‡ªå®šä¹‰çš„è¿‡æœŸæ—¶é—´é…ç½®ï¼Œç¬¬äºŒä¸ªä½¿ç”¨redisåšç¼“å­˜æ—¶@Cacheable(value = &quot;value&quot;, key = &quot;#p0&quot;) ï¼Œæœ€åç”Ÿæˆçš„keyä¼šåœ¨valueå’Œp0ä¸­é—´çš„æœ‰(::)2ä¸ªå†’å·ï¼Œä¸redisçš„keyåä¸€ä¸ªå†’å·é—´éš”çš„é£æ ¼ä¸ç¬¦ã€‚ æœ¬ç¯‡ä»¥spring-boot 2.1.2å’Œ spirng 5.1.4ä¸ºåŸºç¡€æ¥è®²è§£ã€‚RedisCacheManageåœ¨spring-data-redis 2.xä¸­ç›¸å¯¹äº1.xçš„å˜åŠ¨å¾ˆå¤§ï¼Œæœ¬ç¯‡å³åœ¨2.xçš„ç‰ˆæœ¬ä¸­å®ç°ã€‚ redis cacheçš„è¿‡æœŸæ—¶é—´æˆ‘ä»¬éƒ½çŸ¥é“redisçš„è¿‡æœŸæ—¶é—´ï¼Œæ˜¯ç”¨å®ƒåšç¼“å­˜æˆ–è€…åšä¸šåŠ¡æ“ä½œçš„çµæ€§ã€‚åœ¨ä½¿ç”¨@Cacheable(value = &quot;value&quot;, key = &quot;#p0&quot;)æ³¨è§£æ—¶å³å¯ã€‚å…·ä½“çš„ä½¿ç”¨æ–¹æ³•å‚è€ƒç½‘ä¸Šã€‚ RedisCacheManagerRedisCacheConfigurationæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹RedisCacheManagerï¼ŒRedisCacheWriteræ¥å£æ˜¯å¯¹redisæ“ä½œè¿›è¡ŒåŒ…è£…çš„ä¸€å±‚ä½çº§çš„æ“ä½œã€‚defaultCacheConfigæ˜¯redisçš„é»˜è®¤é…ç½®ï¼Œåœ¨ä¸‹ä¸€ä¸ªé€‰é¡¹å¡ä¸­è¯¦ç»†ä»‹ç»ã€‚initialCacheConfigurationæ˜¯å¯¹å„ä¸ªå•ç‹¬çš„ç¼“å­˜è¿›è¡Œå„è‡ªè¯¦ç»†çš„é…ç½®(è¿‡æœŸæ—¶é—´å°±æ˜¯åœ¨æ­¤é…ç½®çš„)ï¼ŒallowInFlightCacheCreationæ˜¯å¦å…è®¸åˆ›å»ºä¸äº‹å…ˆå®šä¹‰çš„ç¼“å­˜ï¼Œå¦‚æœä¸å­˜åœ¨å³ä½¿ç”¨é»˜è®¤é…ç½®ã€‚RedisCacheManagerBuilderä½¿ç”¨æ¡¥æ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ„å»ºRedisCacheManagerã€‚ 1234567891011public class RedisCacheManager extends AbstractTransactionSupportingCacheManager &#123; private final RedisCacheWriter cacheWriter; private final RedisCacheConfiguration defaultCacheConfig; private final Map&lt;String, RedisCacheConfiguration&gt; initialCacheConfiguration; private final boolean allowInFlightCacheCreation; public static class RedisCacheManagerBuilder &#123;&#125;&#125; AbstractTransactionSupportingCacheManageråŠ å…¥äº‹åŠ¡æ¦‚å¿µï¼Œå°†æ“ä½œä¸äº‹åŠ¡ç»‘å®šï¼ŒåŒ…è£…äº†ä¸€å±‚äº‹åŠ¡ã€‚ 1234567891011121314151617181920public abstract class AbstractTransactionSupportingCacheManager extends AbstractCacheManager &#123; private boolean transactionAware = false; public void setTransactionAware(boolean transactionAware) &#123; this.transactionAware = transactionAware; &#125; public boolean isTransactionAware() &#123; return this.transactionAware; &#125; @Override protected Cache decorateCache(Cache cache) &#123; return (isTransactionAware() ? new TransactionAwareCacheDecorator(cache) : cache); &#125;&#125;ttlæ˜¯è¿‡æœŸæ—¶é—´ï¼ŒcacheNullValuesæ˜¯å¦å…è®¸å­˜nullå€¼ï¼ŒkeyPrefixç¼“å­˜å‰ç¼€è§„åˆ™ï¼ŒusePrefixæ˜¯å¦å…è®¸ä½¿ç”¨å‰ç¼€ã€‚keySerializationPairç¼“å­˜keyåºåˆ—åŒ–ï¼ŒvalueSerializationPairç¼“å­˜å€¼åºåˆ—åŒ–æ­¤å¤„æœ€å¥½è‡ªå·±ä½¿ç”¨jacksonçš„åºåˆ—å·æ›¿ä»£åŸç”Ÿçš„jdkåºåˆ—åŒ–ï¼ŒconversionServiceåšè½¬æ¢ç”¨çš„ã€‚ 123456789101112131415public class RedisCacheConfiguration &#123; private final Duration ttl; private final boolean cacheNullValues; private final CacheKeyPrefix keyPrefix; private final boolean usePrefix; private final SerializationPair&lt;String&gt; keySerializationPair; private final SerializationPair&lt;Object&gt; valueSerializationPair; private final ConversionService conversionService;&#125; å†æ¥çœ‹çœ‹å¦‚ä½•é…ç½®RedisCacheManager RedisCacheAutoConfigurationCustomCachePropertiesymlé…ç½®é…ç½®å‰é€šè¿‡RedisAutoConfigurationé…ç½®å¯ä»¥è·å–åˆ°redisç›¸å…³é…ç½®åŒ…æ‹¬redisTemplateï¼Œå› ä¸ºspring-boot2ä¸­redisä½¿ç”¨Lettuceä½œä¸ºå®¢æˆ·ç«¯ï¼Œç›¸å…³é…ç½®åœ¨LettuceConnectionConfigurationä¸­ã€‚ åœ¨å»åŠ è½½CachePropertieså’ŒCustomCachePropertiesé…ç½®ã€‚ é€šè¿‡RedisCacheManagerBuilderå»æ„é€ RedisCacheManagerï¼Œä½¿ç”¨éåŠ é”çš„redisç¼“å­˜æ“ä½œï¼Œredisé»˜è®¤é…ç½®ä½¿ç”¨çš„æ˜¯cachePropertiesä¸­çš„redisï¼Œæœ€åæ ¹æ®æˆ‘ä»¬è‡ªå®šä¹‰çš„customCachePropertiesé˜”ä»¥é’ˆå¯¹å•ä¸ªçš„keyè®¾ç½®å•ç‹¬çš„redisç¼“å­˜é…ç½®ï¼Œè¯¦æƒ…é˜”ä»¥æŸ¥çœ‹ã€‚ getDefaultRedisCacheConfigurationä¸»è¦å…ˆé€šè¿‡RedisCacheConfigurationçš„é»˜è®¤åˆ›å»ºæ–¹æ³•defaultCacheConfigåˆ›å»ºé»˜è®¤çš„é…ç½®ï¼Œåœ¨é€šè¿‡getJackson2JsonRedisSerializeråˆ›å»ºé»˜è®¤valueæ ¼å¼åŒ–(ä½¿ç”¨jacksonä»£æ›¿jdkåºåˆ—åŒ–)ï¼Œç„¶åé€šè¿‡redisç¼“å­˜é…ç½®çš„æ˜¯spring-cacheçš„CachePropertieså»ä¿®æ”¹é…ç½®é¡¹ã€‚ æœ€åæ ¹æ®é…ç½®æ„å»ºå‡ºRedisCacheConfigurationã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778@Slf4j@EnableCaching@Configuration@AutoConfigureAfter(RedisAutoConfiguration.class)@EnableConfigurationProperties(&#123;CacheProperties.class, CustomCacheProperties.class&#125;)@ConditionalOnClass(&#123;Redis.class, RedisCacheConfiguration.class&#125;)public class RedisCacheAutoConfiguration &#123;â€‹ @Autowiredâ€‹ private CacheProperties cacheProperties;â€‹ @Beanâ€‹ public RedisCacheManager redisCacheManager(CustomCacheProperties customCacheProperties,â€‹ RedisConnectionFactory redisConnectionFactory) &#123;â€‹ RedisCacheConfiguration defaultConfiguration = getDefaultRedisCacheConfiguration();â€‹ RedisCacheManager.RedisCacheManagerBuilder builder = RedisCacheManager.RedisCacheManagerBuilderâ€‹ .fromCacheWriter(RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory))â€‹ .cacheDefaults(defaultConfiguration);â€‹ Map&lt;String, RedisCacheConfiguration&gt; map = Maps.newHashMap();â€‹ Optional.ofNullable(customCacheProperties)â€‹ .map(p -&gt; p.getCustomCache())â€‹ .ifPresent(customCache -&gt; &#123;â€‹ customCache.forEach((key, cache) -&gt; &#123;â€‹ RedisCacheConfiguration cfg = handleRedisCacheConfiguration(cache, defaultConfiguration);â€‹ map.put(key, cfg);â€‹ &#125;);â€‹ &#125;);â€‹ builder.withInitialCacheConfigurations(map);â€‹ return builder.build();â€‹ &#125;â€‹ private RedisCacheConfiguration getDefaultRedisCacheConfiguration() &#123;â€‹ Redis redisProperties = cacheProperties.getRedis();â€‹ RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig();â€‹ Jackson2JsonRedisSerializer&lt;Object&gt; jackson2JsonRedisSerializer = getJackson2JsonRedisSerializer();â€‹ config = config.serializeKeysWith(SerializationPair.fromSerializer(new StringRedisSerializer()));â€‹ config = config.serializeValuesWith(SerializationPair.fromSerializer(jackson2JsonRedisSerializer));â€‹ config = handleRedisCacheConfiguration(redisProperties, config);â€‹ return config;â€‹ &#125;â€‹ private Jackson2JsonRedisSerializer getJackson2JsonRedisSerializer() &#123;â€‹ Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);â€‹ ObjectMapper om = new ObjectMapper();â€‹ om.setVisibility(PropertyAccessor.GETTER, JsonAutoDetect.Visibility.ANY);â€‹ om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);â€‹ om.setSerializationInclusion(Include.NON_NULL);â€‹ om.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);â€‹ jackson2JsonRedisSerializer.setObjectMapper(om);â€‹ return jackson2JsonRedisSerializer;â€‹ &#125;â€‹ private RedisCacheConfiguration handleRedisCacheConfiguration(Redis redisProperties,â€‹ RedisCacheConfiguration config) &#123;â€‹ if (Objects.isNull(redisProperties)) &#123;â€‹ return config;â€‹ &#125;â€‹ if (redisProperties.getTimeToLive() != null) &#123;â€‹ config = config.entryTtl(redisProperties.getTimeToLive());â€‹ &#125;â€‹ if (redisProperties.getKeyPrefix() != null) &#123;â€‹ config = config.computePrefixWith(cacheName -&gt; cacheName + redisProperties.getKeyPrefix());â€‹ &#125;â€‹ if (!redisProperties.isCacheNullValues()) &#123;â€‹ config = config.disableCachingNullValues();â€‹ &#125;â€‹ if (!redisProperties.isUseKeyPrefix()) &#123;â€‹ config = config.disableKeyPrefix();â€‹ &#125;â€‹ return config;â€‹ &#125;&#125;æˆ‘ä»¬è‡ªå®šçš„ç¼“å­˜çš„é…ç½®ï¼Œä½¿ç”¨äº†ç°æœ‰çš„CacheProperties.Redisä½œä¸ºé…ç½®ç±»ã€‚ 123456789@Data@ConfigurationProperties(prefix = â€œdamon.cacheâ€)public class CustomCacheProperties &#123;â€‹ private Map&lt;String, CacheProperties.Redis&gt; customCache;&#125; Redisçš„keyé…ç½®ï¼Œè¿‡æœŸæ—¶é—´ï¼Œæ˜¯å¦å…è®¸ç¼“å­˜ç©ºå€¼é»˜è®¤å¯ä»¥ï¼Œkeyçš„å‰ç¼€ï¼Œæ˜¯å¦å…è®¸ä½¿ç”¨keyå‰ç¼€ 1234567891011121314public static class Redis &#123; private Duration timeToLive; private boolean cacheNullValues = true; private String keyPrefix; private boolean useKeyPrefix = true;&#125;å†æ¥çœ‹çœ‹é…ç½®é¡¹ spring.cache.rediså°±ä¸ºå½“å‰redis-cacheçš„é»˜è®¤é…ç½® åº•ä¸‹çš„damon.cacheå°±ä¸ºè‡ªå®šä¹‰é…ç½®(é»˜è®¤20ç§’)ï¼Œå¦‚ä¸‹é…ç½®äº†testAå’Œ testB2ä¸ªè‡ªå®šä¹‰keyçš„è¿‡æœŸæ—¶é—´(ä¸€ä¸ª40ç§’ï¼Œä¸€ä¸ª50ç§’) 123456789101112131415161718spring: redis: host: localhost port: 6379 cache:â€‹ redis: time-to-live: 20sdamon: cache: custom-cache: testA: time-to-live: 40s testB: time-to-live: 50s redis-cacheçš„keyåè°ƒæ•´ ä»ä¸Šè¿°æˆ‘ä»¬å¯ä»¥çœ‹å‡ºä½¿ç”¨åï¼Œç¼“å­˜è¿‡æœŸæ—¶é—´å¯ä»¥è‡ªå®šä¹‰é…ç½®äº†ï¼Œä½†æ˜¯keyåä¸­é—´æœ‰2ä¸ªå†’å·ã€‚ RedisCacheRedisCacheConfigurationCacheKeyPrefixRedisCacheä¸­çš„createCacheKeyæ–¹æ³•æ˜¯ç”Ÿæˆredisçš„keyï¼Œä»ä¸­å¯ä»¥çœ‹å‡ºæ˜¯å¦ä½¿ç”¨prefixï¼Œä½¿ç”¨çš„è¯é€šè¿‡prefixCacheKeyæ–¹æ³•ç”Ÿæˆï¼Œå€Ÿç”¨äº†redisCacheé…ç½®é¡¹æ¥ç”Ÿæˆã€‚ 1234567891011121314151617181920private final RedisCacheConfiguration cacheConfig;protected String createCacheKey(Object key) &#123; String convertedKey = convertKey(key); if (!cacheConfig.usePrefix()) &#123; return convertedKey; &#125; return prefixCacheKey(convertedKey);&#125;private String prefixCacheKey(String key) &#123; // allow contextual cache names by computing the key prefix on every call. return cacheConfig.getKeyPrefixFor(name) + key;&#125;åœ¨redisCacheé…ç½®é¡¹ä¸­ä½¿ç”¨getKeyPrefixForæ–¹æ³•æ¥ç”Ÿæˆå®Œæ•´çš„redisçš„keyåï¼Œé€šè¿‡ keyPrefix.computeæ¥ç”Ÿæˆã€‚ å‚è€ƒ 12345678910private final CacheKeyPrefix keyPrefix;public String getKeyPrefixFor(String cacheName) &#123; Assert.notNull(cacheName, â€œCache name must not be null!â€); return keyPrefix.compute(cacheName);&#125;è¿™é‡Œå°±çœ‹åˆ°æˆ‘ä»¬ä½¿ç”¨å¤„ï¼Œè€Œä¸”çœ‹åˆ°äº†é»˜è®¤å®ç°æœ‰2ä¸ªå†’å·çš„å®ç°ã€‚ å…¶å®æ˜¯åœ¨RedisCacheConfigurationä¸­æœ‰ä¸ªé»˜è®¤å®ç°æ–¹æ³•ï¼Œé‡Œé¢ç”¨çš„å°±æ˜¯CacheKeyPrefixçš„é»˜è®¤å®ç°ã€‚æˆ‘ä»¬åªæœ‰è¦†ç›–æ­¤å¤„å³å¯ã€‚ 123456789101112131415@FunctionalInterfacepublic interface CacheKeyPrefix &#123;//è®¡ç®—åœ¨redisä¸­çš„ç¼“å­˜åString compute(String cacheName);//é»˜è®¤å®ç°ï¼Œä¸­é—´ç”¨çš„å°±æ˜¯ï¼šï¼š static CacheKeyPrefix simple() &#123;return name -&gt; name + â€œ::â€; &#125;&#125; æ€»ç»“å‚è€ƒä¸Šæ–‡ï¼Œä½¿ç”¨RedisCacheConfigurationçš„computePrefixWith(cacheName -&gt; cacheName + redisProperties.getKeyPrefix())å®ç°keyè°ƒæ•´ã€‚ é¢˜å¤–è¯æˆ‘ä»¬å†æ¥èŠèŠspring-cacheï¼Œå®é™…ä¸Šå…¶å®å®ƒå°±æ˜¯æŠŠç¼“å­˜çš„ä½¿ç”¨ç»™æŠ½è±¡äº†ï¼Œåœ¨å¯¹ç¼“å­˜çš„å…·ä½“å®ç°çš„è¿‡ç¨‹ä¸­ç»™æŠ½å‡ºæ¥ã€‚å…¶å®æœ€é‡è¦çš„å°±æ˜¯Cacheå’ŒCacheManager2ä¸ªæ¥å£ï¼Œç®€å•çš„å®ç°å¦‚SimpleCacheManagerã€‚]]></content>
      <categories>
        <category>Spring Boot</category>
      </categories>
      <tags>
        <tag>Cache</tag>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹å¤‡å¿˜å½•æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F26%2Fdesign-pattern-memento%2F</url>
    <content type="text"><![CDATA[å¤‡å¿˜å½•æ¨¡å¼Without violating encapsulation, capture and externalize an objectâ€™s internal state allowing the object to be restored to this state later.åœ¨ä¸ç ´åå°è£…æ€§çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ã€‚ æ‰€è°“å¤‡å¿˜å½•æ¨¡å¼å°±æ˜¯åœ¨ä¸ç ´åå°è£…çš„å‰æä¸‹ï¼Œæ•è·ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œå¹¶åœ¨è¯¥å¯¹è±¡ä¹‹å¤–ä¿å­˜è¿™ä¸ªçŠ¶æ€ï¼Œè¿™æ ·å¯ä»¥åœ¨ä»¥åå°†å¯¹è±¡æ¢å¤åˆ°åŸå…ˆä¿å­˜çš„çŠ¶æ€ã€‚å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æ€»æ˜¯éœ€è¦è®°å½•ä¸€ä¸ªå¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ï¼Œè¿™æ ·åšçš„ç›®çš„å°±æ˜¯ä¸ºäº†å…è®¸ç”¨æˆ·å–æ¶ˆä¸ç¡®å®šæˆ–è€…é”™è¯¯çš„æ“ä½œï¼Œèƒ½å¤Ÿæ¢å¤åˆ°ä»–åŸå…ˆçš„çŠ¶æ€ï¼Œä½¿å¾—ä»–æœ‰â€åæ‚”è¯â€å¯åƒã€‚é€šè¿‡ä¸€ä¸ªå¤‡å¿˜å½•ç±»ä¸“é—¨å­˜å‚¨å¯¹è±¡çŠ¶æ€ã€‚å®¢æˆ·ä¸ä¸å¤‡å¿˜å½•ç±»è€¦åˆï¼Œä¸å¤‡å¿˜å½•ç®¡ç†ç±»è€¦åˆã€‚ å¤‡å¿˜å½•æ¨¡å¼UML UMLç±»å›¾Caretakerç±»æ˜¯æŒ‡ç”¨äºä¿å­˜(createMemento())å’Œè¿˜åŸ(restore(memento))å‘èµ·æ–¹å†…éƒ¨çŠ¶æ€çš„Originatorç±»ã€‚å‘èµ·æ–¹ç±»å®ç°ï¼ˆ1ï¼‰createMemento()ï¼Œé€šè¿‡åˆ›å»ºå’Œè¿”å›å­˜å‚¨å‘èµ·æ–¹å½“å‰å†…éƒ¨çŠ¶æ€çš„mementoå¯¹è±¡ï¼ˆ2ï¼‰é€šè¿‡ä»ä¼ å…¥çš„mementoå¯¹è±¡è¿˜åŸçŠ¶æ€æ¥è¿˜åŸ(memento)ã€‚ UMLæ—¶åºå›¾ï¼ˆ1ï¼‰ä¿å­˜å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼šCaretakerå¯¹Originatorè°ƒç”¨createMemento()ï¼Œåˆ›å»ºmementoå¯¹è±¡ï¼Œä¿å­˜å…¶å½“å‰å†…éƒ¨çŠ¶æ€(setState())ï¼Œå¹¶å°†mementoè¿”å›ç»™Caretakerã€‚ ï¼ˆ2ï¼‰æ¢å¤å‘èµ·äººçš„å†…éƒ¨çŠ¶æ€ï¼šCaretakerå¯¹Originatorè°ƒç”¨restore(memento)ï¼Œå¹¶æŒ‡å®šå­˜å‚¨åº”æ¢å¤çŠ¶æ€çš„mementoå¯¹è±¡ã€‚å‘èµ·è€…ä»mementoè·å–çŠ¶æ€(getState())ä»¥è®¾ç½®å…¶è‡ªå·±çš„çŠ¶æ€ã€‚ å¤‡å¿˜å½•æ¨¡å¼è§’è‰²ç»“æ„(1) å¤‡å¿˜å½•ï¼ˆMementoï¼‰è§’è‰²ï¼šå¤‡å¿˜å½•è§’è‰²å­˜å‚¨â€œå¤‡å¿˜å‘èµ·è§’è‰²â€çš„å†…éƒ¨çŠ¶æ€ã€‚â€œå¤‡å¿˜å‘èµ·è§’è‰²â€æ ¹æ®éœ€è¦å†³å®šå¤‡å¿˜å½•è§’è‰²å­˜å‚¨â€œå¤‡å¿˜å‘èµ·è§’è‰²â€çš„å“ªäº›å†…éƒ¨çŠ¶æ€ã€‚ä¸ºäº†é˜²æ­¢â€œå¤‡å¿˜å‘èµ·è§’è‰²â€ä»¥å¤–çš„å…¶ä»–å¯¹è±¡è®¿é—®å¤‡å¿˜å½•ã€‚å¤‡å¿˜å½•å®é™…ä¸Šæœ‰ä¸¤ä¸ªæ¥å£ï¼Œâ€œå¤‡å¿˜å½•ç®¡ç†è€…è§’è‰²â€åªèƒ½çœ‹åˆ°å¤‡å¿˜å½•æä¾›çš„çª„æ¥å£â€”â€”å¯¹äºå¤‡å¿˜å½•è§’è‰²ä¸­å­˜æ”¾çš„å±æ€§æ˜¯ä¸å¯è§çš„ã€‚â€œå¤‡å¿˜å‘èµ·è§’è‰²â€åˆ™èƒ½å¤Ÿçœ‹åˆ°ä¸€ä¸ªå®½æ¥å£â€”â€”èƒ½å¤Ÿå¾—åˆ°è‡ªå·±æ”¾å…¥å¤‡å¿˜å½•è§’è‰²ä¸­å±æ€§ã€‚ (2) å¤‡å¿˜å‘èµ·ï¼ˆOriginatorï¼‰è§’è‰²ï¼šâ€œå¤‡å¿˜å‘èµ·è§’è‰²â€åˆ›å»ºä¸€ä¸ªå¤‡å¿˜å½•ï¼Œç”¨ä»¥è®°å½•å½“å‰æ—¶åˆ»å®ƒçš„å†…éƒ¨çŠ¶æ€ã€‚åœ¨éœ€è¦æ—¶ä½¿ç”¨å¤‡å¿˜å½•æ¢å¤å†…éƒ¨çŠ¶æ€ã€‚ (3) å¤‡å¿˜å½•ç®¡ç†è€…ï¼ˆCaretakerï¼‰è§’è‰²ï¼šè´Ÿè´£ä¿å­˜å¥½å¤‡å¿˜å½•ã€‚ä¸èƒ½å¯¹å¤‡å¿˜å½•çš„å†…å®¹è¿›è¡Œæ“ä½œæˆ–æ£€æŸ¥ã€‚ å¹²è´§ç¤ºä¾‹æºç åœ°å€ CaretakerOriginatorMemento123456789101112131415161718public class Caretaker &#123;â€‹ public static void main(String[] args) &#123;â€‹ List&lt;Memento&gt; savedStates = new ArrayList();â€‹ Originator originator = new Originator();â€‹ originator.set(â€œState1â€);â€‹ originator.set(â€œState2â€);â€‹ savedStates.add(originator.saveToMemento());â€‹ originator.set(â€œState3â€);â€‹ savedStates.add(originator.saveToMemento());â€‹ originator.set(â€œState4â€);â€‹ originator.restoreFromMemento(savedStates.get(1));â€‹ &#125;&#125;12345678910111213141516171819202122232425@Slf4jpublic class Originator &#123;â€‹ private String state;â€‹ //çŠ¶æ€æ›´æ”¹â€‹ public void set(String state) &#123;â€‹ this.state = state;â€‹ log.info(â€œOriginator: Setting state to &#123;&#125;â€, state);â€‹ &#125;â€‹ //å°†çŠ¶æ€ä¿å­˜åˆ°å¤‡å¿˜å½•é‡Œâ€‹ public Memento saveToMemento() &#123;â€‹ log.info(â€œOriginator: Saving to Memento.â€);â€‹ return new Memento(this.state);â€‹ &#125;â€‹ //ä»å¤‡å¿˜å½•é‡Œå–å‡ºçŠ¶æ€å¹¶å›æ»šâ€‹ public void restoreFromMemento(Memento memento) &#123;â€‹ this.state = memento.getState();â€‹ log.info(â€œOriginator: State after restoring from Memento: &#123;&#125;â€, state);â€‹ &#125;&#125;12345678910@Data@AllArgsConstructorpublic class Memento &#123;â€‹ //çŠ¶æ€ç»´æŠ¤â€‹ private String state;&#125; ç¤ºä¾‹ç»“æœ ä»ä¸Šè¿°ä»£ç ä¸­çœ‹çš„å‡ºï¼Œéšç€çŠ¶æ€å˜æ›´ï¼Œç”¨Listç»´æŠ¤å‘èµ·è€…çš„çŠ¶æ€åˆ—è¡¨ï¼Œä»å¤‡å¿˜å½•ä¸­å–å‡ºçŠ¶æ€ä»¥ä¾¿å›é€€çŠ¶æ€ã€‚ javaä¸­çš„ä½¿ç”¨ç”Ÿæˆå¯¹è±¡çŠ¶æ€çš„ä¸€ä¸ªå¿«ç…§ï¼Œä»¥ä¾¿å¯¹è±¡å¯ä»¥æ¢å¤åŸå§‹çŠ¶æ€è€Œä¸ç”¨æš´éœ²è‡ªèº«çš„å†…å®¹ã€‚Dateå¯¹è±¡é€šè¿‡è‡ªèº«å†…éƒ¨çš„ä¸€ä¸ªlongå€¼æ¥å®ç°å¤‡å¿˜å½•æ¨¡å¼ã€‚ java.util.Date java.io.Serializable æ€»ç»“ä¼˜ç‚¹ 1ã€ç»™ç”¨æˆ·æä¾›äº†ä¸€ç§å¯ä»¥æ¢å¤çŠ¶æ€çš„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨æˆ·èƒ½å¤Ÿæ¯”è¾ƒæ–¹ä¾¿åœ°å›åˆ°æŸä¸ªå†å²çš„çŠ¶æ€ã€‚ 2ã€å®ç°äº†ä¿¡æ¯çš„å°è£…ï¼Œä½¿å¾—ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒçŠ¶æ€çš„ä¿å­˜ç»†èŠ‚ã€‚ ç¼ºç‚¹æ¶ˆè€—èµ„æºã€‚å¦‚æœç±»çš„æˆå‘˜å˜é‡è¿‡å¤šï¼ŒåŠ¿å¿…ä¼šå ç”¨æ¯”è¾ƒå¤§çš„èµ„æºï¼Œè€Œä¸”æ¯ä¸€æ¬¡ä¿å­˜éƒ½ä¼šæ¶ˆè€—ä¸€å®šçš„å†…å­˜ã€‚ ä½¿ç”¨åœºæ™¯1ã€éœ€è¦ä¿å­˜/æ¢å¤æ•°æ®çš„ç›¸å…³çŠ¶æ€åœºæ™¯ã€‚ 2ã€æä¾›ä¸€ä¸ªå¯å›æ»šçš„æ“ä½œã€‚ æ³¨æ„äº‹é¡¹1ã€ä¸ºäº†ç¬¦åˆè¿ªç±³ç‰¹åŸåˆ™ï¼Œè¿˜è¦å¢åŠ ä¸€ä¸ªç®¡ç†å¤‡å¿˜å½•çš„ç±»ã€‚ 2ã€ä¸ºäº†èŠ‚çº¦å†…å­˜ï¼Œå¯ä½¿ç”¨åŸå‹æ¨¡å¼+å¤‡å¿˜å½•æ¨¡å¼ã€‚ å‚è€ƒå¤‡å¿˜å½•æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Memento pattern ç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼]]></content>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F24%2Fdesign-pattern-observer%2F</url>
    <content type="text"><![CDATA[è§‚å¯Ÿè€…æ¨¡å¼Define a one-to-many dependency between objects where a state change in one object results in all its dependents being notified and updated automatically.ç›´è¯‘è¿‡æ¥å°±æ˜¯ï¼Œå®šä¹‰å¯¹è±¡é—´çš„ä¸€å¯¹å¤šä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å˜æ›´ä¼šè‡ªåŠ¨é€šçŸ¥å’Œæ›´æ–°æ‰€æœ‰ä¾èµ–é¡¹ã€‚åƒå‘å¸ƒ/è®¢é˜…æ¨¡å¼ï¼Œäº‹ä»¶é€šçŸ¥æ¨¡å¼ï¼Œæ•°æ®æº/ç›‘å¬æ¨¡å¼ç­‰éƒ½æ˜¯æ€§è´¨ä¸€æ ·ã€‚ è§‚å¯Ÿè€…æ¨¡å¼UMLUMLç±»å’Œæ—¶åºå›¾ç±»å›¾ï¼šSubjectç±»ä¸ä¼šç›´æ¥æ›´æ–°ä»å±å¯¹è±¡çš„çŠ¶æ€ã€‚ç›¸åï¼ŒSubjectå¼•ç”¨äº†ç”¨äºæ›´æ–°çŠ¶æ€çš„è§‚å¯Ÿè€…æ¥å£ï¼ˆupdate()ï¼‰ï¼Œè¿™ä½¿å¾—Subjectç‹¬ç«‹äºä¾èµ–å¯¹è±¡çš„çŠ¶æ€æ›´æ–°æ–¹å¼ã€‚Observer1å’ŒObserver2ç±»é€šè¿‡å°†çŠ¶æ€ä¸Subjectçš„çŠ¶æ€åŒæ­¥æ¥å®ç°Observeræ¥å£ã€‚ æ—¶åºå›¾ï¼šObserver1å’ŒObserver2å¯¹è±¡è°ƒç”¨Subject1ä¸Šçš„attach(this)æ¥æ³¨å†Œè‡ªå·±ã€‚å‡å¦‚Subject1çš„çŠ¶æ€å‘ç”Ÿå˜æ›´ï¼ŒSubject1æœ¬èº«è°ƒç”¨notify()ã€‚notify()å¯¹å·²æ³¨å†Œçš„Observer1å’ŒObserver2å¯¹è±¡è°ƒç”¨update()ï¼Œåè€…ä»Subject1è¯·æ±‚å·²æ›´æ”¹çš„æ•°æ®ï¼ˆgetState()ï¼‰ä»¥æ›´æ–°ï¼ˆåŒæ­¥ï¼‰å…¶çŠ¶æ€ã€‚ UMLç±»å›¾ è§‚å¯Ÿè€…æ¨¡å¼è§’è‰² Subjectï¼ˆç›®æ ‡ï¼‰ï¼šç›®æ ‡åˆç§°ä¸ºä¸»é¢˜ï¼Œå®ƒæ˜¯æŒ‡è¢«è§‚å¯Ÿçš„å¯¹è±¡ã€‚åœ¨ç›®æ ‡ä¸­å®šä¹‰äº†ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆï¼Œä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…æ¥è§‚å¯Ÿï¼Œå®ƒæä¾›ä¸€ç³»åˆ—æ–¹æ³•æ¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼ŒåŒæ—¶å®ƒå®šä¹‰äº†é€šçŸ¥æ–¹æ³•notify()ã€‚ç›®æ ‡ç±»å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–å…·ä½“ç±»ã€‚ ConcreteSubjectï¼ˆå…·ä½“ç›®æ ‡ï¼‰ï¼šå…·ä½“ç›®æ ‡æ˜¯ç›®æ ‡ç±»çš„å­ç±»ï¼Œé€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œå½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼›åŒæ—¶å®ƒè¿˜å®ç°äº†åœ¨ç›®æ ‡ç±»ä¸­å®šä¹‰çš„æŠ½è±¡ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœæ— é¡»æ‰©å±•ç›®æ ‡ç±»ï¼Œåˆ™å…·ä½“ç›®æ ‡ç±»å¯ä»¥çœç•¥ã€‚ Observerï¼ˆè§‚å¯Ÿè€…ï¼‰ï¼šè§‚å¯Ÿè€…å°†å¯¹è§‚å¯Ÿç›®æ ‡çš„æ”¹å˜åšå‡ºååº”ï¼Œè§‚å¯Ÿè€…ä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ï¼Œè¯¥æ¥å£å£°æ˜äº†æ›´æ–°æ•°æ®çš„æ–¹æ³•update()ï¼Œå› æ­¤åˆç§°ä¸ºæŠ½è±¡è§‚å¯Ÿè€…ã€‚ ConcreteObserverï¼ˆå…·ä½“è§‚å¯Ÿè€…ï¼‰ï¼šåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜å‚¨å…·ä½“è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼›å®ƒå®ç°äº†åœ¨æŠ½è±¡è§‚å¯Ÿè€…Observerä¸­å®šä¹‰çš„update()æ–¹æ³•ã€‚ è§‚å¯Ÿè€…æ¨¡å¼æè¿°äº†å¦‚ä½•å»ºç«‹å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œä»¥åŠå¦‚ä½•æ„é€ æ»¡è¶³è¿™ç§éœ€æ±‚çš„ç³»ç»Ÿã€‚è§‚å¯Ÿè€…æ¨¡å¼åŒ…å«è§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…ä¸¤ç±»å¯¹è±¡ï¼Œä¸€ä¸ªç›®æ ‡å¯ä»¥æœ‰ä»»æ„æ•°ç›®çš„ä¸ä¹‹ç›¸ä¾èµ–çš„è§‚å¯Ÿè€…ï¼Œä¸€æ—¦è§‚å¯Ÿç›®æ ‡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚ä½œä¸ºå¯¹è¿™ä¸ªé€šçŸ¥çš„å“åº”ï¼Œæ¯ä¸ªè§‚å¯Ÿè€…éƒ½å°†ç›‘è§†è§‚å¯Ÿç›®æ ‡çš„çŠ¶æ€ä»¥ä½¿å…¶çŠ¶æ€ä¸ç›®æ ‡çŠ¶æ€åŒæ­¥ï¼Œè¿™ç§äº¤äº’ä¹Ÿç§°ä¸ºå‘å¸ƒ-è®¢é˜…(Publish-Subscribe)ã€‚è§‚å¯Ÿç›®æ ‡æ˜¯é€šçŸ¥çš„å‘å¸ƒè€…ï¼Œå®ƒå‘å‡ºé€šçŸ¥æ—¶å¹¶ä¸éœ€è¦çŸ¥é“è°æ˜¯å®ƒçš„è§‚å¯Ÿè€…ï¼Œå¯ä»¥æœ‰ä»»æ„æ•°ç›®çš„è§‚å¯Ÿè€…è®¢é˜…å®ƒå¹¶æ¥æ”¶é€šçŸ¥ã€‚ å¹²è´§æºç è§£ææºç åœ°å€ åšå®¢è®¢é˜…çš„åŠŸèƒ½ï¼ŒæŠ½è±¡ä¸»é¢˜ä¸­ç»´æŠ¤è®¢é˜…å…³ç³»ï¼ŒåŒæ—¶å¼•å…¥æ™®é€šå’Œvipè§‚å¯Ÿè€…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125//æŠ½è±¡ä¸»é¢˜@Datapublic abstract class Subject &#123; //ä¸»é¢˜è®¢é˜…è€…ä»¬ private List&lt;Observer&gt; observerList = Lists.newArrayList(); //è®¢é˜… public void register(Observer observer) &#123; observerList.add(observer); &#125; //å–æ¶ˆè®¢é˜… public void remove(Observer observer) &#123; observerList.remove(observer); &#125; //å‘å¸ƒä¸œè¥¿ public abstract void publish(String msg);&#125;//æŠ½è±¡è§‚å¯Ÿè€…@Slf4j@Data@AllArgsConstructorpublic abstract class Observer &#123; //è§‚å¯Ÿè€…åç§° private String name; //æ›´æ–°çŠ¶æ€ï¼Œç”±ä¸»é¢˜è°ƒåº¦ public void update(Object subject, Object args) &#123; log.info("&#123;&#125;è·å–åˆ°å˜æ›´é€šçŸ¥ï¼š&#123;&#125;", name, args); &#125;&#125;//åšå®¢ä¸»é¢˜@Slf4jpublic class Blog extends Subject &#123; @Override public void publish(String msg) &#123; log.info("å‘å¸ƒmsg:&#123;&#125;", msg); //é€šçŸ¥è®¢é˜…è€… getObserverList().forEach(observer -&gt; observer.update(this, msg)); &#125;&#125;//æ™®é€šç”¨æˆ·è§‚å¯Ÿè€…@Slf4jpublic class NormalObserver extends Observer &#123; public NormalObserver(String name) &#123; super(name); &#125; @Override public void update(Object subject, Object args) &#123; super.update(subject, args); log.info("&#123;&#125;è·å–åˆ°å˜æ›´é€šçŸ¥ï¼šæ™®é€šç”¨æˆ·å¯ä»¥ä¸ç¼“å­˜", getName()); &#125;&#125;//vipç”¨æˆ·è§‚å¯Ÿè€…@Slf4jpublic class VipObserver extends Observer &#123; public VipObserver(String name) &#123; super(name); &#125; @Override public void update(Object subject, Object args) &#123; super.update(subject, args); log.info("&#123;&#125;è·å–åˆ°å˜æ›´é€šçŸ¥ï¼švipå¯ä»¥ç¼“å­˜", getName()); &#125;&#125;@Slf4jpublic class Application &#123; public static void main(String[] args) &#123; Blog blog = new Blog(); VipObserver wang = new VipObserver("è€ç‹99"); VipObserver lee = new VipObserver("è€æ"); NormalObserver four = new NormalObserver("å°å››"); NormalObserver twoEgg = new NormalObserver("äºŒè›‹"); log.info("---------------------begin--------------------"); // ç”¨æˆ·è®¢é˜…åšå®¢ï¼Œæ™®é€šå’Œvipç”¨æˆ· new Thread(() -&gt; &#123; blog.register(wang); sleep(2); blog.register(lee); sleep(2); blog.register(four); &#125;).start(); // åšå®¢çº¿ç¨‹æ¯éš”2ç§’å‘å¸ƒä¸€æ¬¡æ–‡ç« , æ€»å…±å‘å¸ƒ4æ¬¡ new Thread(() -&gt; &#123; IntStream.rangeClosed(1, 4).forEach(i -&gt; &#123; blog.publish(String.format("æ–°æŠŠæˆç¬¬%sæ¬¡", i)); sleep(2); &#125;); &#125;).start(); // æœ‰ç”¨æˆ·é€€å‡ºè®¢é˜…åšå®¢ï¼Œä¹Ÿæœ‰äºŒè›‹åŠ å…¥è®¢é˜… new Thread(() -&gt; &#123; sleep(3); blog.remove(lee); sleep(2); blog.register(twoEgg); &#125;).start(); &#125; private static void sleep(int seconds) &#123; try &#123; TimeUnit.SECONDS.sleep(seconds); &#125; catch (InterruptedException e) &#123; log.error("error : ", e); &#125; &#125;&#125; jdkå†…ç½®çš„Obverserå’ŒObservable 1234567891011121314151617181920212223242526272829@Slf4jpublic class ObserverApplication &#123; public static void main(String[] args) &#123; log.info("Enter Text: "); EventSource eventSource = new EventSource(); eventSource.addObserver((obj, arg) -&gt; &#123; log.info("Received response: &#123;&#125;", arg); &#125;); eventSource.addObserver((obj, arg) -&gt; &#123; log.info("Received response2: &#123;&#125;,,&#123;&#125;", arg, obj ); &#125;); new Thread(eventSource).start(); &#125;&#125;class EventSource extends Observable implements Runnable &#123; public void run() &#123; while (true) &#123; String response = new Scanner(System.in).next(); setChanged(); notifyObservers(response); &#125; &#125;&#125; Javaä¸­çš„ä½¿ç”¨å®ƒä½¿å¾—ä¸€ä¸ªå¯¹è±¡å¯ä»¥çµæ´»çš„å°†æ¶ˆæ¯å‘é€ç»™æ„Ÿå…´è¶£çš„å¯¹è±¡ java.util.EventListener javax.servlet.http.HttpSessionBindingListener javax.servlet.http.HttpSessionAttributeListener javax.faces.event.PhaseListener Listenerä»åå­—ä¸Šçœ‹å°±æ˜ç™½æ˜¯ç›‘å¬çš„æ„æ€äº†ã€‚ JDKä¸­å†…ç½®çš„Obverserå’ŒObservablejdkä¸­å†…ç½®çš„è§‚å¯Ÿè€…æ¨¡å¼ã€‚å³æ˜¯java.util.Observer(æ¥å£)å’Œjava.util.Observable(ç±»)ã€‚ ç®€å•çš„è¯´è¯´è¿™ä¸ªã€‚è§‚å¯Ÿè€…æ¥å£(java.util.Observer)ï¼Œä¸»é¢˜(java.util.Observable)ã€‚å®ç°è§‚å¯Ÿè€…æ¥å£å’Œç»§æ‰¿ä¸»é¢˜ã€‚é€šè¿‡æŠ½è±¡ä¸»é¢˜çš„addObserver()æ³¨å†Œè§‚å¯Ÿè€…ï¼ŒdeleteObserver()ç§»é™¤è§‚å¯Ÿè€…ã€‚ é¦–å…ˆé€šè¿‡è°ƒç”¨ä¸»é¢˜ç±»çš„setChange()å‘ŠçŸ¥çŠ¶æ€å˜æ›´ï¼Œéšåè°ƒç”¨notifyObserversæ–¹æ³•ï¼ˆå¯ä¼ å¯ä¸ä¼ å‚æ•°ï¼‰å»é€šçŸ¥è§‚å¯Ÿè€…ï¼Œæœ€åå› ä¸ºä¸»é¢˜åœ¨notifyObserversæ—¶ä¼šä¸»åŠ¨è°ƒç”¨è§‚å¯Ÿè€…çš„update()æ–¹æ³•ï¼Œæ”¹æ–¹æ³•æœ‰2ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªä¸ºä¸»é¢˜å¯¹è±¡ï¼Œç¬¬äºŒä¸ªä¸ºå¯å˜å‚æ•°ã€‚ æ€»ç»“è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä¸€ç§ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„è®¾è®¡æ¨¡å¼ï¼ŒJDKä¸­å°±å¸¦æœ‰å®ç°ã€‚æ— è®ºæ˜¯ç§»åŠ¨åº”ç”¨ã€Webåº”ç”¨æˆ–è€…æ¡Œé¢åº”ç”¨ï¼Œè§‚å¯Ÿè€…æ¨¡å¼å‡ ä¹æ— å¤„ä¸åœ¨ï¼Œå®ƒä¸ºå®ç°å¯¹è±¡ä¹‹é—´çš„è”åŠ¨æä¾›äº†ä¸€å¥—å®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œå‡¡æ˜¯æ¶‰åŠåˆ°ä¸€å¯¹ä¸€æˆ–è€…ä¸€å¯¹å¤šçš„å¯¹è±¡äº¤äº’åœºæ™¯éƒ½å¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼ã€‚è§‚å¯Ÿè€…æ¨¡å¼å¹¿æ³›åº”ç”¨äºå„ç§ç¼–ç¨‹è¯­è¨€çš„GUIäº‹ä»¶å¤„ç†çš„å®ç°ï¼Œåœ¨åŸºäºäº‹ä»¶çš„XMLè§£ææŠ€æœ¯ï¼ˆå¦‚SAX2ï¼‰ä»¥åŠWebäº‹ä»¶å¤„ç†ä¸­ä¹Ÿéƒ½ä½¿ç”¨äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚ è§‚å¯Ÿè€…æ¨¡å¼çš„ä¼˜ç‚¹(1) è§‚å¯Ÿè€…æ¨¡å¼å¯ä»¥å®ç°è¡¨ç¤ºå±‚å’Œæ•°æ®é€»è¾‘å±‚çš„åˆ†ç¦»ï¼Œå®šä¹‰äº†ç¨³å®šçš„æ¶ˆæ¯æ›´æ–°ä¼ é€’æœºåˆ¶ï¼Œå¹¶æŠ½è±¡äº†æ›´æ–°æ¥å£ï¼Œä½¿å¾—å¯ä»¥æœ‰å„ç§å„æ ·ä¸åŒçš„è¡¨ç¤ºå±‚å……å½“å…·ä½“è§‚å¯Ÿè€…è§’è‰²ã€‚(2) è§‚å¯Ÿè€…æ¨¡å¼åœ¨è§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…ä¹‹é—´å»ºç«‹ä¸€ä¸ªæŠ½è±¡çš„è€¦åˆã€‚è§‚å¯Ÿç›®æ ‡åªéœ€è¦ç»´æŒä¸€ä¸ªæŠ½è±¡è§‚å¯Ÿè€…çš„é›†åˆï¼Œæ— é¡»äº†è§£å…¶å…·ä½“è§‚å¯Ÿè€…ã€‚ç”±äºè§‚å¯Ÿç›®æ ‡å’Œè§‚å¯Ÿè€…æ²¡æœ‰ç´§å¯†åœ°è€¦åˆåœ¨ä¸€èµ·ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥å±äºä¸åŒçš„æŠ½è±¡åŒ–å±‚æ¬¡ã€‚(3) è§‚å¯Ÿè€…æ¨¡å¼æ”¯æŒå¹¿æ’­é€šä¿¡ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šå‘æ‰€æœ‰å·²æ³¨å†Œçš„è§‚å¯Ÿè€…å¯¹è±¡å‘é€é€šçŸ¥ï¼Œç®€åŒ–äº†ä¸€å¯¹å¤šç³»ç»Ÿè®¾è®¡çš„éš¾åº¦ã€‚(4) è§‚å¯Ÿè€…æ¨¡å¼æ»¡è¶³â€œå¼€é—­åŸåˆ™â€çš„è¦æ±‚ï¼Œå¢åŠ æ–°çš„å…·ä½“è§‚å¯Ÿè€…æ— é¡»ä¿®æ”¹åŸæœ‰ç³»ç»Ÿä»£ç ï¼Œåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸è§‚å¯Ÿç›®æ ‡ä¹‹é—´ä¸å­˜åœ¨å…³è”å…³ç³»çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æ–°çš„è§‚å¯Ÿç›®æ ‡ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ è§‚å¯Ÿè€…æ¨¡å¼çš„ç¼ºç‚¹(1) å¦‚æœä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šç›´æ¥å’Œé—´æ¥è§‚å¯Ÿè€…ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ã€‚(2) å¦‚æœåœ¨è§‚å¯Ÿè€…å’Œè§‚å¯Ÿç›®æ ‡ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œè§‚å¯Ÿç›®æ ‡ä¼šè§¦å‘å®ƒä»¬ä¹‹é—´è¿›è¡Œå¾ªç¯è°ƒç”¨ï¼Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚(3) è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚ æ³¨æ„äº‹é¡¹1ã€JAVA ä¸­å·²ç»æœ‰äº†å¯¹è§‚å¯Ÿè€…æ¨¡å¼çš„æ”¯æŒç±»ã€‚ 2ã€é¿å…å¾ªç¯å¼•ç”¨ã€‚ 3ã€å¦‚æœé¡ºåºæ‰§è¡Œï¼ŒæŸä¸€è§‚å¯Ÿè€…é”™è¯¯ä¼šå¯¼è‡´ç³»ç»Ÿå¡å£³ï¼Œä¸€èˆ¬é‡‡ç”¨å¼‚æ­¥æ–¹å¼ã€‚ å‚è€ƒObserver pattern è§‚å¯Ÿè€…æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ ç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼ è®¾è®¡æ¨¡å¼æ€»ç»“ï¼ˆJavaï¼‰â€”â€” è§‚å¯Ÿè€…æ¨¡å¼]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>è§‚å¯Ÿè€…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mysqlæˆ‘æ˜¯æ€ä¹ˆéšæœºæˆªå–å­—ç¬¦æ•°ç»„é‡Œçš„å­—ç¬¦ä¸²å¹¶ä¸”ä¸€ä¸€å¯¹åº”]]></title>
    <url>%2F2019%2F01%2F17%2Fannual-personal-report%2F</url>
    <content type="text"><![CDATA[åœºæ™¯ï¼šä¸´è¿‘å¹´åº•ï¼Œå„ä¸ªAppéƒ½ä¼šæœ‰ä¸ªäººå¹´åº¦è´¦å•ï¼Œé¡¹ç›®é‡Œä¸ºäº†å›¾å¿«ï¼Œä»¥åŠèŠ‚çœå„ä¸ªç³»ç»Ÿæ¨¡å—ä¹‹é—´çš„æ¥å£è”è°ƒã€‚ç›´æ¥äººå·¥ç»Ÿè®¡æ•°æ®ï¼ˆğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ğŸ˜³ï¼‰ï¼Œæ„é€ è´¦å•æ•°æ®JSONã€‚ è¯ä¸å¤šè¯´ï¼Œè€å¤«æ‹¿èµ·é”®ç›˜å°±æ˜¯å¹²ã€‚ äº”æ¯’æœ‰æ¬§ï¼Œæ•°æ®ä¿ºä¸ä¹ç­çš„ç”±å…¶ä»–å„ä¸ªç³»ç»Ÿå°ç»„æä¾›ï¼Œä½†æ˜¯æœ‰äº›æ•°æ®æ˜¯éšæœºç”Ÿæˆçš„ä¸€äº›æè¿°æ€§çš„æ–‡æœ¬ï¼Œè€Œè¯¥æ–‡æœ¬ä»å›ºå®šçš„æ–‡æœ¬æ•°ç»„è€Œæ¥ã€‚å‰ç«¯å±•ç¤ºæ•ˆæœåˆè¦å°†éšæœºæ–‡æœ¬æ‹†æˆå‡ ä¸ªéƒ¨åˆ†æ¥ã€‚ æ­£å¸¸çš„sqlæ‹¼æ¥æˆjsonè¿˜æ–¹ä¾¿ã€‚ 12CONCAT('\"app\":&#123;\"time\":\"', DATE_FORMAT(time, "%Y-%m-%d %T"), '\",\"days\":', days, case when typeTime is null then '' else CONCAT(',\"typeTime\":\"', DATE_FORMAT(typeTime, "%Y-%m-%d %T"), '\"') end,'&#125;') éšæœºæ–‡æœ¬æ¥äº† å­¦å¯Œäº”è½¦ï¼šå†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨è¶³æ™ºå¤šè°‹ï¼šè„‘åŠ›ä½¿ç”¨ç§¯æåˆ†å­ï¼Œéä½ è«å±ä»—ä¹‰æ‰§è¨€ï¼šä½ çš„è§è§£ï¼Œé¢é¢ä¿±åˆ°ï¼Œæ·±å…¥äººå¿ƒç«çœ¼é‡‘ç›ï¼šç‹¬ç‰¹çš„æ´å¯ŸåŠ›ï¼Œæ€»èƒ½è·æ‚‰ä¸€åˆ‡è§å¤šè¯†å¹¿ï¼šæœ€ç¾çš„é˜…å†ï¼Œå°±æ˜¯æ²¿è·¯çš„é£æ™¯è´£ä»»æ‹…å½“ï¼šå…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹ ä»ä¸Šé¢å¯ä»¥çœ‹çš„å‡ºï¼Œå®ƒä»¬ä¹‹é—´ä¸€ä¸€å¯¹åº”çš„ã€‚ å”¯ç‹¬é‚£äº›éšæœºæ–‡æœ¬ç€å®æ€è€ƒç‰‡åˆ»ã€‚æ¥ï¼Œæˆ‘ä»¬å±‚å±‚å‰–æå®ƒã€‚ æˆªå–æ–‡æœ¬mysqlä¸­æ€ä¹ˆä»æ•°ç»„ä¸­å–éšæœºçš„æ–‡æœ¬ï¼Œå‚è€ƒsubstring_indexå‡½æ•°ã€‚åˆ†ä¸ºä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥å…ˆå»å€’æ•°å¼€å§‹å¾€å‰æ•°å€’æ•°å‡ ä½ï¼Œç¬¬äºŒæ­¥å†ä»æ–°çš„æ•°ç»„ä¸­å–ç¬¬ä¸€ä½ã€‚ 1substring_index(substring_index(array, 'ç¬¦åˆé—´éš”', -n), 'ç¬¦åˆé—´éš”', 1) æ„é€ éšæœºå› å­ç°åœ¨å†çœ‹çœ‹è¿™ä¸ªéšæœºå› å­æ€ä¹ˆå–ï¼Œå‚è€ƒrand()å‡½æ•°ã€‚ å› ä¸ºå–çš„æ˜¯-1åˆ°-7ä¹‹é—´çš„éšæœºæ•°ã€‚æ‰€ä»¥æœ€ç»ˆçš„æ•ˆæœå°±æ˜¯å¦‚ä¸‹ã€‚ 1-floor(rand()*7+1) å–éšæœºèŒƒå›´å†…çš„å€¼å¯ä»¥å‚è€ƒè¿™ä¸ªå…¬å¼ 1FLOOR(start_num + RAND() * (end_num - start_num + 1)) å¼€å§‹ç¬¬ä¸€æ¬¡æˆªå–éšæœºä¸²æˆªå–æ–¹æ³•æœ‰äº†ï¼Œéšæœºæ•°ä¹Ÿæœ‰äº†ï¼Œå¼€å¹²ã€‚ 12345select user_id, CONCAT('\"desc\": &#123;\"label\":\"', substring_index(substring_index('å­¦å¯Œäº”è½¦;è¶³æ™ºå¤šè°‹;ä»—ä¹‰æ‰§è¨€;ç«çœ¼é‡‘ç›;è§å¤šè¯†å¹¿;è´£ä»»æ‹…å½“;ä¹è§‚ç§¯æ',';',-FLOOR(rand()*7+1)),';',1),'\"',',\"description\": \"', substring_index(substring_index('å†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨;è„‘åŠ›ä½¿ç”¨ç§¯æåˆ†å­ï¼Œéä½ è«å±;ä½ çš„è§è§£ï¼Œé¢é¢ä¿±åˆ°ï¼Œæ·±å…¥äººå¿ƒ;ç‹¬ç‰¹çš„æ´å¯ŸåŠ›ï¼Œæ€»èƒ½è·æ‚‰ä¸€åˆ‡;æœ€ç¾çš„é˜…å†ï¼Œå°±æ˜¯æ²¿è·¯çš„é£æ™¯;å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹;çˆ±ç¬‘çš„ä½ è¿æ°”ä¸€å®šä¸ä¼šå·®',';',-FLOOR(rand()*7+1)),';',1),'\"&#125;') as report_content from data; ç»“æœå‘ç°å¯¹ä¸ä¸Šå•Šï¼Œã€è´£ä»»æ‹…å½“ã€‘åº”è¯¥å¯¹åº”ã€å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹ã€‘ï¼Œè€Œç»“æœå‡ºç°éƒ¨åˆ†å¯¹åº”åˆ°ã€å†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨ã€‘ åŠªåŠ›ç¬¬äºŒæ¬¡æˆªå–è¿™æ¬¡è€ƒè™‘åˆ°ä¸Šå›æˆ‘ä»¬æ˜¯æŠŠéšæœºå› å­æ”¾åœ¨sqlé‡Œæ²¡å¥è¯é‡Œï¼Œæ‰€ä»¥æ¯æ¬¡éƒ½æ‰§è¡Œäº†2æ¬¡ï¼Œç”Ÿæˆæ˜¯éšæœºå› å­å°±ä¸ä¸€æ ·äº†ï¼Œæˆªå–çš„ç»“æœå°±å¯¹åº”ä¸ä¸Šï¼Œé‚£ï¼Œæˆ‘ä»¬å…ˆåœ¨å­æŸ¥è¯¢é‡Œå…ˆæŠŠéšæœºå› å­ç”Ÿæˆåï¼Œå†åœ¨å¤–å±‚ç”¨è¿™ä¸ªéšæœºå› å­è¿™ä¸‹åº”è¯¥ä¸ä¸€æ ·äº†æŠŠã€‚ 12345select temp.user_id, CONCAT('\"desc\": &#123;\"label\":\"', substring_index(substring_index('å­¦å¯Œäº”è½¦;è¶³æ™ºå¤šè°‹;ä»—ä¹‰æ‰§è¨€;ç«çœ¼é‡‘ç›;è§å¤šè¯†å¹¿;è´£ä»»æ‹…å½“;ä¹è§‚ç§¯æ',';',temp.desc_index),';',1),'\"',',\"description\": \"', substring_index(substring_index('å†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨;è„‘åŠ›ä½¿ç”¨ç§¯æåˆ†å­ï¼Œéä½ è«å±;ä½ çš„è§è§£ï¼Œé¢é¢ä¿±åˆ°ï¼Œæ·±å…¥äººå¿ƒ;ç‹¬ç‰¹çš„æ´å¯ŸåŠ›ï¼Œæ€»èƒ½è·æ‚‰ä¸€åˆ‡;æœ€ç¾çš„é˜…å†ï¼Œå°±æ˜¯æ²¿è·¯çš„é£æ™¯;å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹;çˆ±ç¬‘çš„ä½ è¿æ°”ä¸€å®šä¸ä¼šå·®',';',temp.desc_index),';',1),'\"&#125;') as report_content from (select user_id, -FLOOR(rand()*7+1) as desc_index from data) temp åè¡€çš„å›¾ç‰‡åœ¨æŸ¥æ‰¾ä¸­ï¼Œä»å¼€å¤´çœ‹å°±çœ‹çš„å‡ºæ¥ï¼Œå¯¹åº”ä¸ä¸Šå•¦ï¼Œå‰å‡ ä¸ªå°±å‰éƒ¨å¯¹åº”ã€çˆ±ç¬‘çš„ä½ è¿æ°”ä¸€å®šä¸ä¼šå·®ã€‘ï¼Œçˆ±ç¬‘çš„æˆ‘ï¼Œè¿æ°”å°±æ˜¯è¿™ä¹ˆå·®ã€‚ æ”¹å˜ä¸‹è¯­å¥æŠŠéšæœºå› å­æ‰“å°å‡ºæ¥ 12345select temp.user_id, desc_index, CONCAT(desc_index, '\"desc\": &#123;\"label\":\"', substring_index(substring_index('å­¦å¯Œäº”è½¦;è¶³æ™ºå¤šè°‹;ä»—ä¹‰æ‰§è¨€;ç«çœ¼é‡‘ç›;è§å¤šè¯†å¹¿;è´£ä»»æ‹…å½“;ä¹è§‚ç§¯æ',';',temp.desc_index),';',1),'\"',',\"description\": \"', substring_index(substring_index('å†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨;è„‘åŠ›ä½¿ç”¨ç§¯æåˆ†å­ï¼Œéä½ è«å±;ä½ çš„è§è§£ï¼Œé¢é¢ä¿±åˆ°ï¼Œæ·±å…¥äººå¿ƒ;ç‹¬ç‰¹çš„æ´å¯ŸåŠ›ï¼Œæ€»èƒ½è·æ‚‰ä¸€åˆ‡;æœ€ç¾çš„é˜…å†ï¼Œå°±æ˜¯æ²¿è·¯çš„é£æ™¯;å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹;çˆ±ç¬‘çš„ä½ è¿æ°”ä¸€å®šä¸ä¼šå·®',';',temp.desc_index),';',1),'\"&#125;') as report_content from (select user_id, -FLOOR(rand()*7+1) as desc_index from data) temp **ï¼Œå‰é¢è¿™äº›æ‰“æ˜Ÿå·çš„ï¼Œéƒ½æ˜¯è„è¯ï¼Œå¿½ç•¥å®ƒï¼Œéšæœºå› å­ï¼Œæ˜æ˜åœ¨å­æŸ¥è¯¢éƒ½ç”Ÿæˆäº†ï¼Œä¸ºæ¯›è¿˜æ˜¯ä¸ä¸€æ ·ã€‚ æœ€ç»ˆç»å°½è„‘æ±çš„æˆªå–æœ¬æƒ³åœ¨å­æŸ¥è¯¢ä¸­ä½¿ç”¨rand()æŠŠéšæœºå› å­å¯ä»¥æå‡ºæ¥ï¼Œå“ªæˆæƒ³ï¼Œåœ¨å¤–å±‚çš„æŸ¥è¯¢æ—¶rand()åˆTMMçš„é‡ç®—äº†ä¸€éã€‚ ä¸€é¡¿å‚è€ƒä¸€é¡¿æ‰¾èµ„æ–™ï¼Œå¶ç„¶é—´å‘ç°äº†é—®é¢˜æ‰€åœ¨ Mysqlå°½ç„¶æœ‰è¿™æ ·çš„bug 2017å¹´æœ‰ä¸ªå“¥ä»¬æäº†è¿™æ ·çš„ä¸€ä¸ªissueï¼Œå°±æ˜¯ä¸Šé¢çš„é“¾æ¥ã€‚ é‡Œé¢è¯´äº†ä¸€äº›æƒ…å†µï¼Œåœ¨mysql5.6é‡Œï¼Œéšæœºæ•°æ˜¯ä¸€æ ·çš„ï¼Œ5.7é‡Œéšæœºæ•°ä¸ä¸€æ ·ã€‚å¦‚æœå­æŸ¥è¯¢é‡Œä¸ä½¿ç”¨è¡¨ï¼Œéšæœºæ•°ä¹Ÿæ˜¯ä¸€æ ·ã€‚åˆšåˆšå¥½mysqlå°±æ˜¯5.7ï¼Œåˆšåˆšå¥½ä¸­æ‹›äº†ã€‚ æ ¹æ®ä½œè€…å’ŒRoy Lysengçš„å»ºè®®ï¼Œæˆ‘ç”¨limitï¼Œæ²¡æƒ³åˆ°ï¼Œå°½ç„¶é˜”ä»¥å•¦ï¼Œè€æ³ªçºµæ¨ªå•Šã€‚ è¿˜æ˜¯è€å¤–å¥½ï¼ŒæˆåŠŸçš„è§£å†³æ–¹æ¡ˆï¼Œä¹Ÿä¼šåœ¨issueé‡Œè¯´æ˜ä¸‹çš„ã€‚ æ”¹é€ åçš„æœ€ç»ˆæ ·å­ã€‚ 12345select temp.user_id, desc_index, CONCAT(desc_index, '\"desc\": &#123;\"label\":\"', substring_index(substring_index('å­¦å¯Œäº”è½¦;è¶³æ™ºå¤šè°‹;ä»—ä¹‰æ‰§è¨€;ç«çœ¼é‡‘ç›;è§å¤šè¯†å¹¿;è´£ä»»æ‹…å½“;ä¹è§‚ç§¯æ',';',temp.desc_index),';',1),'\"',',\"description\": \"', substring_index(substring_index('å†ç¾çš„æ°”è´¨ï¼Œä¹Ÿæ©ç›–ä¸äº†ä½ æ‰åæœ¬è´¨;è„‘åŠ›ä½¿ç”¨ç§¯æåˆ†å­ï¼Œéä½ è«å±;ä½ çš„è§è§£ï¼Œé¢é¢ä¿±åˆ°ï¼Œæ·±å…¥äººå¿ƒ;ç‹¬ç‰¹çš„æ´å¯ŸåŠ›ï¼Œæ€»èƒ½è·æ‚‰ä¸€åˆ‡;æœ€ç¾çš„é˜…å†ï¼Œå°±æ˜¯æ²¿è·¯çš„é£æ™¯;å…ˆå¤©ä¸‹ä¹‹å¿§è€Œå¿§,åå¤©ä¸‹ä¹‹ä¹è€Œä¹;çˆ±ç¬‘çš„ä½ è¿æ°”ä¸€å®šä¸ä¼šå·®',';',temp.desc_index),';',1),'\"&#125;') as report_content from (select user_id, -FLOOR(rand()*7+1) as desc_index from data limit 100000) temp]]></content>
      <categories>
        <category>Mysql</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹ä¸­ä»‹è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F15%2Fdesign-pattern-mediator%2F</url>
    <content type="text"><![CDATA[ä¸­ä»‹è€…æ¨¡å¼ ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰æ˜¯ç”¨æ¥é™ä½å¤šä¸ªå¯¹è±¡å’Œç±»ä¹‹é—´çš„é€šä¿¡å¤æ‚æ€§ã€‚è¿™ç§æ¨¡å¼æä¾›äº†ä¸€ä¸ªä¸­ä»‹ç±»ï¼Œè¯¥ç±»é€šå¸¸å¤„ç†ä¸åŒç±»ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶æ”¯æŒæ¾è€¦åˆï¼Œä½¿ä»£ç æ˜“äºç»´æŠ¤ã€‚ä¸­ä»‹è€…æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚ é€šä¿—ç‚¹æ¥è®²å°±æ˜¯æä¾›ä¸€ä¸ªä¸­ä»‹å¹³å°ï¼Œè¯´åˆ°å¹³å°ï¼Œé‚£å…¶å®å¾ˆå®¹æ˜“è”ç³»åˆ°æˆ‘ä»¬å¾ˆç†Ÿæ‚‰çš„æˆ¿åœ°äº§ä¸­ä»‹ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡è¿™ä¸ªå¹³å°å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ä¿¡æ¯ï¼Œä¸ç”¨å¯¹è±¡è‡ªèº«ä¸å…¶ä»–å¯¹è±¡äº¤äº’ã€‚ ä¹°æˆ¿å­ç§Ÿæˆ¿å­å°±ä¸éœ€è¦å»æ‰¾æˆ¿ä¸œï¼Œåªéœ€è¦åœ¨ä¸­ä»‹é‚£é‡Œè·å–ç›¸åº”çš„æˆ¿äº§ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾é‚£æ ·ï¼Œä¸¤æ–¹åªéœ€è¦æ‰¾ä¸­ä»‹å³å¯ã€‚ å†æ¥çœ‹ä¸€å¼ å¯¹æ¯”å›¾ã€‚ æœ‰æ²¡æœ‰æ„Ÿè§‰æ²¡æœ‰ä½¿ç”¨ä¹‹å‰ï¼Œå¯¹è±¡é—´äº’ç›¸ä¾èµ–äº’ç›¸è°ƒç”¨ï¼Œé”™ç»¼å¤æ‚ï¼Œç›˜æ ¹é”™èŠ‚ï¼Œå½“åŠ å…¥ä¸­ä»‹è€…åï¼Œå¯¹è±¡é—´çš„å…³ç³»ä¸€ç›®äº†ç„¶ï¼Œæ¸…æ™°æ˜äº†ã€‚ç”±ä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—å¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»ã€‚ä¸­ä»‹è€…ä½¿å„ä¸ªå¯¹è±¡ä¹‹é—´ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿è€¦åˆæ€§é™ä½ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’è¡Œä¸ºã€‚ ä¸­ä»‹è€…æ¨¡å¼UMLå›¾UMLç±»å›¾å’Œæ—¶åºå›¾ collague1å’Œcollague2ç±»ä¸ç›´æ¥ç›¸äº’ä¾èµ–ï¼Œå®ƒä»¬æ˜¯ç”¨èµ·æ§åˆ¶å’Œåè°ƒäº¤äº’ä½œç”¨çš„å…¬å…±ä¸­ä»‹æ¥å£ï¼ˆmediateï¼ˆï¼‰æ–¹æ³•ï¼‰ï¼Œè¿™ä½¿å®ƒä»¬æœ‰ç‹¬ç«‹äº¤äº’çš„æ‰§è¡Œæ–¹å¼ã€‚mediate1ç±»å®ç°collague1å’Œcollague2ä¹‹é—´çš„ä¾èµ–ã€‚ ä¸­ä»‹è€…æ¨¡å¼è§’è‰² æŠ½è±¡ä¸­ä»‹è€…(Mediator): å®šä¹‰äº†åŒäº‹å¯¹è±¡åˆ°ä¸­ä»‹è€…å¯¹è±¡ä¹‹é—´çš„æ¥å£ã€‚ å…·ä½“ä¸­ä»‹è€…(ConcreteMediator): å®ç°æŠ½è±¡ä¸­ä»‹è€…çš„æ–¹æ³•ï¼Œå®ƒéœ€è¦çŸ¥é“æ‰€æœ‰çš„å…·ä½“åŒäº‹ç±»ï¼ŒåŒæ—¶éœ€è¦ä»å…·ä½“çš„åŒäº‹ç±»é‚£é‡Œæ¥æ”¶ä¿¡æ¯ï¼Œå¹¶ä¸”å‘å…·ä½“çš„åŒäº‹ç±»å‘é€ä¿¡æ¯ã€‚ æŠ½è±¡åŒäº‹ç±»(Colleague): å®šä¹‰äº†ä¸­ä»‹è€…å¯¹è±¡çš„æ¥å£ï¼Œå®ƒåªçŸ¥é“ä¸­ä»‹è€…è€Œä¸çŸ¥é“å…¶ä»–çš„åŒäº‹å¯¹è±¡ã€‚ å…·ä½“åŒäº‹ç±»(ConcreteColleague) : æ¯ä¸ªå…·ä½“åŒäº‹ç±»éƒ½åªéœ€è¦çŸ¥é“è‡ªå·±çš„è¡Œä¸ºå³å¯ï¼Œä½†æ˜¯ä»–ä»¬éƒ½éœ€è¦è®¤è¯†ä¸­ä»‹è€…ã€‚ ç¤ºä¾‹ä»£ç æºç åœ°å€ æŠ½è±¡ä¸­ä»‹è€… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152@Slf4jpublic abstract class Mediator &#123; /** * æˆ¿ä¸œmap */ protected Map&lt;People, Message&gt; landlordMap = Maps.newHashMap(); /** * ç§Ÿæˆ·åˆ—è¡¨ */ protected List&lt;People&gt; renterList = Lists.newArrayList(); /** * æ³¨å†Œæˆ¿ä¸œä¿¡æ¯ * * @param landlord æˆ¿ä¸œ * @param message æˆ¿å±‹ä¿¡æ¯ */ public void registerLandlord(People landlord, Message message) &#123; landlordMap.put(landlord, message); log.info("ä¸­ä»‹ä¿¡æ¯ï¼šæˆ¿ä¸œ|&#123;&#125;|åŠ å…¥åˆ°ä¸­ä»‹å¹³å°ï¼Œæˆ¿å±‹ä¿¡æ¯ï¼š&#123;&#125;", landlord.getName(), message); &#125; /** * å˜æ›´æˆ¿ä¸œä¿¡æ¯ * * @param landlord æˆ¿ä¸œ * @param message æˆ¿å±‹ä¿¡æ¯ */ protected void modifyLandlordInfo(People landlord, Message message) &#123; landlordMap.put(landlord, message); log.info("ä¸­ä»‹ä¿¡æ¯ï¼šæˆ¿ä¸œ|&#123;&#125;|ä¿®æ”¹ä»–åœ¨ä¸­ä»‹å¹³å°çš„æˆ¿å±‹ä¿¡æ¯ï¼Œç°æˆ¿å±‹ä¿¡æ¯ï¼š&#123;&#125;", landlord.getName(), message); &#125; /** * æ³¨å†Œç§Ÿæˆ·ä¿¡æ¯ * * @param renter ç§Ÿæˆ· */ public void registerRenter(People renter) &#123; renterList.add(renter); log.info("ä¸­ä»‹ä¿¡æ¯ï¼šç§Ÿæˆ·|&#123;&#125;|æ¥ä¸­ä»‹å¹³å°ç§Ÿæˆ¿", renter.getName()); &#125; /** * å£°æ˜æŠ½è±¡æ–¹æ³• ç”±å…·ä½“ä¸­ä»‹è€…å­ç±»å®ç° æ¶ˆæ¯çš„ä¸­è½¬å’Œåè°ƒ */ public abstract void operation(People people, Message message);&#125; æŠ½è±¡åŒäº‹ç±» 12345678910111213141516171819@Data@AllArgsConstructor@NoArgsConstructorpublic abstract class People &#123; private Mediator mediator; private String name; /** * å‘ä¸­ä»‹å‘é€æ¶ˆæ¯ */ protected abstract void sendMessage(Message message); /** * ä»ä¸­ä»‹è·å–æ¶ˆæ¯ */ protected abstract void getMessage(Message message);&#125; å…·ä½“åŒäº‹ç±» æˆ¿ä¸œå’Œç§Ÿæˆ· 1234567891011121314151617@Slf4jpublic class Landlord extends People &#123; public Landlord(Mediator mediator, String name) &#123; super(mediator, name); &#125; @Override protected void sendMessage(Message message) &#123; getMediator().operation(this, message); &#125; @Override protected void getMessage(Message message) &#123; log.info("æˆ¿ä¸œ|&#123;&#125;|ä»ä¸­ä»‹è·å–åˆ°ç§Ÿæˆ·çš„ä¿¡æ¯ï¼š&#123;&#125;", getName(), message); &#125;&#125; 1234567891011121314151617@Slf4jpublic class Renter extends People &#123; public Renter(Mediator mediator, String name) &#123; super(mediator, name); &#125; @Override protected void sendMessage(Message message) &#123; getMediator().operation(this, message); &#125; @Override protected void getMessage(Message message) &#123; log.info("ç§Ÿæˆ·|&#123;&#125;|ä»ä¸­ä»‹è·å–åˆ°æˆ¿ä¸œçš„ä¿¡æ¯ï¼š&#123;&#125;", getName(), message); &#125;&#125; å…·ä½“ä¸­ä»‹è€… 123456789101112131415161718public class RealEstateAgent extends Mediator &#123; @Override public void operation(People people, Message message) &#123; if (people instanceof Renter) &#123; // å°†ç§Ÿæˆ·çš„ç§Ÿæˆ¿æ¡ä»¶ä¿¡æ¯å‘é€ç»™æˆ¿ä¸œä»¬ landlordMap.keySet().forEach(landlord -&gt; landlord.getMessage(message)); // ç§Ÿæˆ·æ”¶åˆ°ä¸­ä»‹é‚£é‡Œæˆ¿ä¸œçš„æˆ¿å±‹ä¿¡æ¯ landlordMap.values().forEach(messages -&gt; people.getMessage(messages)); &#125; else if (people instanceof Landlord) &#123; // å°†æˆ¿ä¸œçš„æˆ¿å±‹ä¿¡æ¯å‘é€ç»™ç§Ÿæˆ·ä»¬ renterList.forEach(renter -&gt; renter.getMessage(message)); // å˜æ›´ä¸­ä»‹é‡Œçš„æˆ¿ä¸œæˆ¿å±‹ä¿¡æ¯ modifyLandlordInfo(people, message); &#125; &#125;&#125; å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930@Slf4jpublic class Client &#123; public static void main(String[] args) &#123; Mediator mediator = new RealEstateAgent(); People laoWang = new Landlord(mediator, "è€ç‹"); People laoLee = new Landlord(mediator, "è€æ"); People laoBai = new Landlord(mediator, "è€ç™½"); People xiaoSan = new Renter(mediator, "å°3"); People xiaoWang = new Renter(mediator, "å°ç‹"); mediator.registerLandlord(laoWang, Message.builder().msg("æˆ‘è¿™æœ‰2500çš„æˆ¿å­ï¼Œå¸‚ä¸­å¿ƒ").build()); mediator.registerLandlord(laoBai, Message.builder().msg("æˆ‘è¿™æœ‰2000çš„æˆ¿å­ï¼Œåœ°é“æ—").build()); mediator.registerLandlord(laoLee, Message.builder().msg("æˆ‘è¿™æœ‰2000çš„æˆ¿å­ï¼Œè½åœ°é˜³å°ï¼Œå¤§ç©ºé—´ï¼Œé‡‡å…‰å¥½ï¼Œåœ°é“æ—").build()); mediator.registerRenter(xiaoSan); log.info("å°3å¼€å§‹æ‰¾æˆ¿å­"); xiaoSan.sendMessage(Message.builder().msg("æƒ³æ‰¾ä¸ªæœˆç§Ÿ2000å—çš„æˆ¿å­ï¼Œé è¿‘åœ°é“").build()); log.info("æ²¡è¿‡å¤šä¹…---------è€ç™½å‡çº§äº†æˆ¿å±‹ä¿¡æ¯"); laoBai.sendMessage(Message.builder().msg("æˆ‘è¿™æœ‰2000çš„æˆ¿å­ï¼Œåœ°é“æ—ï¼Œæˆ‘åˆåŠ äº†ç©ºè°ƒå’Œçƒ­æ°´å™¨").build()); mediator.registerRenter(xiaoWang); log.info("å°ç‹å¼€å§‹æ‰¾æˆ¿å­"); xiaoWang.sendMessage(Message.builder().msg("æƒ³æ‰¾ä¸ªæœˆç§Ÿ2500å—çš„æˆ¿å­ï¼Œé è¿‘åœ°é“").build()); log.info("æ²¡è¿‡å¤šä¹…---------è€æä¹Ÿå‡çº§äº†æˆ¿å±‹ä¿¡æ¯"); laoBai.sendMessage(Message.builder().msg("æˆ‘è¿™æœ‰2000çš„æˆ¿å­ï¼Œè½åœ°é˜³å°ï¼Œå¤§ç©ºé—´ï¼Œé‡‡å…‰å¥½ï¼Œåœ°é“æ—ï¼Œæˆ‘ä¹ŸåŠ äº†ç©ºè°ƒå’Œçƒ­æ°´å™¨").build()); &#125;&#125; æœ€ç»ˆå‡ºæ•ˆæœçš„å¦‚ä¸‹ ç°åœ¨æˆ‘æ¥åˆ†æä¸‹é‡Œé¢å„ä¸ªè§’è‰²çš„ä½œç”¨ï¼š é¦–å…ˆå…ˆåˆ†æä¸¤ä¸ªæŠ½è±¡ç±»ã€‚æŠ½è±¡åŒäº‹ç±»ï¼Œå«æœ‰åç§°å’Œä¸­ä»‹è€…çš„å¼•ç”¨ï¼Œæœ‰2ä¸ªæ–¹æ³•ä»ä¸­ä»‹æ‹¿ä¿¡æ¯å’Œå‘ä¿¡æ¯ç»™ä¸­ä»‹ã€‚æŠ½è±¡ä¸­ä»‹è€…ï¼Œå…¶ä¸­å«æœ‰æˆ¿ä¸œçš„mapä¿¡æ¯ï¼Œkeyä¸ºæˆ¿ä¸œæ•°æ®ï¼Œvalueä¸ºæˆ¿ä¸œçš„æˆ¿å±‹ä¿¡æ¯ï¼Œç”¨æ¥æˆ¿ä¸œæ³¨å†Œå’Œæˆ¿ä¸œæˆ¿å±‹ä¿¡æ¯å˜æ›´ï¼›ç§Ÿæˆ·çš„åˆ—è¡¨ä¿¡æ¯ï¼Œä¾›ç§Ÿæˆ·æ³¨å†Œï¼ŒåŒæ—¶è¿˜æœ‰ä¸ªåè°ƒæ–¹æ³•ï¼Œç”¨äºåè°ƒæˆ¿ä¸œå’Œç§Ÿæˆ·ã€‚ å…·ä½“æŠ½è±¡ç±»ï¼ˆæˆ¿åœ°äº§ä¸­ä»‹ï¼‰ï¼Œå®ç°äº†æŠ½è±¡ä¸­ä»‹è€…çš„åè°ƒæ–¹æ³•ï¼Œå½“ç§Ÿæˆ·å‘é€æ¶ˆæ¯æ—¶ï¼Œå°†ç§Ÿæˆ·çš„ç§Ÿæˆ¿æ¡ä»¶ä¿¡æ¯å‘é€ç»™æ‰€æœ‰æˆ¿ä¸œä»¬åŒæ—¶è¯¥ç§Ÿæˆ·æ”¶åˆ°ä¸­ä»‹é‚£é‡Œæ‰€æœ‰æˆ¿ä¸œçš„æˆ¿å±‹ä¿¡æ¯ï¼›å½“æˆ¿ä¸œå‘é€æ¶ˆæ¯æ—¶ï¼Œå°†æˆ¿ä¸œçš„æˆ¿å±‹ä¿¡æ¯å‘é€ç»™æ‰€æœ‰ç§Ÿæˆ·ä»¬åŒæ—¶å˜æ›´ä¸­ä»‹é‡Œçš„æ”¹æˆ¿ä¸œæˆ¿å±‹ä¿¡æ¯ã€‚ å…·ä½“åŒäº‹å®ç°ç±»ï¼ˆæˆ¿ä¸œå’Œç§Ÿæˆ·ï¼‰ï¼Œå®ç°äº†æŠ½è±¡åŒäº‹ç±»çš„è¯»å–æ¶ˆæ¯æ–¹æ³•å’Œå‘é€æ¶ˆæ¯æ–¹æ³•ï¼ˆè¯¥æˆ¿å±‹å°±æ˜¯ä¾é ä¸­ä»‹è€…çš„åè°ƒæ–¹æ³•æ¥å®ç°ï¼‰ã€‚ JDKä¸­çš„åº”ç”¨é€šè¿‡ä½¿ç”¨ä¸€ä¸ªä¸­é—´å¯¹è±¡æ¥è¿›è¡Œæ¶ˆæ¯åˆ†å‘ä»¥åŠå‡å°‘ç±»ä¹‹é—´çš„ç›´æ¥ä¾èµ–ã€‚ java.util.Timer java.util.concurrent.Executor#execute() java.util.concurrent.ExecutorService#submit() java.lang.reflect.Method#invoke() æ€»ç»“ä¼˜ç‚¹ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼å¯ä»¥æŠŠå¯¹ä¸ªåŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢ï¼Œä»è€Œä½¿å¾—åŒäº‹å¯¹è±¡ä¹‹é—´æ¾æ•£è€¦åˆã€‚ä¸­ä»‹è€…æ¨¡å¼å¯ä»¥å°†åŸå…ˆå¤šå¯¹å¤šçš„åŒäº‹å¯¹è±¡å…³ç³»å˜æˆä¸­ä»‹è€…å¯¹è±¡ä¸€å¯¹å¤šåŒäº‹å¯¹è±¡çš„å…³ç³»ï¼Œè¿™æ ·ä¼šè®©å¯¹è±¡ä¹‹é—´çš„å…³ç³»æ›´å®¹æ˜“ç†è§£å’Œå®ç°ã€‚åŒäº‹å¯¹è±¡ä¹‹é—´çš„äº¤äº’éƒ½è¢«å°è£…åˆ°ä¸­ä»‹è€…å¯¹è±¡é‡Œé¢é›†ä¸­ç®¡ç†ï¼Œé›†ä¸­äº†æ§åˆ¶äº¤äº’ã€‚å½“äº¤äº’å‘ç”Ÿæ”¹å˜æ—¶ï¼Œç€é‡ä¿®æ”¹çš„æ˜¯ä¸­ä»‹è€…å¯¹è±¡ã€‚å½“éœ€è¦æ‰©å±•ä¸­ä»‹è€…å¯¹è±¡æ—¶ï¼Œå…¶ä»–åŒäº‹å¯¹è±¡ä¸éœ€è¦åšä¿®æ”¹ã€‚ ç¼ºç‚¹å¦‚æœåŒäº‹å¯¹è±¡å¤šäº†ï¼Œäº¤äº’ä¹Ÿå¤æ‚äº†ã€‚ä¸­ä»‹è€…ä¼šåºå¤§ï¼Œå˜å¾—å¤æ‚éš¾ä»¥ç»´æŠ¤ã€‚ å‚è€ƒä¸­ä»‹è€…æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Mediator pattern ç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼ JAVAè®¾è®¡æ¨¡å¼ä¹‹ ä¸­ä»‹è€…æ¨¡å¼ã€Mediator Patternã€‘]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>ä¸­ä»‹è€…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œå·´å·´å¼€æºåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ FESCARã€è½¬ã€‘]]></title>
    <url>%2F2019%2F01%2F13%2Ffescar%2F</url>
    <content type="text"><![CDATA[å¶ç„¶é—´çœ‹åˆ°é˜¿é‡Œå¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼ŒæœŸå¾…æœ‰æŠ•å…¥åˆ°ç”Ÿäº§é˜¶æ®µçš„æ —å­ã€‚ä»è“å›¾ä¸Šçœ‹å‡ºç›®å‰æœ‰æ”¯æŒdubboçš„è§£å†³æ–¹æ¡ˆï¼Œåç»­0.5.xç‰ˆæœ¬ä¼šæ¨å‡ºæ”¯æŒspring cloudçš„æ–¹æ¡ˆã€‚ ä¸‹é¢çœ‹å®˜æ–¹æ­£æ–‡ï¼Œå–œæ¬¢çš„å¯ä»¥å»å®˜æ–¹Githubä¸Šç§ç§çœ‹çœ‹ã€‚ Fescar æ˜¯ é˜¿é‡Œå·´å·´ å¼€æºçš„ åˆ†å¸ƒå¼äº‹åŠ¡ä¸­é—´ä»¶ï¼Œä»¥ é«˜æ•ˆ å¹¶ä¸”å¯¹ä¸šåŠ¡ 0 ä¾µå…¥ çš„æ–¹å¼ï¼Œè§£å†³ å¾®æœåŠ¡ åœºæ™¯ä¸‹é¢ä¸´çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ 1. ä»€ä¹ˆæ˜¯å¾®æœåŠ¡åŒ–å¸¦æ¥çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ï¼Ÿé¦–å…ˆï¼Œè®¾æƒ³ä¸€ä¸ªä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼ˆMonolithic Appï¼‰ï¼Œé€šè¿‡ 3 ä¸ª Moduleï¼Œåœ¨åŒä¸€ä¸ªæ•°æ®æºä¸Šæ›´æ–°æ•°æ®æ¥å®Œæˆä¸€é¡¹ä¸šåŠ¡ã€‚ å¾ˆè‡ªç„¶çš„ï¼Œæ•´ä¸ªä¸šåŠ¡è¿‡ç¨‹çš„æ•°æ®ä¸€è‡´æ€§ç”±æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚ éšç€ä¸šåŠ¡éœ€æ±‚å’Œæ¶æ„çš„å˜åŒ–ï¼Œå•ä½“åº”ç”¨è¢«æ‹†åˆ†ä¸ºå¾®æœåŠ¡ï¼šåŸæ¥çš„ 3 ä¸ª Module è¢«æ‹†åˆ†ä¸º 3 ä¸ªç‹¬ç«‹çš„æœåŠ¡ï¼Œåˆ†åˆ«ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®æºï¼ˆPattern: Database per serviceï¼‰ã€‚ä¸šåŠ¡è¿‡ç¨‹å°†ç”± 3 ä¸ªæœåŠ¡çš„è°ƒç”¨æ¥å®Œæˆã€‚ æ­¤æ—¶ï¼Œæ¯ä¸€ä¸ªæœåŠ¡å†…éƒ¨çš„æ•°æ®ä¸€è‡´æ€§ä»æœ‰æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯ã€‚è€Œæ•´ä¸ªä¸šåŠ¡å±‚é¢çš„å…¨å±€æ•°æ®ä¸€è‡´æ€§è¦å¦‚ä½•ä¿éšœå‘¢ï¼Ÿè¿™å°±æ˜¯å¾®æœåŠ¡æ¶æ„ä¸‹é¢ä¸´çš„ï¼Œå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡éœ€æ±‚ï¼šæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„è§£å†³æ–¹æ¡ˆä¿éšœä¸šåŠ¡å…¨å±€çš„æ•°æ®ä¸€è‡´æ€§ã€‚ 2. Fescar çš„å‘å±•å†ç¨‹é˜¿é‡Œæ˜¯å›½å†…æœ€æ—©ä¸€æ‰¹è¿›è¡Œåº”ç”¨åˆ†å¸ƒå¼ï¼ˆå¾®æœåŠ¡åŒ–ï¼‰æ”¹é€ çš„ä¼ä¸šï¼Œæ‰€ä»¥å¾ˆæ—©å°±é‡åˆ°å¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚ 2014 å¹´ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘å¸ƒ TXCï¼ˆTaobao Transaction Constructorï¼‰ï¼Œä¸ºé›†å›¢å†…åº”ç”¨æä¾›åˆ†å¸ƒå¼äº‹åŠ¡æœåŠ¡ã€‚ 2016 å¹´ï¼ŒTXC ç»è¿‡äº§å“åŒ–æ”¹é€ ï¼Œä»¥ GTSï¼ˆGlobal Transaction Serviceï¼‰çš„èº«ä»½ç™»é™†é˜¿é‡Œäº‘ï¼Œæˆä¸ºå½“æ—¶ä¸šç•Œå”¯ä¸€ä¸€æ¬¾äº‘ä¸Šåˆ†å¸ƒå¼äº‹åŠ¡äº§å“ï¼Œåœ¨é˜¿äº‘é‡Œçš„å…¬æœ‰äº‘ã€ä¸“æœ‰äº‘è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¼€å§‹æœåŠ¡äºä¼—å¤šå¤–éƒ¨å®¢æˆ·ã€‚ 2019 å¹´èµ·ï¼ŒåŸºäº TXC å’Œ GTS çš„æŠ€æœ¯ç§¯ç´¯ï¼Œé˜¿é‡Œä¸­é—´ä»¶å›¢é˜Ÿå‘èµ·äº†å¼€æºé¡¹ç›® Fescarï¼ˆFast &amp; EaSy Commit And Rollback, FESCARï¼‰ï¼Œå’Œç¤¾åŒºä¸€èµ·å»ºè®¾è¿™ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚ TXC/GTS/Fescar ä¸€è„‰ç›¸æ‰¿ï¼Œä¸ºè§£å†³å¾®æœåŠ¡æ¶æ„ä¸‹çš„åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜äº¤å‡ºäº†ä¸€ä»½ä¸ä¼—ä¸åŒçš„ç­”å·ã€‚ 2.1 è®¾è®¡åˆè¡·é«˜é€Ÿå¢é•¿çš„äº’è”ç½‘æ—¶ä»£ï¼Œå¿«é€Ÿè¯•é”™ çš„èƒ½åŠ›å¯¹ä¸šåŠ¡æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼š ä¸€æ–¹é¢ï¼Œä¸åº”è¯¥å› ä¸ºæŠ€æœ¯æ¶æ„ä¸Šçš„å¾®æœåŠ¡åŒ–å’Œåˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„å¼•å…¥ï¼Œç»™ä¸šåŠ¡å±‚é¢å¸¦æ¥é¢å¤–çš„ç ”å‘è´Ÿæ‹…ã€‚ å¦ä¸€æ–¹é¢ï¼Œå¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡æ”¯æŒçš„ä¸šåŠ¡åº”è¯¥åŸºæœ¬ä¿æŒåœ¨åŒä¸€é‡çº§ä¸Šçš„æ€§èƒ½è¡¨ç°ï¼Œä¸èƒ½å› ä¸ºäº‹åŠ¡æœºåˆ¶æ˜¾è‘—æ‹–æ…¢ä¸šåŠ¡ã€‚ åŸºäºè¿™ä¸¤ç‚¹ï¼Œæˆ‘ä»¬è®¾è®¡ä¹‹åˆçš„æœ€é‡è¦çš„è€ƒé‡å°±åœ¨äºï¼š å¯¹ä¸šåŠ¡æ— ä¾µå…¥ï¼š è¿™é‡Œçš„ ä¾µå…¥ æ˜¯æŒ‡ï¼Œå› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡è¿™ä¸ªæŠ€æœ¯é—®é¢˜çš„åˆ¶çº¦ï¼Œè¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢è¿›è¡Œè®¾è®¡å’Œæ”¹é€ ã€‚è¿™ç§è®¾è®¡å’Œæ”¹é€ å¾€å¾€ä¼šç»™åº”ç”¨å¸¦æ¥å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜åœ¨ ä¸­é—´ä»¶ è¿™ä¸ªå±‚æ¬¡è§£å†³æ‰ï¼Œä¸è¦æ±‚åº”ç”¨åœ¨ä¸šåŠ¡å±‚é¢åšé¢å¤–çš„å·¥ä½œã€‚ é«˜æ€§èƒ½ï¼š å¼•å…¥åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¿éšœï¼Œå¿…ç„¶ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå¼•èµ·æ€§èƒ½çš„ä¸‹é™ã€‚æˆ‘ä»¬å¸Œæœ›æŠŠåˆ†å¸ƒå¼äº‹åŠ¡å¼•å…¥çš„æ€§èƒ½æŸè€—é™åˆ°éå¸¸ä½çš„æ°´å¹³ï¼Œè®©åº”ç”¨ä¸å› ä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„å¼•å…¥å¯¼è‡´ä¸šåŠ¡çš„å¯ç”¨æ€§å—å½±å“ã€‚ 2.2 æ—¢æœ‰çš„è§£å†³æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸æ»¡è¶³ï¼Ÿæ—¢æœ‰çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæŒ‰ç…§å¯¹ä¸šåŠ¡ä¾µå…¥æ€§åˆ†ä¸ºä¸¤ç±»ï¼Œå³ï¼šå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„å’Œå¯¹ä¸šåŠ¡æœ‰ä¾µå…¥çš„ã€‚ ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆæ—¢æœ‰çš„ä¸»æµåˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸­ï¼Œå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„åªæœ‰åŸºäº XA çš„æ–¹æ¡ˆï¼Œä½†åº”ç”¨ XA æ–¹æ¡ˆå­˜åœ¨ 3 ä¸ªæ–¹é¢çš„é—®é¢˜ï¼š è¦æ±‚æ•°æ®åº“æä¾›å¯¹ XA çš„æ”¯æŒã€‚å¦‚æœé‡åˆ°ä¸æ”¯æŒ XAï¼ˆæˆ–æ”¯æŒå¾—ä¸å¥½ï¼Œæ¯”å¦‚ MySQL 5.7 ä»¥å‰çš„ç‰ˆæœ¬ï¼‰çš„æ•°æ®åº“ï¼Œåˆ™ä¸èƒ½ä½¿ç”¨ã€‚ å—åè®®æœ¬èº«çš„çº¦æŸï¼Œäº‹åŠ¡èµ„æºçš„é”å®šå‘¨æœŸé•¿ã€‚é•¿å‘¨æœŸçš„èµ„æºé”å®šä»ä¸šåŠ¡å±‚é¢æ¥çœ‹ï¼Œå¾€å¾€æ˜¯ä¸å¿…è¦çš„ï¼Œè€Œå› ä¸ºäº‹åŠ¡èµ„æºçš„ç®¡ç†å™¨æ˜¯æ•°æ®åº“æœ¬èº«ï¼Œåº”ç”¨å±‚æ— æ³•æ’æ‰‹ã€‚è¿™æ ·å½¢æˆçš„å±€é¢å°±æ˜¯ï¼ŒåŸºäº XA çš„åº”ç”¨å¾€å¾€æ€§èƒ½ä¼šæ¯”è¾ƒå·®ï¼Œè€Œä¸”å¾ˆéš¾ä¼˜åŒ–ã€‚ å·²ç»è½åœ°çš„åŸºäº XA çš„åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆï¼Œéƒ½ä¾æ‰˜äºé‡é‡çº§çš„åº”ç”¨æœåŠ¡å™¨ï¼ˆTuxedo/WebLogic/WebSphere ç­‰)ï¼Œè¿™æ˜¯ä¸é€‚ç”¨äºå¾®æœåŠ¡æ¶æ„çš„ã€‚ ä¾µå…¥ä¸šåŠ¡çš„æ–¹æ¡ˆå®é™…ä¸Šï¼Œæœ€åˆåˆ†å¸ƒå¼äº‹åŠ¡åªæœ‰ XA è¿™ä¸ªå”¯ä¸€æ–¹æ¡ˆã€‚XA æ˜¯å®Œå¤‡çš„ï¼Œä½†åœ¨å®è·µè¿‡ç¨‹ä¸­ï¼Œç”±äºç§ç§åŸå› ï¼ˆåŒ…å«ä½†ä¸é™äºä¸Šé¢æåˆ°çš„ 3 ç‚¹ï¼‰å¾€å¾€ä¸å¾—ä¸æ”¾å¼ƒï¼Œè½¬è€Œä»ä¸šåŠ¡å±‚é¢ç€æ‰‹æ¥è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜ã€‚æ¯”å¦‚ï¼š åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆ TCC Saga éƒ½å±äºè¿™ä¸€ç±»ã€‚è¿™äº›æ–¹æ¡ˆçš„å…·ä½“æœºåˆ¶åœ¨è¿™é‡Œä¸åšå±•å¼€ï¼Œç½‘ä¸Šè¿™æ–¹é¢çš„è®ºè¿°æ–‡ç« éå¸¸å¤šã€‚æ€»ä¹‹ï¼Œè¿™äº›æ–¹æ¡ˆéƒ½è¦æ±‚åœ¨åº”ç”¨çš„ä¸šåŠ¡å±‚é¢æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æŠ€æœ¯çº¦æŸè€ƒè™‘åˆ°è®¾è®¡ä¸­ï¼Œé€šå¸¸æ¯ä¸€ä¸ªæœåŠ¡éƒ½éœ€è¦è®¾è®¡å®ç°æ­£å‘å’Œåå‘çš„å¹‚ç­‰æ¥å£ã€‚è¿™æ ·çš„è®¾è®¡çº¦æŸï¼Œå¾€å¾€ä¼šå¯¼è‡´å¾ˆé«˜çš„ç ”å‘å’Œç»´æŠ¤æˆæœ¬ã€‚ 2.3 ç†æƒ³çš„æ–¹æ¡ˆåº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­ï¼Ÿä¸å¯å¦è®¤ï¼Œä¾µå…¥ä¸šåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆéƒ½ç»è¿‡å¤§é‡å®è·µéªŒè¯ï¼Œèƒ½æœ‰æ•ˆè§£å†³é—®é¢˜ï¼Œåœ¨å„è¡Œç§ä¸šçš„ä¸šåŠ¡åº”ç”¨ç³»ç»Ÿä¸­èµ·ç€é‡è¦ä½œç”¨ã€‚ä½†å›åˆ°åŸç‚¹æ¥æ€è€ƒï¼Œè¿™äº›æ–¹æ¡ˆçš„é‡‡ç”¨å®é™…ä¸Šéƒ½æ˜¯ è¿«äºæ— å¥ˆã€‚è®¾æƒ³ï¼Œå¦‚æœåŸºäº XA çš„æ–¹æ¡ˆèƒ½å¤Ÿä¸é‚£ä¹ˆ é‡ï¼Œå¹¶ä¸”èƒ½ä¿è¯ä¸šåŠ¡çš„æ€§èƒ½éœ€æ±‚ï¼Œç›¸ä¿¡ä¸ä¼šæœ‰äººæ„¿æ„æŠŠåˆ†å¸ƒå¼äº‹åŠ¡é—®é¢˜æ‹¿åˆ°ä¸šåŠ¡å±‚é¢æ¥è§£å†³ã€‚ ä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆåº”è¯¥ï¼šåƒä½¿ç”¨ æœ¬åœ°äº‹åŠ¡ ä¸€æ ·ç®€å•ï¼Œä¸šåŠ¡é€»è¾‘åªå…³æ³¨ä¸šåŠ¡å±‚é¢çš„éœ€æ±‚ï¼Œä¸éœ€è¦è€ƒè™‘äº‹åŠ¡æœºåˆ¶ä¸Šçš„çº¦æŸã€‚ 3. åŸç†å’Œè®¾è®¡æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„æ–¹æ¡ˆï¼Œæ‰€ä»¥ä»ä¸šåŠ¡æ— ä¾µå…¥çš„ XA æ–¹æ¡ˆæ¥æ€è€ƒï¼š æ˜¯å¦å¯ä»¥åœ¨ XA çš„åŸºç¡€ä¸Šæ¼”è¿›ï¼Œè§£å†³æ‰ XA æ–¹æ¡ˆé¢ä¸´çš„é—®é¢˜å‘¢ï¼Ÿ 3.1 å¦‚ä½•å®šä¹‰ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿé¦–å…ˆï¼Œå¾ˆè‡ªç„¶çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡ç†è§£æˆä¸€ä¸ªåŒ…å«äº†è‹¥å¹² åˆ†æ”¯äº‹åŠ¡ çš„ å…¨å±€äº‹åŠ¡ã€‚å…¨å±€äº‹åŠ¡ çš„èŒè´£æ˜¯åè°ƒå…¶ä¸‹ç®¡è¾–çš„ åˆ†æ”¯äº‹åŠ¡ è¾¾æˆä¸€è‡´ï¼Œè¦ä¹ˆä¸€èµ·æˆåŠŸæäº¤ï¼Œè¦ä¹ˆä¸€èµ·å¤±è´¥å›æ»šã€‚æ­¤å¤–ï¼Œé€šå¸¸ åˆ†æ”¯äº‹åŠ¡ æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ»¡è¶³ ACID çš„ æœ¬åœ°äº‹åŠ¡ã€‚è¿™æ˜¯æˆ‘ä»¬å¯¹åˆ†å¸ƒå¼äº‹åŠ¡ç»“æ„çš„åŸºæœ¬è®¤è¯†ï¼Œä¸ XA æ˜¯ä¸€è‡´çš„ã€‚ å…¶æ¬¡ï¼Œä¸ XA çš„æ¨¡å‹ç±»ä¼¼ï¼Œæˆ‘ä»¬å®šä¹‰ 3 ä¸ªç»„ä»¶æ¥åè®®åˆ†å¸ƒå¼äº‹åŠ¡çš„å¤„ç†è¿‡ç¨‹ã€‚ Transaction Coordinator (TC)ï¼š äº‹åŠ¡åè°ƒå™¨ï¼Œç»´æŠ¤å…¨å±€äº‹åŠ¡çš„è¿è¡ŒçŠ¶æ€ï¼Œè´Ÿè´£åè°ƒå¹¶é©±åŠ¨å…¨å±€äº‹åŠ¡çš„æäº¤æˆ–å›æ»šã€‚ Transaction Manager (TM)ï¼š æ§åˆ¶å…¨å±€äº‹åŠ¡çš„è¾¹ç•Œï¼Œè´Ÿè´£å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå¹¶æœ€ç»ˆå‘èµ·å…¨å±€æäº¤æˆ–å…¨å±€å›æ»šçš„å†³è®®ã€‚ Resource Manager (RM)ï¼š æ§åˆ¶åˆ†æ”¯äº‹åŠ¡ï¼Œè´Ÿè´£åˆ†æ”¯æ³¨å†Œã€çŠ¶æ€æ±‡æŠ¥ï¼Œå¹¶æ¥æ”¶äº‹åŠ¡åè°ƒå™¨çš„æŒ‡ä»¤ï¼Œé©±åŠ¨åˆ†æ”¯ï¼ˆæœ¬åœ°ï¼‰äº‹åŠ¡çš„æäº¤å’Œå›æ»šã€‚ ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹ï¼š TM å‘ TC ç”³è¯·å¼€å¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡ï¼Œå…¨å±€äº‹åŠ¡åˆ›å»ºæˆåŠŸå¹¶ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ XIDã€‚ XID åœ¨å¾®æœåŠ¡è°ƒç”¨é“¾è·¯çš„ä¸Šä¸‹æ–‡ä¸­ä¼ æ’­ã€‚ RM å‘ TC æ³¨å†Œåˆ†æ”¯äº‹åŠ¡ï¼Œå°†å…¶çº³å…¥ XID å¯¹åº”å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚ TM å‘ TC å‘èµ·é’ˆå¯¹ XID çš„å…¨å±€æäº¤æˆ–å›æ»šå†³è®®ã€‚ TC è°ƒåº¦ XID ä¸‹ç®¡è¾–çš„å…¨éƒ¨åˆ†æ”¯äº‹åŠ¡å®Œæˆæäº¤æˆ–å›æ»šè¯·æ±‚ã€‚ è‡³æ­¤ï¼ŒFescar çš„åè®®æœºåˆ¶æ€»ä½“ä¸Šçœ‹ä¸ XA æ˜¯ä¸€è‡´çš„ã€‚ 3.2 ä¸ XA çš„å·®åˆ«åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿæ¶æ„å±‚æ¬¡ XA æ–¹æ¡ˆçš„ RM å®é™…ä¸Šæ˜¯åœ¨æ•°æ®åº“å±‚ï¼ŒRM æœ¬è´¨ä¸Šå°±æ˜¯æ•°æ®åº“è‡ªèº«ï¼ˆé€šè¿‡æä¾›æ”¯æŒ XA çš„é©±åŠ¨ç¨‹åºæ¥ä¾›åº”ç”¨ä½¿ç”¨ï¼‰ã€‚ è€Œ Fescar çš„ RM æ˜¯ä»¥äºŒæ–¹åŒ…çš„å½¢å¼ä½œä¸ºä¸­é—´ä»¶å±‚éƒ¨ç½²åœ¨åº”ç”¨ç¨‹åºè¿™ä¸€ä¾§çš„ï¼Œä¸ä¾èµ–ä¸æ•°æ®åº“æœ¬èº«å¯¹åè®®çš„æ”¯æŒï¼Œå½“ç„¶ä¹Ÿä¸éœ€è¦æ•°æ®åº“æ”¯æŒ XA åè®®ã€‚è¿™ç‚¹å¯¹äºå¾®æœåŠ¡åŒ–çš„æ¶æ„æ¥è¯´æ˜¯éå¸¸é‡è¦çš„ï¼šåº”ç”¨å±‚ä¸éœ€è¦ä¸ºæœ¬åœ°äº‹åŠ¡å’Œåˆ†å¸ƒå¼äº‹åŠ¡ä¸¤ç±»ä¸åŒåœºæ™¯æ¥é€‚é…ä¸¤å¥—ä¸åŒçš„æ•°æ®åº“é©±åŠ¨ã€‚ è¿™ä¸ªè®¾è®¡ï¼Œå‰¥ç¦»äº†åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå¯¹æ•°æ®åº“åœ¨ åè®®æ”¯æŒ ä¸Šçš„è¦æ±‚ã€‚ ä¸¤é˜¶æ®µæäº¤å…ˆæ¥çœ‹ä¸€ä¸‹ XA çš„ 2PC è¿‡ç¨‹ã€‚ æ— è®º Phase2 çš„å†³è®®æ˜¯ commit è¿˜æ˜¯ rollbackï¼Œäº‹åŠ¡æ€§èµ„æºçš„é”éƒ½è¦ä¿æŒåˆ° Phase2 å®Œæˆæ‰é‡Šæ”¾ã€‚ è®¾æƒ³ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ä¸šåŠ¡ï¼Œå¤§æ¦‚ç‡æ˜¯ 90% ä»¥ä¸Šçš„äº‹åŠ¡æœ€ç»ˆåº”è¯¥æ˜¯æˆåŠŸæäº¤çš„ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥åœ¨ Phase1 å°±å°†æœ¬åœ°äº‹åŠ¡æäº¤å‘¢ï¼Ÿè¿™æ · 90% ä»¥ä¸Šçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœå» Phase2 æŒé”çš„æ—¶é—´ï¼Œæ•´ä½“æé«˜æ•ˆç‡ã€‚ è¿™ä¸ªè®¾è®¡ï¼Œåœ¨ç»å¤§å¤šæ•°åœºæ™¯å‡å°‘äº†äº‹åŠ¡æŒé”æ—¶é—´ï¼Œä»è€Œæé«˜äº†äº‹åŠ¡çš„å¹¶å‘åº¦ã€‚ å½“ç„¶ï¼Œä½ è‚¯å®šä¼šé—®ï¼šPhase1 å³æäº¤çš„æƒ…å†µä¸‹ï¼ŒPhase2 å¦‚ä½•å›æ»šå‘¢ï¼Ÿ 3.3 åˆ†æ”¯äº‹åŠ¡å¦‚ä½•æäº¤å’Œå›æ»šï¼Ÿé¦–å…ˆï¼Œåº”ç”¨éœ€è¦ä½¿ç”¨ Fescar çš„ JDBC æ•°æ®æºä»£ç†ï¼Œä¹Ÿå°±æ˜¯ Fescar çš„ RMã€‚ Phase1ï¼š Fescar çš„ JDBC æ•°æ®æºä»£ç†é€šè¿‡å¯¹ä¸šåŠ¡ SQL çš„è§£æï¼ŒæŠŠä¸šåŠ¡æ•°æ®åœ¨æ›´æ–°å‰åçš„æ•°æ®é•œåƒç»„ç»‡æˆå›æ»šæ—¥å¿—ï¼Œåˆ©ç”¨ æœ¬åœ°äº‹åŠ¡ çš„ ACID ç‰¹æ€§ï¼Œå°†ä¸šåŠ¡æ•°æ®çš„æ›´æ–°å’Œå›æ»šæ—¥å¿—çš„å†™å…¥åœ¨åŒä¸€ä¸ª æœ¬åœ°äº‹åŠ¡ ä¸­æäº¤ã€‚ è¿™æ ·ï¼Œå¯ä»¥ä¿è¯ï¼šä»»ä½•æäº¤çš„ä¸šåŠ¡æ•°æ®çš„æ›´æ–°ä¸€å®šæœ‰ç›¸åº”çš„å›æ»šæ—¥å¿—å­˜åœ¨ã€‚ åŸºäºè¿™æ ·çš„æœºåˆ¶ï¼Œåˆ†æ”¯çš„æœ¬åœ°äº‹åŠ¡ä¾¿å¯ä»¥åœ¨å…¨å±€äº‹åŠ¡çš„ Phase1 æäº¤ï¼Œé©¬ä¸Šé‡Šæ”¾æœ¬åœ°äº‹åŠ¡é”å®šçš„èµ„æºã€‚ Phase2ï¼š å¦‚æœå†³è®®æ˜¯å…¨å±€æäº¤ï¼Œæ­¤æ—¶åˆ†æ”¯äº‹åŠ¡æ­¤æ—¶å·²ç»å®Œæˆæäº¤ï¼Œä¸éœ€è¦åŒæ­¥åè°ƒå¤„ç†ï¼ˆåªéœ€è¦å¼‚æ­¥æ¸…ç†å›æ»šæ—¥å¿—ï¼‰ï¼ŒPhase2 å¯ä»¥éå¸¸å¿«é€Ÿåœ°å®Œæˆã€‚ å¦‚æœå†³è®®æ˜¯å…¨å±€å›æ»šï¼ŒRM æ”¶åˆ°åè°ƒå™¨å‘æ¥çš„å›æ»šè¯·æ±‚ï¼Œé€šè¿‡ XID å’Œ Branch ID æ‰¾åˆ°ç›¸åº”çš„å›æ»šæ—¥å¿—è®°å½•ï¼Œé€šè¿‡å›æ»šè®°å½•ç”Ÿæˆåå‘çš„æ›´æ–° SQL å¹¶æ‰§è¡Œï¼Œä»¥å®Œæˆåˆ†æ”¯çš„å›æ»šã€‚ 3.4 äº‹åŠ¡ä¼ æ’­æœºåˆ¶XID æ˜¯ä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†ï¼Œäº‹åŠ¡ä¼ æ’­æœºåˆ¶è¦åšçš„å°±æ˜¯æŠŠ XID åœ¨æœåŠ¡è°ƒç”¨é“¾è·¯ä¸­ä¼ é€’ä¸‹å»ï¼Œå¹¶ç»‘å®šåˆ°æœåŠ¡çš„äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™æ ·ï¼ŒæœåŠ¡é“¾è·¯ä¸­çš„æ•°æ®åº“æ›´æ–°æ“ä½œï¼Œå°±éƒ½ä¼šå‘è¯¥ XID ä»£è¡¨çš„å…¨å±€äº‹åŠ¡æ³¨å†Œåˆ†æ”¯ï¼Œçº³å…¥åŒä¸€ä¸ªå…¨å±€äº‹åŠ¡çš„ç®¡è¾–ã€‚ åŸºäºè¿™ä¸ªæœºåˆ¶ï¼ŒFescar æ˜¯å¯ä»¥æ”¯æŒä»»ä½•å¾®æœåŠ¡ RPC æ¡†æ¶çš„ã€‚åªè¦åœ¨ç‰¹å®šæ¡†æ¶ä¸­æ‰¾åˆ°å¯ä»¥é€æ˜ä¼ æ’­ XID çš„æœºåˆ¶å³å¯ï¼Œæ¯”å¦‚ï¼ŒDubbo çš„ Filter + RpcContextã€‚ å¯¹åº”åˆ° Java EE è§„èŒƒå’Œ Spring å®šä¹‰çš„äº‹åŠ¡ä¼ æ’­å±æ€§ï¼ŒFescar çš„æ”¯æŒå¦‚ä¸‹ï¼š PROPAGATION_REQUIREDï¼š é»˜è®¤æ”¯æŒ PROPAGATION_SUPPORTSï¼š é»˜è®¤æ”¯æŒ PROPAGATION_MANDATORYï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç° PROPAGATION_REQUIRES_NEWï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç° PROPAGATION_NOT_SUPPORTEDï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç° PROPAGATION_NEVERï¼šåº”ç”¨é€šè¿‡ API æ¥å®ç° PROPAGATION_REQUIRED_NESTEDï¼šä¸æ”¯æŒ 3.5 éš”ç¦»æ€§å…¨å±€äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯å»ºç«‹åœ¨åˆ†æ”¯äº‹åŠ¡çš„æœ¬åœ°éš”ç¦»çº§åˆ«åŸºç¡€ä¹‹ä¸Šçš„ã€‚ åœ¨æ•°æ®åº“æœ¬åœ°éš”ç¦»çº§åˆ« è¯»å·²æäº¤ æˆ–ä»¥ä¸Šçš„å‰æä¸‹ï¼ŒFescar è®¾è®¡äº†ç”±äº‹åŠ¡åè°ƒå™¨ç»´æŠ¤çš„ å…¨å±€å†™æ’ä»–é”ï¼Œæ¥ä¿è¯äº‹åŠ¡é—´çš„ å†™éš”ç¦»ï¼Œå°†å…¨å±€äº‹åŠ¡é»˜è®¤å®šä¹‰åœ¨ è¯»æœªæäº¤ çš„éš”ç¦»çº§åˆ«ä¸Šã€‚ æˆ‘ä»¬å¯¹éš”ç¦»çº§åˆ«çš„å…±è¯†æ˜¯ï¼šç»å¤§éƒ¨åˆ†åº”ç”¨åœ¨ è¯»å·²æäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹å·¥ä½œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è€Œå®é™…ä¸Šï¼Œè¿™å½“ä¸­åˆæœ‰ç»å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯ï¼Œå®é™…ä¸Šå·¥ä½œåœ¨ è¯»æœªæäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹åŒæ ·æ²¡æœ‰é—®é¢˜ã€‚ åœ¨æç«¯åœºæ™¯ä¸‹ï¼Œåº”ç”¨å¦‚æœéœ€è¦è¾¾åˆ°å…¨å±€çš„ è¯»å·²æäº¤ï¼ŒFescar ä¹Ÿæä¾›äº†ç›¸åº”çš„æœºåˆ¶æ¥è¾¾åˆ°ç›®çš„ã€‚é»˜è®¤ï¼ŒFescar æ˜¯å·¥ä½œåœ¨ è¯»æ— æäº¤ çš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¿è¯ç»å¤§å¤šæ•°åœºæ™¯çš„é«˜æ•ˆæ€§ã€‚ äº‹åŠ¡çš„ ACID å±æ€§åœ¨ Fescar ä¸­çš„ä½“ç°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¯é¢˜ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸“é—¨çš„æ–‡ç« æ¥æ·±å…¥åˆ†æï¼Œè¿™é‡Œä¸åšè¿›ä¸€æ­¥å±•å¼€ã€‚ 4. é€‚ç”¨åœºæ™¯åˆ†æå‰æ–‡æ‰€è¿°çš„ Fescar çš„æ ¸å¿ƒåŸç†ä¸­æœ‰ä¸€ä¸ª é‡è¦å‰æï¼šåˆ†æ”¯äº‹åŠ¡ä¸­æ¶‰åŠçš„èµ„æºï¼Œå¿…é¡» æ˜¯æ”¯æŒ ACID äº‹åŠ¡çš„ å…³ç³»å‹æ•°æ®åº“ã€‚åˆ†æ”¯çš„æäº¤å’Œå›æ»šæœºåˆ¶ï¼Œéƒ½ä¾èµ–äºæœ¬åœ°äº‹åŠ¡çš„ä¿éšœã€‚æ‰€ä»¥ï¼Œå¦‚æœåº”ç”¨ä½¿ç”¨çš„æ•°æ®åº“æ˜¯ä¸æ”¯æŒäº‹åŠ¡çš„ï¼Œæˆ–æ ¹æœ¬ä¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼Œå°±ä¸é€‚ç”¨ã€‚ å¦å¤–ï¼Œç›®å‰ Fescar çš„å®ç°è¿˜å­˜åœ¨ä¸€äº›å±€é™ï¼Œæ¯”å¦‚ï¼šäº‹åŠ¡éš”ç¦»çº§åˆ«æœ€é«˜æ”¯æŒåˆ° è¯»å·²æäº¤ çš„æ°´å¹³ï¼ŒSQL çš„è§£æè¿˜ä¸èƒ½æ¶µç›–å…¨éƒ¨çš„è¯­æ³•ç­‰ã€‚ ä¸ºäº†è¦†ç›– Fescar åŸç”Ÿæœºåˆ¶æš‚æ—¶ä¸èƒ½æ”¯æŒåº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å®šä¹‰äº†å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ã€‚ ä¸Šé¢ä»‹ç»çš„ Fescar åŸç”Ÿå·¥ä½œæ¨¡å¼ç§°ä¸º ATï¼ˆAutomatic Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼æ˜¯å¯¹ä¸šåŠ¡æ— ä¾µå…¥çš„ã€‚ä¸ä¹‹ç›¸åº”çš„å¦å¤–ä¸€ç§å·¥ä½œæ¨¡å¼ç§°ä¸º MTï¼ˆManual Transactionï¼‰æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œåˆ†æ”¯äº‹åŠ¡éœ€è¦åº”ç”¨è‡ªå·±æ¥å®šä¹‰ä¸šåŠ¡æœ¬èº«åŠæäº¤å’Œå›æ»šçš„é€»è¾‘ã€‚ 4.1 åˆ†æ”¯çš„åŸºæœ¬è¡Œä¸ºæ¨¡å¼ä½œä¸ºå…¨å±€äº‹åŠ¡ä¸€éƒ¨åˆ†çš„åˆ†æ”¯äº‹åŠ¡ï¼Œé™¤æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘å¤–ï¼Œéƒ½åŒ…å« 4 ä¸ªä¸åè°ƒå™¨äº¤äº’çš„è¡Œä¸ºï¼š åˆ†æ”¯æ³¨å†Œï¼š åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œè¿›è¡Œä¹‹å‰ï¼Œéœ€è¦å‘åè°ƒå™¨æ³¨å†Œï¼ŒæŠŠå³å°†è¿›è¡Œçš„åˆ†æ”¯äº‹åŠ¡æ•°æ®æ“ä½œï¼Œçº³å…¥ä¸€ä¸ªå·²ç»å¼€å¯çš„å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­å»ï¼Œåœ¨åˆ†æ”¯æ³¨å†ŒæˆåŠŸåï¼Œæ‰å¯ä»¥è¿›è¡Œæ•°æ®æ“ä½œã€‚ çŠ¶æ€ä¸ŠæŠ¥ï¼š åœ¨åˆ†æ”¯äº‹åŠ¡çš„æ•°æ®æ“ä½œå®Œæˆåï¼Œéœ€è¦å‘äº‹åŠ¡åè°ƒå™¨ä¸ŠæŠ¥å…¶æ‰§è¡Œç»“æœã€‚ åˆ†æ”¯æäº¤ï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡æäº¤çš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯æäº¤ã€‚ åˆ†æ”¯å›æ»šï¼šå“åº”åè°ƒå™¨å‘å‡ºçš„åˆ†æ”¯äº‹åŠ¡å›æ»šçš„è¯·æ±‚ï¼Œå®Œæˆåˆ†æ”¯å›æ»šã€‚ 4.2 AT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼ä¸šåŠ¡é€»è¾‘ä¸éœ€è¦å…³æ³¨äº‹åŠ¡æœºåˆ¶ï¼Œåˆ†æ”¯ä¸å…¨å±€äº‹åŠ¡çš„äº¤äº’è¿‡ç¨‹è‡ªåŠ¨è¿›è¡Œã€‚ 4.3 MT æ¨¡å¼åˆ†æ”¯çš„è¡Œä¸ºæ¨¡å¼ä¸šåŠ¡é€»è¾‘éœ€è¦è¢«åˆ†è§£ä¸º Prepare/Commit/Rollback 3 éƒ¨åˆ†ï¼Œå½¢æˆä¸€ä¸ª MT åˆ†æ”¯ï¼ŒåŠ å…¥å…¨å±€äº‹åŠ¡ã€‚ MT æ¨¡å¼ä¸€æ–¹é¢æ˜¯ AT æ¨¡å¼çš„è¡¥å……ã€‚å¦å¤–ï¼Œæ›´é‡è¦çš„ä»·å€¼åœ¨äºï¼Œé€šè¿‡ MT æ¨¡å¼å¯ä»¥æŠŠä¼—å¤šéäº‹åŠ¡æ€§èµ„æºçº³å…¥å…¨å±€äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚ 4.4 æ··åˆæ¨¡å¼å› ä¸º AT å’Œ MT æ¨¡å¼çš„åˆ†æ”¯ä»æ ¹æœ¬ä¸Šè¡Œä¸ºæ¨¡å¼æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¯ä»¥å®Œå…¨å…¼å®¹ï¼Œå³ï¼Œä¸€ä¸ªå…¨å±€äº‹åŠ¡ä¸­ï¼Œå¯ä»¥åŒæ—¶å­˜åœ¨ AT å’Œ MT çš„åˆ†æ”¯ã€‚è¿™æ ·å°±å¯ä»¥è¾¾åˆ°å…¨é¢è¦†ç›–ä¸šåŠ¡åœºæ™¯çš„ç›®çš„ï¼šAT æ¨¡å¼å¯ä»¥æ”¯æŒçš„ï¼Œä½¿ç”¨ AT æ¨¡å¼ï¼›AT æ¨¡å¼æš‚æ—¶æ”¯æŒä¸äº†çš„ï¼Œç”¨ MT æ¨¡å¼æ¥æ›¿ä»£ã€‚å¦å¤–ï¼Œè‡ªç„¶çš„ï¼ŒMT æ¨¡å¼ç®¡ç†çš„éäº‹åŠ¡æ€§èµ„æºä¹Ÿå¯ä»¥å’Œæ”¯æŒäº‹åŠ¡çš„å…³ç³»å‹æ•°æ®åº“èµ„æºä¸€èµ·ï¼Œçº³å…¥åŒä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡çš„ç®¡ç†ä¸­ã€‚ 4.5 åº”ç”¨åœºæ™¯çš„è¿œæ™¯å›åˆ°æˆ‘ä»¬è®¾è®¡çš„åˆè¡·ï¼šä¸€ä¸ªç†æƒ³çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ˜¯ä¸åº”è¯¥ä¾µå…¥ä¸šåŠ¡çš„ã€‚MT æ¨¡å¼æ˜¯åœ¨ AT æ¨¡å¼æš‚æ—¶ä¸èƒ½å®Œå…¨è¦†ç›–æ‰€æœ‰åœºæ™¯çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªæ¯”è¾ƒè‡ªç„¶çš„è¡¥å……æ–¹æ¡ˆã€‚æˆ‘ä»¬å¸Œæœ›é€šè¿‡ AT æ¨¡å¼çš„ä¸æ–­æ¼”è¿›å¢å¼ºï¼Œé€æ­¥æ‰©å¤§æ‰€æ”¯æŒçš„åœºæ™¯ï¼ŒMT æ¨¡å¼é€æ­¥æ”¶æ•›ã€‚æœªæ¥ï¼Œæˆ‘ä»¬ä¼šçº³å…¥å¯¹ XA çš„åŸç”Ÿæ”¯æŒï¼Œç”¨ XA è¿™ç§æ— ä¾µå…¥çš„æ–¹å¼æ¥è¦†ç›– AT æ¨¡å¼æ— æ³•è§¦è¾¾çš„åœºæ™¯ã€‚ 5. æ‰©å±•ç‚¹5.1 å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒäº‹åŠ¡ä¸Šä¸‹æ–‡åœ¨å¾®æœåŠ¡é—´çš„ä¼ æ’­éœ€è¦æ ¹æ®å¾®æœåŠ¡æ¡†æ¶æœ¬èº«çš„æœºåˆ¶ï¼Œè®¢åˆ¶æœ€ä¼˜çš„ï¼Œå¯¹åº”ç”¨å±‚é€æ˜çš„è§£å†³æ–¹æ¡ˆã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ Dubbo çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®ç°å¯¹å…¶ä»–å¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒã€‚ 5.2 æ‰€æ”¯æŒçš„æ•°æ®åº“ç±»å‹å› ä¸º AT æ¶‰åŠ SQL çš„è§£æï¼Œæ‰€ä»¥åœ¨ä¸åŒç±»å‹çš„æ•°æ®åº“ä¸Šå·¥ä½œï¼Œä¼šæœ‰ä¸€äº›ç‰¹å®šçš„é€‚é…ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥å‚è€ƒå†…ç½®çš„å¯¹ MySQL çš„æ”¯æŒæ–¹æ¡ˆï¼Œæ¥å®ç°å¯¹å…¶ä»–æ•°æ®åº“çš„æ”¯æŒã€‚ 5.3 é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°æ”¯æŒæ¥å…¥ä¸åŒçš„é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°è§£å†³æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼šNacosã€Eurekaã€ZooKeeper ç­‰ã€‚ 5.4 MT æ¨¡å¼çš„åœºæ™¯æ‹“å±•MT æ¨¡å¼çš„ä¸€ä¸ªé‡è¦ä½œç”¨å°±æ˜¯ï¼Œå¯ä»¥æŠŠéå…³ç³»å‹æ•°æ®åº“çš„èµ„æºï¼Œé€šè¿‡ MT æ¨¡å¼åˆ†æ”¯çš„åŒ…è£…ï¼Œçº³å…¥åˆ°å…¨å±€äº‹åŠ¡çš„ç®¡è¾–ä¸­æ¥ã€‚æ¯”å¦‚ï¼ŒRedisã€HBaseã€RocketMQ çš„äº‹åŠ¡æ¶ˆæ¯ç­‰ã€‚æœ‰å…´è¶£åœ¨è¿™æ–¹é¢å…±å»ºçš„å¼€å‘è€…å¯ä»¥åœ¨è¿™é‡Œè´¡çŒ®ä¸€ç³»åˆ—ç›¸å…³ç”Ÿæ€çš„é€‚é…æ–¹æ¡ˆã€‚ 5.5 äº‹åŠ¡åè°ƒå™¨çš„åˆ†å¸ƒå¼é«˜å¯ç”¨æ–¹æ¡ˆé’ˆå¯¹ä¸åŒåœºæ™¯ï¼Œæ”¯æŒä¸åŒçš„æ–¹å¼ä½œä¸ºäº‹åŠ¡åè°ƒå™¨ Server ç«¯çš„é«˜å¯ç”¨æ–¹æ¡ˆã€‚æ¯”å¦‚ï¼Œé’ˆå¯¹äº‹åŠ¡çŠ¶æ€çš„æŒä¹…åŒ–ï¼Œå¯ä»¥æ˜¯åŸºäºæ–‡ä»¶çš„å®ç°æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºæ•°æ®åº“çš„å®ç°æ–¹æ¡ˆï¼›é›†ç¾¤é—´çš„çŠ¶æ€åŒæ­¥ï¼Œå¯ä»¥æ˜¯åŸºäº RPC é€šä¿¡çš„æ–¹æ¡ˆï¼Œä¹Ÿå¯ä»¥æ˜¯åŸºäºé«˜å¯ç”¨ KV å­˜å‚¨çš„æ–¹æ¡ˆã€‚ 6. Roadmapè“å›¾ ç»¿è‰² éƒ¨åˆ†æ˜¯å·²ç»å¼€æºå‘å¸ƒå‡ºæ¥çš„ï¼Œé»„è‰² éƒ¨åˆ†æ˜¯å°†åœ¨åç»­ç‰ˆæœ¬ä¸­ç”±é˜¿é‡Œå‘å¸ƒå‡ºæ¥çš„ï¼Œè“è‰² éƒ¨åˆ†æ˜¯æˆ‘ä»¬å’Œç¤¾åŒºå…±å»ºç”Ÿæ€éƒ¨åˆ†ï¼š å¯¹ä¸åŒæ•°æ®åº“çš„æ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒ MySQL çš„å®ç°ã€‚ å¯¹ä¸åŒå¾®æœåŠ¡æ¡†æ¶çš„æ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒ Dubbo çš„å®ç°ã€‚ å¯¹ MQã€NoSQL çš„æ”¯æŒï¼Œå¼€å‘è€…å¯ä»¥å‚è€ƒ TCC çš„å®ç°ã€‚ é…ç½®å’ŒæœåŠ¡æ³¨å†Œå‘ç°ï¼šå¼€å‘è€…é€šè¿‡å°‘é‡çš„å·¥ä½œå¯ä»¥æ¥å…¥ä»»ä½•å¯ä»¥æä¾›è¿™ç±»æœåŠ¡çš„æ¡†æ¶ã€‚ å½“ç„¶ï¼Œé è“è‰² çš„éƒ¨åˆ†ä¹Ÿéå¸¸æ¬¢è¿ç¤¾åŒºå‚ä¸è¿›æ¥ï¼Œè´¡çŒ®æ›´ä¼˜çš„è§£å†³æ–¹æ¡ˆã€‚ å¦å¤–ï¼ŒXA ä½œä¸ºåˆ†å¸ƒå¼äº‹åŠ¡çš„æ ‡å‡†ï¼Œæ˜¯ä¸€ä¸ªå®Œå¤‡çš„åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆä¸å¯æˆ–ç¼ºçš„ï¼Œè¿œæ™¯çš„è§„åˆ’ä¸­ï¼Œæˆ‘ä»¬ä¸€å®šéœ€è¦æŠŠ XA çš„æ”¯æŒåŠ å…¥è¿›æ¥ã€‚ åˆæ­¥çš„ç‰ˆæœ¬è§„åˆ’v0.1.0 å¾®æœåŠ¡æ¡†æ¶æ”¯æŒ: Dubbo æ•°æ®åº“æ”¯æŒ: MySQL åŸºäº Spring AOP çš„ Annotation äº‹åŠ¡åè°ƒå™¨: å•æœºç‰ˆæœ¬ v0.5.x å¾®æœåŠ¡æ¡†æ¶æ”¯æŒ: Spring Cloud MT æ¨¡å¼ æ”¯æŒ TCC æ¨¡å¼äº‹åŠ¡çš„é€‚é… åŠ¨æ€é…ç½®å’ŒæœåŠ¡å‘ç° äº‹åŠ¡åè°ƒå™¨: é«˜å¯ç”¨é›†ç¾¤ç‰ˆæœ¬ v0.8.x Metrics æ§åˆ¶å°: ç›‘æ§/éƒ¨ç½²/å‡çº§/æ‰©ç¼©å®¹ v1.0.0 General Availability: ç”Ÿäº§ç¯å¢ƒé€‚ç”¨ v1.5.x æ•°æ®åº“æ”¯æŒ: Oracle/PostgreSQL/OceanBase ä¸ä¾èµ– Spring AOP çš„ Annotation çƒ­ç‚¹æ•°æ®çš„ä¼˜åŒ–å¤„ç†æœºåˆ¶ RocketMQ äº‹åŠ¡æ¶ˆæ¯çº³å…¥å…¨å±€äº‹åŠ¡ç®¡ç† NoSQL çº³å…¥å…¨å±€äº‹åŠ¡ç®¡ç†çš„é€‚é…æœºåˆ¶ æ”¯æŒ HBase æ”¯æŒ Redis v2.0.0 æ”¯æŒ XA å½“ç„¶ï¼Œé¡¹ç›®è¿­ä»£æ¼”è¿›çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æœ€é‡è§†çš„æ˜¯ç¤¾åŒºçš„å£°éŸ³ï¼Œè·¯çº¿å›¾ä¼šå’Œç¤¾åŒºå……åˆ†äº¤æµåŠæ—¶è¿›è¡Œè°ƒæ•´ã€‚ 7. ç›¸å…³é“¾æ¥ FESCAR on GitHub GTS on Aliyun]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼äº‹åŠ¡</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>äº‹åŠ¡</tag>
        <tag>XA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹è§£é‡Šå™¨æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F10%2Fdesign-pattern-interpreter%2F</url>
    <content type="text"><![CDATA[è§£é‡Šå™¨æ¨¡å¼ æ˜¯ç±»çš„è¡Œä¸ºæ¨¡å¼ï¼Œç»™å®šä¸€ä¸ªè¯­è¨€ä¹‹åï¼Œè§£é‡Šå™¨æ¨¡å¼å¯ä»¥å®šä¹‰å‡ºå…¶æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶åŒæ—¶æä¾›ä¸€ä¸ªè§£é‡Šå™¨ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªè§£é‡Šå™¨æ¥è§£é‡Šè¿™ä¸ªè¯­è¨€ä¸­çš„å¥å­ã€‚ æ„å›¾ ç»™å®šä¸€ä¸ªè¯­è¨€ï¼Œå®šä¹‰å®ƒçš„æ–‡æ³•è¡¨ç¤ºï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¿™ä¸ªè§£é‡Šå™¨ä½¿ç”¨è¯¥æ ‡è¯†æ¥è§£é‡Šè¯­è¨€ä¸­çš„å¥å­ã€‚ ä¸»è¦è§£å†³ å¯¹äºä¸€äº›å›ºå®šæ–‡æ³•æ„å»ºä¸€ä¸ªè§£é‡Šå¥å­çš„è§£é‡Šå™¨ã€‚ ä½•æ—¶ä½¿ç”¨ å¦‚æœä¸€ç§ç‰¹å®šç±»å‹çš„é—®é¢˜å‘ç”Ÿçš„é¢‘ç‡è¶³å¤Ÿé«˜ï¼Œé‚£ä¹ˆå¯èƒ½å°±å€¼å¾—å°†è¯¥é—®é¢˜çš„å„ä¸ªå®ä¾‹è¡¨è¿°ä¸ºä¸€ä¸ªç®€å•è¯­è¨€ä¸­çš„å¥å­ã€‚è¿™æ ·å°±å¯ä»¥æ„å»ºä¸€ä¸ªè§£é‡Šå™¨ï¼Œè¯¥è§£é‡Šå™¨é€šè¿‡è§£é‡Šè¿™äº›å¥å­æ¥è§£å†³è¯¥é—®é¢˜ã€‚ å¦‚ä½•è§£å†³ æ„ä»¶è¯­æ³•æ ‘ï¼Œå®šä¹‰ç»ˆç»“ç¬¦ä¸éç»ˆç»“ç¬¦ã€‚ å…³é”®ä»£ç  æ„ä»¶ç¯å¢ƒç±»ï¼ŒåŒ…å«è§£é‡Šå™¨ä¹‹å¤–çš„ä¸€äº›å…¨å±€ä¿¡æ¯ï¼Œä¸€èˆ¬æ˜¯ HashMapã€‚ è§£é‡Šå™¨æ¨¡å¼ç›¸å…³UMLå›¾ç±»å›¾ å¯ä»¥çœ‹å‡ºå³ä¾§çš„åä½œå›¾(object collaboration diagram)å±•ç°å‡ºè¿è¡Œæ—¶çš„è§£é‡Šå™¨æ¨¡å¼ã€‚Clientå‘å³ä¾§æŠ½è±¡è¯­æ³•æ ‘å‘é€è§£é‡Šè¯·æ±‚ï¼Œè¯·æ±‚è¢«è½¬å‘å¹¶å‘ä¸‹åˆ°æ ‘ç»“æ„çš„æ‰€æœ‰å¯¹è±¡ã€‚ è§£é‡Šå™¨æ¨¡å¼çš„ä¸»è¦è§’è‰² æŠ½è±¡è§£é‡Šå™¨(AbstractExpression/Expression)ï¼šå£°æ˜ä¸€ä¸ªæ‰€æœ‰å…·ä½“è¡¨è¾¾å¼éƒ½è¦å®ç°çš„æŠ½è±¡æ¥å£ï¼ˆæˆ–è€…æŠ½è±¡ç±»ï¼‰ï¼Œæ¥å£ä¸­ä¸»è¦æ˜¯ä¸€ä¸ªinterpret()æ–¹æ³•ï¼Œç§°ä¸ºè§£é‡Šæ“ä½œã€‚å…·ä½“è§£é‡Šä»»åŠ¡ç”±å®ƒçš„å„ä¸ªå®ç°ç±»æ¥å®Œæˆï¼Œå…·ä½“çš„è§£é‡Šå™¨åˆ†åˆ«ç”±ç»ˆç»“ç¬¦è§£é‡Šå™¨TerminalExpressionå’Œéç»ˆç»“ç¬¦è§£é‡Šå™¨NonterminalExpressionå®Œæˆã€‚ ç»ˆç»“ç¬¦è¡¨è¾¾å¼(TerminalExpression)ï¼šå®ç°ä¸æ–‡æ³•ä¸­çš„å…ƒç´ ç›¸å…³è”çš„è§£é‡Šæ“ä½œï¼Œé€šå¸¸ä¸€ä¸ªè§£é‡Šå™¨æ¨¡å¼ä¸­åªæœ‰ä¸€ä¸ªç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œä½†æœ‰å¤šä¸ªå®ä¾‹ï¼Œå¯¹åº”ä¸åŒçš„ç»ˆç»“ç¬¦ã€‚ç»ˆç»“ç¬¦ä¸€åŠæ˜¯æ–‡æ³•ä¸­çš„è¿ç®—å•å…ƒï¼Œæ¯”å¦‚æœ‰ä¸€ä¸ªç®€å•çš„å…¬å¼R=R1+R2ï¼Œåœ¨é‡Œé¢R1å’ŒR2å°±æ˜¯ç»ˆç»“ç¬¦ï¼Œå¯¹åº”çš„è§£æR1å’ŒR2çš„è§£é‡Šå™¨å°±æ˜¯ç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚ éç»ˆç»“ç¬¦è¡¨è¾¾å¼(NonterminalExpression)ï¼šæ–‡æ³•ä¸­çš„æ¯æ¡è§„åˆ™å¯¹åº”äºä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ï¼Œéç»ˆç»“ç¬¦è¡¨è¾¾å¼ä¸€èˆ¬æ˜¯æ–‡æ³•ä¸­çš„è¿ç®—ç¬¦æˆ–è€…å…¶ä»–å…³é”®å­—ï¼Œæ¯”å¦‚å…¬å¼R=R1+R2ä¸­ï¼Œ+å°±æ˜¯éç»ˆç»“ç¬¦ï¼Œè§£æ+çš„è§£é‡Šå™¨å°±æ˜¯ä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚éç»ˆç»“ç¬¦è¡¨è¾¾å¼æ ¹æ®é€»è¾‘çš„å¤æ‚ç¨‹åº¦è€Œå¢åŠ ï¼ŒåŸåˆ™ä¸Šæ¯ä¸ªæ–‡æ³•è§„åˆ™éƒ½å¯¹åº”ä¸€ä¸ªéç»ˆç»“ç¬¦è¡¨è¾¾å¼ã€‚ ç¯å¢ƒè§’è‰²(Context)ï¼šè¿™ä¸ªè§’è‰²çš„ä»»åŠ¡ä¸€èˆ¬æ˜¯ç”¨æ¥å­˜æ”¾æ–‡æ³•ä¸­å„ä¸ªç»ˆç»“ç¬¦æ‰€å¯¹åº”çš„å…·ä½“å€¼ï¼Œæ¯”å¦‚R=R1+R2ï¼Œæˆ‘ä»¬ç»™R1èµ‹å€¼100ï¼Œç»™R2èµ‹å€¼200ã€‚è¿™äº›ä¿¡æ¯éœ€è¦å­˜æ”¾åˆ°ç¯å¢ƒè§’è‰²ä¸­ï¼Œå¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨Mapæ¥å……å½“ç¯å¢ƒè§’è‰²å°±è¶³å¤Ÿäº†ã€‚ å¹²è´§ä»£ç è·³è½¬åˆ°æºç åœ°å€ ç®€å•çš„ä¸€ä¸ªè§£é‡Šå™¨è®¡ç®—åŠ å‡ä¹˜é™¤ç®—æ³•ï¼Œç¯å¢ƒä¸Šä¸‹æ–‡æ²¡æœ‰ç”¨å¥½ï¼Œå…¶å®è®¡ç®—è§„åˆ™æ›´å¤šçš„æ˜¯äººä¸ºè®¾å®šçš„äº†ã€‚ æœ¬æ¬¡çš„æŠ½è±¡æ¥æ”¶å™¨ç”¨çš„æ˜¯æŠ½è±¡ç±»ï¼Œç”¨æ¥å£ä»£æ›¿ä¹Ÿå¯ä»¥ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122//æŠ½è±¡è§£é‡Šå™¨public abstract class AbstractExpression &#123; public abstract int interpreter(Context context);&#125;//éç»ˆç»“è¡¨è¾¾å¼ï¼šåŠ æ³•@Data@AllArgsConstructorpublic class Add extends AbstractExpression &#123; private final AbstractExpression left; private final AbstractExpression right; @Override public int interpreter(Context context) &#123; return left.interpreter(context) + right.interpreter(context); &#125;&#125;//éç»ˆç»“è¡¨è¾¾å¼ï¼šå‡æ³•@Data@AllArgsConstructorpublic class Subtract extends AbstractExpression &#123; private final AbstractExpression left; private final AbstractExpression right; @Override public int interpreter(Context context) &#123; return left.interpreter(context) - right.interpreter(context); &#125;&#125;//éç»ˆç»“è¡¨è¾¾å¼ï¼šä¹˜æ³•@Data@AllArgsConstructorpublic class Multiply extends AbstractExpression &#123; private final AbstractExpression left; private final AbstractExpression right; @Override public int interpreter(Context context) &#123; return left.interpreter(context) * right.interpreter(context); &#125;&#125;//éç»ˆç»“è¡¨è¾¾å¼ï¼šé™¤æ³•@Data@AllArgsConstructorpublic class Division extends AbstractExpression &#123; private final AbstractExpression left; private final AbstractExpression right; @Override public int interpreter(Context context) &#123; int right = this.right.interpreter(context); if (right != 0) &#123; return left.interpreter(context) / right; &#125; return -1; &#125;&#125;//ç»ˆç»“è¡¨è¾¾å¼ï¼šå˜é‡@Data@AllArgsConstructorpublic class Variable extends AbstractExpression &#123; private final String key; @Override public int interpreter(Context context) &#123; return context.getValue(key); &#125;&#125;//ç¯å¢ƒä¸Šä¸‹æ–‡@Getterpublic class Context &#123; private final Map&lt;String, Integer&gt; valueMap = Maps.newHashMap(); public void addValue(final String key, final int value) &#123; valueMap.put(key, Integer.valueOf(value)); &#125; public int getValue(final String key) &#123; return valueMap.get(key).intValue(); &#125;&#125;//public class Application &#123; public static void main(String[] args) &#123; Context context = new Context(); context.addValue("a", 6); context.addValue("b", 9); context.addValue("c", 1); Variable a = new Variable("a"); Variable b = new Variable("b"); Variable c = new Variable("c"); AbstractExpression multiplyValue = new Multiply(a, b); AbstractExpression subtractValue = new Subtract(a, b); AbstractExpression addValue = new Add(subtractValue, c); AbstractExpression divisionValue = new Division(multiplyValue, addValue); log.info("&#123;&#125;", context.getValueMap()); log.info("(a*b)/(a-b+c) = &#123;&#125;", divisionValue.interpreter(context)); &#125;&#125; ç»“æœå¦‚ä¸‹ï¼š Javaä¸­çš„åº”ç”¨ javaä¸­çš„è¡¨è¾¾å¼å¼•æ“parsiiJEvalJEPLiteexprJaninoMathEval Javaè¡¨è¾¾å¼å¼•æ“fel/groovy/expression4j/javaè„šæœ¬å¼•æ“çš„æ€§èƒ½å¯¹æ¯” JDKä¸­çš„åº”ç”¨è¿™ä¸ªæ¨¡å¼é€šå¸¸å®šä¹‰äº†ä¸€ä¸ªè¯­è¨€çš„è¯­æ³•ï¼Œç„¶åè§£æç›¸åº”è¯­æ³•çš„è¯­å¥ã€‚ java.util.Pattern java.text.Normalizer java.text.Format å‚è€ƒè§£é‡Šå™¨æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Interpreter pattern ç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼ 23ç§è®¾è®¡æ¨¡å¼ï¼ˆ14ï¼‰ï¼šè§£é‡Šå™¨æ¨¡å¼]]></content>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹è®¿é—®è€…æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F07%2Fdesign-pattern-visitor%2F</url>
    <content type="text"><![CDATA[è®¿é—®è€…æ¨¡å¼ Represent an operation to be performed on the elements of an object structure. Visitor lets a new operation be defined without changing the classes of the elements on which it operates. è®¿é—®è€…æ¨¡å¼çš„ç›®çš„æ˜¯å°è£…ä¸€äº›æ–½åŠ äºæŸç§æ•°æ®ç»“æ„å…ƒç´ ä¹‹ä¸Šçš„æ“ä½œã€‚ä¸€æ—¦è¿™äº›æ“ä½œéœ€è¦ä¿®æ”¹çš„è¯ï¼Œæ¥å—è¿™ä¸ªæ“ä½œçš„æ•°æ®ç»“æ„åˆ™å¯ä»¥ä¿æŒä¸å˜ã€‚ æ„å›¾ ä¸»è¦å°†æ•°æ®ç»“æ„ä¸æ•°æ®æ“ä½œåˆ†ç¦»ã€‚ ä¸»è¦è§£å†³ ç¨³å®šçš„æ•°æ®ç»“æ„å’Œæ˜“å˜çš„æ“ä½œè€¦åˆé—®é¢˜ã€‚ ä½•æ—¶ä½¿ç”¨ éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œâ€æ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä½¿ç”¨è®¿é—®è€…æ¨¡å¼å°†è¿™äº›å°è£…åˆ°ç±»ä¸­ã€‚ è®¿é—®è€…æ¨¡å¼çš„ä¸»è¦è§’è‰² Visitorï¼ˆæŠ½è±¡è®¿é—®è€…ï¼‰ï¼šæŠ½è±¡è®¿é—®è€…ä¸ºå¯¹è±¡ç»“æ„ä¸­æ¯ä¸€ä¸ªå…·ä½“å…ƒç´ ç±»ConcreteElementå£°æ˜ä¸€ä¸ªè®¿é—®æ“ä½œï¼Œä»è¿™ä¸ªæ“ä½œçš„åç§°æˆ–å‚æ•°ç±»å‹å¯ä»¥æ¸…æ¥šçŸ¥é“éœ€è¦è®¿é—®çš„å…·ä½“å…ƒç´ çš„ç±»å‹ï¼Œå…·ä½“è®¿é—®è€…éœ€è¦å®ç°è¿™äº›æ“ä½œæ–¹æ³•ï¼Œå®šä¹‰å¯¹è¿™äº›å…ƒç´ çš„è®¿é—®æ“ä½œã€‚ ConcreteVisitorï¼ˆå…·ä½“è®¿é—®è€…ï¼‰ï¼šå…·ä½“è®¿é—®è€…å®ç°äº†æ¯ä¸ªç”±æŠ½è±¡è®¿é—®è€…å£°æ˜çš„æ“ä½œï¼Œæ¯ä¸€ä¸ªæ“ä½œç”¨äºè®¿é—®å¯¹è±¡ç»“æ„ä¸­ä¸€ç§ç±»å‹çš„å…ƒç´ ã€‚ Elementï¼ˆæŠ½è±¡å…ƒç´ ï¼‰ï¼šæŠ½è±¡å…ƒç´ ä¸€èˆ¬æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼Œå®ƒå®šä¹‰ä¸€ä¸ªaccept()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šå¸¸ä»¥ä¸€ä¸ªæŠ½è±¡è®¿é—®è€…ä½œä¸ºå‚æ•°ã€‚ ConcreteElementï¼ˆå…·ä½“å…ƒç´ ï¼‰ï¼šå…·ä½“å…ƒç´ å®ç°äº†accept()æ–¹æ³•ï¼Œåœ¨accept()æ–¹æ³•ä¸­è°ƒç”¨è®¿é—®è€…çš„è®¿é—®æ–¹æ³•ä»¥ä¾¿å®Œæˆå¯¹ä¸€ä¸ªå…ƒç´ çš„æ“ä½œã€‚ ObjectStructureï¼ˆå¯¹è±¡ç»“æ„ï¼‰ï¼šå¯¹è±¡ç»“æ„æ˜¯ä¸€ä¸ªå…ƒç´ çš„é›†åˆï¼Œå®ƒç”¨äºå­˜æ”¾å…ƒç´ å¯¹è±¡ï¼Œå¹¶ä¸”æä¾›äº†éå†å…¶å†…éƒ¨å…ƒç´ çš„æ–¹æ³•ã€‚å®ƒå¯ä»¥ç»“åˆç»„åˆæ¨¡å¼æ¥å®ç°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„é›†åˆå¯¹è±¡ï¼Œå¦‚ä¸€ä¸ªListå¯¹è±¡æˆ–ä¸€ä¸ªSetå¯¹è±¡ã€‚ ä½¿ç”¨åœºæ™¯ï¼š 1ã€å¯¹è±¡ç»“æ„ä¸­å¯¹è±¡å¯¹åº”çš„ç±»å¾ˆå°‘æ”¹å˜ï¼Œä½†ç»å¸¸éœ€è¦åœ¨æ­¤å¯¹è±¡ç»“æ„ä¸Šå®šä¹‰æ–°çš„æ“ä½œã€‚ 2ã€éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ç»“æ„ä¸­çš„å¯¹è±¡è¿›è¡Œå¾ˆå¤šä¸åŒçš„å¹¶ä¸”ä¸ç›¸å…³çš„æ“ä½œï¼Œè€Œéœ€è¦é¿å…è®©è¿™äº›æ“ä½œâ€æ±¡æŸ“â€è¿™äº›å¯¹è±¡çš„ç±»ï¼Œä¹Ÿä¸å¸Œæœ›åœ¨å¢åŠ æ–°æ“ä½œæ—¶ä¿®æ”¹è¿™äº›ç±»ã€‚ è®¿é—®è€…æ¨¡å¼ç›¸å…³UMLå›¾UMLç±»å›¾å’Œæ—¶åºå›¾ åœ¨ç±»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒElementAå®ç°äº†æ¥å£Elementçš„accept(visitor)æ–¹æ³•ï¼Œè€Œé€šè¿‡visitor.visitElementA(this)ï¼Œç›¸åŒvisitor1ç±»é€šè¿‡å®ç°visitElementA(ElementA a)æ–¹æ³•ä¸ElementAå…³è”ã€‚ç›¸åŒçš„ElementBäº¦æ˜¯å¦‚æ­¤åŸç†ã€‚ å³ä¸Šè§’çš„æ—¶åºå›¾ï¼ŒClientå¯¹è±¡æœ‰ä¸€ç»„Elementçš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡å¾ªç¯å¯¹æ¯ä¸ªå…ƒç´ Elementè°ƒç”¨accept(visitor)æ–¹æ³•ï¼Œä¾‹å¦‚å…ˆæ˜¯ElementAè°ƒç”¨accept(visitor)ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨visitor1çš„visitElementA(A)ï¼ŒåŒæ ·æƒ…å†µå¯¹ElementBã€‚ æ›´åŠ æ¸…æ™°çš„ç±»å›¾å¦‚ä¸‹ å®ä¾‹å¹²è´§è·³è½¬åˆ°å¯¹åº”çš„æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899//æŠ½è±¡å…ƒç´ public interface Element &#123; void accept(ElementVisitor visitor);&#125;//å…·ä½“å…ƒç´ -è½¦è½®@Data@AllArgsConstructorpublic class Wheel implements Element &#123; private String name; @Override public void accept(ElementVisitor visitor) &#123; visitor.visit(this); &#125;&#125;//å…·ä½“å…ƒç´ -è½¦èº«public class Body implements Element &#123; @Override public void accept(ElementVisitor visitor) &#123; visitor.visit(this); &#125;&#125;//å…·ä½“å…ƒç´ -å¼•æ“public class Engine implements Element &#123; @Override public void accept(ElementVisitor visitor) &#123; visitor.visit(this); &#125;&#125;//å…·ä½“å…ƒç´ -æ•´è½¦public class Car implements Element &#123; public void accept(final ElementVisitor visitor) &#123; visitor.visit(this); &#125;&#125;//æŠ½è±¡è®¿é—®è€…public interface ElementVisitor &#123; void visit(Body body); void visit(Engine engine); void visit(Wheel wheel); void visit(Car car);&#125;//å…·ä½“çš„ä¸€ä¸ªè®¿é—®è€…ï¼Œçº¯æ‰“å°@Slf4jpublic class DoElementVisitor implements ElementVisitor &#123; @Override public void visit(Body body) &#123; log.info("Moving my body"); &#125; @Override public void visit(Engine engine) &#123; log.info("Starting my engine"); &#125; @Override public void visit(Wheel wheel) &#123; log.info("Kicking my " + wheel.getName() + " wheel"); &#125; @Override public void visit(Car car) &#123; log.info("Starting my car"); &#125;&#125;//å•ç‹¬è¿˜å®šä¹‰å¯¹è±¡ç»“æ„ï¼Œå…¶å®å®Œå…¨å°±å¯ä»¥ä½¿ç”¨åˆ—è¡¨å°±å¯ä»¥@Datapublic class ElementStructure &#123; private List&lt;Element&gt; list = Lists.newArrayList(); public void addElement(Element element)&#123; list.add(element); &#125; public void accept(ElementVisitor visitor) &#123; for (Element elem : list) &#123; elem.accept(visitor); &#125; &#125;&#125; ä¸Šè¿°å°±æ˜¯é’ˆå¯¹è®¿é—®è€…æ¨¡å¼åšçš„ä¸€ä¸ªå¯¹äºæ±½è½¦é›¶ä»¶çš„ä¸€ä¸ªæ‰“å°æ•ˆæœã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243public class ClientWithVisitor &#123; public static void main(String[] args) &#123; ElementStructure structure = new ElementStructure(); structure.addElement(new Wheel("front left")); structure.addElement(new Wheel("front right")); structure.addElement(new Wheel("back left")); structure.addElement(new Wheel("back right")); structure.addElement(new Body()); structure.addElement(new Engine()); structure.addElement(new Car()); structure.accept(new DoElementVisitor()); &#125;&#125;@Slf4jpublic class ClientWithoutVisitor &#123; public static void main(String[] args) &#123; ElementStructure structure = new ElementStructure(); structure.addElement(new Wheel("front left")); structure.addElement(new Wheel("front right")); structure.addElement(new Wheel("back left")); structure.addElement(new Wheel("back right")); structure.addElement(new Body()); structure.addElement(new Engine()); structure.addElement(new Car()); structure.getList().forEach(e -&gt; &#123; if (e instanceof Body) &#123; log.info("Moving my body"); &#125; else if (e instanceof Engine) &#123; log.info("Starting my engine"); &#125; else if (e instanceof Car) &#123; log.info("Starting my car"); &#125; else if (e instanceof Wheel) &#123; log.info("Kicking my " + ((Wheel)e).getName() + " wheel"); &#125; &#125;); &#125;&#125; æ‰“å°ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ æ€»ç»“åˆ†æåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­åˆ†åˆ«ç”¨äº†è®¿é—®è€…æ¨¡å¼å’Œéè®¿é—®è€…æ¨¡å¼ä¸¤ç§æ–¹æ³•ã€‚ 1ã€ä½¿ç”¨VIsitorçš„å¥½å¤„ä¸€ç›®äº†ç„¶ï¼Œå½“éœ€è¦ä¿®æ”¹æŸäº›å…ƒç´ çš„ä¸šåŠ¡é€»è¾‘æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹Visitorç±»ä¸­ç›¸å¯¹åº”çš„æ“ä½œå‡½æ•°å³å¯ã€‚ä¾‹å¦‚å‡è®¾è¦ä¿®æ”¹Wheelçš„é€»è¾‘ï¼Œåªéœ€è¦ä¿®æ”¹Visitorçš„visit(Wheel wheel)æ–¹æ³•å³å¯ã€‚ 2ã€å‡è®¾æˆ‘ä»¬åˆéœ€è¦æ–°å¢ä¸€ä¸ªæ±½è½¦å…ƒç´ å¤©çª—çš„è¯ï¼Œåªéœ€è¦åœ¨visitorä¸­æ·»åŠ æ–°çš„æ¥å£ä»¥å¤„ç†æ–°å…ƒç´ ï¼Œè€Œåˆ«çš„å…ƒç´ å¯ä»¥ä¿æŒä¸åŠ¨ã€‚ è¿èƒŒå¼€é—­åŸåˆ™ã€‚ 3ã€å½“æˆ‘ä»¬éœ€è¦æ·»åŠ æ–°çš„ä¸šåŠ¡æ“ä½œï¼Œåªéœ€è¦æ·»åŠ æ–°çš„å…·ä½“è®¿é—®è€…ï¼Œå…¶ä»–çš„ä¾æ—§å¯ä»¥ä¿æŒä¸å˜ã€‚ç¬¦åˆå¼€é—­åŸåˆ™ã€‚ åŒæ ·ï¼Œæœ‰å¥½å¤„ä¹Ÿå°±æœ‰ç¼ºé™·ï¼Œå› ä¸ºé€»è¾‘åœ¨visitoré‡Œé¢ï¼Œæ‰€æœ‰visitorå’ŒElementé«˜åº¦è€¦åˆï¼ŒåŒæ ·é’ˆå¯¹visitæ–¹æ³•è¿”å›ç±»å‹ï¼Œéœ€è¦è®¾è®¡çš„ä¼˜é›…ï¼Œå¦‚è‹¥ä¸ç„¶ï¼ŒåæœŸä¸€æ—¦ä¿®æ”¹è¿”å›ç±»å‹ï¼Œå½±å“çš„èŒƒå›´å°±å¹¿ï¼Œæ‰€æœ‰è®¿é—®è€…æ¥å£å’Œå®ç°éƒ½æ³¢åŠåˆ°ã€‚è®¿é—®è€…æ¨¡å¼è¦æ±‚è®¿é—®è€…å¯¹è±¡è®¿é—®å¹¶è°ƒç”¨æ¯ä¸€ä¸ªå…ƒç´ å¯¹è±¡çš„æ“ä½œï¼Œè¿™æ„å‘³ç€å…ƒç´ å¯¹è±¡æœ‰æ—¶å€™å¿…é¡»æš´éœ²ä¸€äº›è‡ªå·±çš„å†…éƒ¨æ“ä½œå’Œå†…éƒ¨çŠ¶æ€ï¼Œå¦åˆ™æ— æ³•ä¾›è®¿é—®è€…è®¿é—®ï¼Œè¿™ä¸€ç‚¹è·Ÿè¿ªç±³ç‰¹æ³•åˆ™å’Œä¾èµ–å€’ç½®åŸåˆ™ç›¸è¿èƒŒã€‚ æ€»çš„è€Œè¨€ï¼Œè®¿é—®è€…æ¨¡å¼çš„ä½¿ç”¨æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼Œæœ¬èº«ç»“æ„ä¹Ÿè¾ƒä¸ºå¤æ‚ï¼Œå› æ­¤åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨é¢‘ç‡ä¸æ˜¯ç‰¹åˆ«é«˜ã€‚ JDKä¸­å«æœ‰çš„è®¿é—®è€…æ¨¡å¼æä¾›ä¸€ä¸ªæ–¹ä¾¿çš„å¯ç»´æŠ¤çš„æ–¹å¼æ¥æ“ä½œä¸€ç»„å¯¹è±¡ã€‚å®ƒä½¿å¾—ä½ åœ¨ä¸æ”¹å˜æ“ä½œçš„å¯¹è±¡å‰æä¸‹ï¼Œå¯ä»¥ä¿®æ”¹æˆ–è€…æ‰©å±•å¯¹è±¡çš„è¡Œä¸ºã€‚ javax.lang.model.element.Element and javax.lang.model.element.ElementVisitor javax.lang.model.type.TypeMirror and javax.lang.model.type.TypeVisitor å‚è€ƒè®¿é—®è€…æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Visitor pattern JAVAè®¾è®¡æ¨¡å¼ï¼ˆ23ï¼‰ï¼šè¡Œä¸ºå‹-è®¿é—®è€…æ¨¡å¼ï¼ˆVisitorï¼‰]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>è®¿é—®è€…</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è½¯ä»¶è®¾è®¡æ¨¡å¼åŸåˆ™]]></title>
    <url>%2F2019%2F01%2F05%2Fprinciples-of-software-design-patterns%2F</url>
    <content type="text"><![CDATA[è½¯ä»¶è®¾è®¡æ¨¡å¼åŸåˆ™åœ¨æˆ‘ä»¬é¢å‘å¯¹è±¡çš„è®¾è®¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çš„codeæ—¢è¦å¯è¯»æ€§é«˜æ–¹ä¾¿ç»´æŠ¤ï¼ŒåŒæ—¶è¿˜éœ€è¦å¦å¤–ä¸€ä¸ªå¯å¤ç”¨æ€§ã€‚è¿™æ¬¡æˆ‘ä»¬æ¥å­¦ä¹ è½¯ä»¶è®¾è®¡æ¨¡å¼ä¸­æ¶‰åŠåˆ°çš„ä¸€äº›åŸåˆ™â€”â€”â€”â€”&gt;é¢å‘å¯¹è±¡è®¾è®¡ SOLID è¿™å°±æ˜¯åæ§½ï¼š ä½†æ˜¯æˆ‘ä»¬å¾€å¾€æ¥æ‰‹çš„é¡¹ç›®ï¼Œéƒ½æ˜¯è‹¦ä¸å ªè¨€ï¼Œä¸€æŠŠé¼»æ¶•ä¸€æŠŠæ³ªï¼Œçœ‹å‰äººç•™ä¸‹çš„æ°ä½œï¼Œé‚£æ˜¯ç›¸å½“ç—›è‹¦ï¼Œåƒä¸‡åŒ¹MMPå¥”è…¾ï¼Œå¡«å‘ï¼Œè¿˜æŠ€æœ¯å€ºã€‚ å…¥æ­£é¢˜ï¼Œåœ¨æœ‰äº›è¯´ä¸ƒå¤§åŸåˆ™ï¼Œæœ‰äº›è¯´å…­å¤§åŸåˆ™ï¼Œæœ‰äº›è¯´äº”å¤§åŸåˆ™ï¼Œä½†æ˜¯æœ€é‡è¦çš„å°±æ˜¯SOLIDäº†ã€‚ å›½å†…çš„åšæ–‡å¤§éƒ¨åˆ†éƒ½è¯´ä¸ƒå¤§å’Œå…­å¤§åŸåˆ™ï¼ŒGoogleä¸‹solidï¼Œçœ‹è€å¤–çš„æ–‡ç« å’Œwikiéƒ½æ˜¯äº”å¤§åŸåˆ™ã€‚ æˆ‘ä»¬å…ˆçœ‹SOLIDï¼Œæ˜¯ç½—ä¼¯ç‰¹Â·CÂ·é©¬ä¸æå‡ºæ¥çš„é¦–å­—æ¯ç¼©å†™è®°å¿†ï¼Œè¿™ä¸ªBobå¤§å”ã€‚ Single Responsibility Principleï¼šå•ä¸€èŒè´£åŸåˆ™ï¼Œè§£é‡Šï¼šä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸä¸­çš„ç›¸åº”èŒè´£ Open Closed Principleï¼šå¼€é—­åŸåˆ™ï¼Œè§£é‡Šï¼šè½¯ä»¶å®ä½“åº”å¯¹æ‰©å±•å¼€æ”¾ï¼Œè€Œå¯¹ä¿®æ”¹å…³é—­ Liskov Substitution Principleï¼šé‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œè§£é‡Šï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»å¯¹è±¡çš„åœ°æ–¹èƒ½å¤Ÿé€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ Interface Segregation Principleï¼šæ¥å£éš”ç¦»åŸåˆ™ï¼Œè§£é‡Šï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ Dependence Inversion Principleï¼šä¾èµ–å€’ç½®åŸåˆ™ï¼Œè§£é‡Šï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ å‰©ä¸‹çš„ä¸¤å¤§åŸåˆ™ Composite Reuse Principle åˆæˆå¤ç”¨åŸåˆ™ï¼Œè§£é‡Šï¼šå°½é‡ä½¿ç”¨å¯¹è±¡ç»„åˆï¼Œè€Œä¸æ˜¯ç»§æ‰¿æ¥è¾¾åˆ°å¤ç”¨çš„ç›®çš„ Law of Demeter è¿ªç±³ç‰¹æ³•åˆ™ï¼Œè§£é‡Šï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ å•ä¸€èŒè´£åŸåˆ™ a class should have only a single responsibility (i.e. only changes to one part of the softwareâ€™s specification should be able to affect the specification of the class). é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªèŒè´£ã€‚ä¸èƒ½æœ‰å¤šä¸ªå¯¼è‡´ç±»å˜æ›´çš„åŸå› ã€‚ è®©ç±»çš„èŒè´£å•ä¸€ï¼Œåªéœ€è¦è´Ÿè´£è‡ªå·±éƒ¨åˆ†ï¼Œå¤æ‚åº¦å°±ä¼šé™ä½ï¼Œä»£ç ç»´æŠ¤èµ·æ¥ä¹Ÿæ›´åŠ å®¹æ˜“ã€‚åŸåˆ™ä¸ä»…ä»…é€‚ç”¨äºç±»ï¼Œå¯¹äºæ¥å£å’Œæ–¹æ³•ä¹Ÿé€‚ç”¨ï¼Œå³ä¸€ä¸ªæ¥å£/æ–¹æ³•ï¼Œåªè´Ÿè´£ä¸€ä»¶äº‹ï¼Œè¿™æ ·çš„è¯ï¼Œæ¥å£å°±ä¼šå˜å¾—ç®€å•ï¼Œæ–¹æ³•ä¸­çš„ä»£ç ä¹Ÿä¼šæ›´å°‘ï¼Œæ˜“è¯»ï¼Œä¾¿äºç»´æŠ¤ã€‚äº‹å®ä¸Šï¼Œç”±äºä¸€äº›å…¶ä»–çš„å› ç´ å½±å“ï¼Œç±»çš„å•ä¸€èŒè´£åœ¨é¡¹ç›®ä¸­æ˜¯å¾ˆéš¾ä¿è¯çš„ã€‚é€šå¸¸ï¼Œæ¥å£å’Œæ–¹æ³•çš„å•ä¸€èŒè´£æ›´å®¹æ˜“å®ç°ã€‚ å¥½å¤„ï¼š ä»£ç çš„ç²’åº¦é™ä½äº†ï¼Œç±»çš„å¤æ‚åº¦é™ä½äº†ã€‚ å¯è¯»æ€§æé«˜äº†ï¼Œæ¯ä¸ªç±»çš„èŒè´£éƒ½å¾ˆæ˜ç¡®ï¼Œå¯è¯»æ€§è‡ªç„¶æ›´å¥½ã€‚ å¯ç»´æŠ¤æ€§æé«˜äº†ï¼Œå¯è¯»æ€§æé«˜äº†ï¼Œä¸€æ—¦å‡ºç° bug ï¼Œè‡ªç„¶æ›´å®¹æ˜“æ‰¾åˆ°ä»–é—®é¢˜æ‰€åœ¨ã€‚ æ”¹åŠ¨ä»£ç æ‰€æ¶ˆè€—çš„èµ„æºé™ä½äº†ï¼Œæ›´æ”¹çš„é£é™©ä¹Ÿé™ä½äº†ã€‚ é«˜å†…èšã€ä½è€¦åˆ å‡è®¾æœ‰ä¸€ç±»Cï¼Œå«æœ‰loggingã€orderã€pay3ä¸ªæ–¹æ³•ï¼Œå®åˆ™å°±è¿™ä¸ªç±»å°±ä¸æ˜¯å•ä¸€æŒ‡è´£äº†ï¼ŒæŒ‰è¦æ±‚åæˆ‘ä»¬ä¿ç•™å•ä¸€æŒ‡è´£orderæ–¹æ³•ã€‚åæœŸéœ€æ±‚æ¥äº†ï¼Œæˆ‘ä»¬è¦å¯¹orderæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œäº§ç”Ÿäº†order1å’Œorder2ï¼Œå°½é‡åœ¨æ–¹æ³•çº§åˆ«ä¿ç•™äº†å•ä¸€æŒ‡è´£ï¼Œæˆ–è€…è¿™ä¸ªæ—¶å€™ä¿®æ”¹ä¸ºç±»C1å’ŒC2ï¼Œéƒ½æœ‰orderæ–¹æ³•ã€‚è¿™ä¸¤ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¾€å¾€é€‰æ‹©å‰è€…è¾ƒå¤šï¼Œä½†æ˜¯æœ‰äº›2è€…éƒ½ä¸é€‰æ‹©ï¼Œç›´æ¥å°±åœ¨ç±»Cä¸­orderæ–¹æ³•è¿›è¡Œä¿®æ”¹ï¼Œæ”¯æŒå¤šç§éœ€æ±‚ï¼Œåœ¨è¿™ä¸€æ­¥å°±è¿æ³•å•ä¸€æŒ‡è´£ã€‚éœ€æ±‚æœ‰å¯èƒ½åœ¨æœªæ¥å¯¼è‡´orderæ–¹æ³•æ‰©æ•£åˆ°nä¸ªã€‚è®°ä½ï¼Œåœ¨æŒ‡è´£æ‰©æ•£åˆ°æ— æ³•æ§åˆ¶æ—¶ï¼Œä¸€å®šè¦é‡æ„ã€‚ å¼€é—­åŸåˆ™ software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification. è½¯ä»¶å®ä½“å¦‚ç±»ã€æ¨¡å—ã€æ–¹æ³•ç­‰å¯¹äºæ‰©å±•å¼€æ”¾çš„ï¼Œä½†æ˜¯å¯¹äºä¿®æ”¹å°é—­çš„ã€‚ æˆ‘ä»¬è¯•æƒ³ä¸€ä¸‹ï¼Œäº§å“æ¥éœ€æ±‚äº†ï¼Œå¯¹æˆ‘ä»¬åŸæœ‰çš„ä»£ç è¦è¿›è¡Œå‡çº§æˆ–è€…æ”¹å˜çš„æ—¶å€™ï¼Œå¯èƒ½æˆ‘ä»¬åœ¨ä¿®æ”¹æ—§çš„ä¸šåŠ¡ä»£ç æ—¶ï¼Œå¾€å¾€ä¹Ÿä¼šæ–°å¢æ–°çš„bugï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ‰å¯èƒ½å› ä¸ºåŠŸèƒ½å¤æ‚æƒ…å†µä¸‹è¦å¯¹æ•´ä¸ªåŠŸèƒ½è¿›è¡Œé‡æ„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå°±åº”è¯¥æƒ³åˆ°å¼€é—­åŸåˆ™ï¼Œé€šè¿‡æ‰©å±•å®ç°æ”¹å˜è€Œä¸æ˜¯ä¿®æ”¹åŸæœ‰çš„ä¸œè¥¿ã€‚ æœ‰æ²¡æœ‰æ„Ÿè§‰ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚è¯´èµ·æ¥å¾ˆç®€å•ï¼Œæ„Ÿè§‰åƒå•¥ä¹Ÿæ²¡è¯´ä¸€æ ·ï¼Œå…·ä½“èµ·æ¥è¯¥å¦‚ä½•åšã€‚ Openâ€“closed principleä¸­ä¸€æ–‡æœ‰æè¿°ï¼Œé€šè¿‡ç»§æ‰¿æŠ½è±¡ç±»å’Œå®ç°æ¥å£ã€‚ å…¶å®ï¼Œè¿™ä¹Ÿæ­£æ˜¯æˆ‘ä»¬é¢å‘å¯¹è±¡ä¸­çš„æ¡†æ¶è®¾è®¡â€”â€“æŠ½è±¡ï¼Œç”¨æŠ½è±¡æ„å»ºæ¡†æ¶ï¼Œç”¨å®ç°æ‰©å±•ç»†èŠ‚ã€‚æˆ‘ä»¬é˜Ÿæ¡†æ¶è¿›è¡Œå…³é—­ï¼Œé€šè¿‡å®ç°ç»†èŠ‚è¿›è¡Œå¼€æ”¾ã€‚è€Œæˆ‘ä»¬çš„ä¸šåŠ¡å¸¸å¸¸å°±æ˜¯è¿™äº›ç»†èŠ‚ï¼Œé€šè¿‡ç»†èŠ‚çš„å®ç°ï¼Œæˆ‘ä»¬å°±èƒ½å®Œæˆæ‰©å±•ã€‚ä½†æ˜¯å‰ææ˜¯æˆ‘ä»¬çš„æ¡†æ¶è¦è¶³å¤ŸæŠ½è±¡åŒ–ï¼Œå…·æœ‰é’ˆå¯¹éœ€æ±‚çš„æ»¡è¶³æ€§ï¼Œè¦æœ‰è¶³å¤Ÿçš„é¢„åŸ‹æ€§ï¼Œè¿™å…¶å®ä¹Ÿæ˜¯éœ€è¦ä¸€å®šçš„ç»éªŒã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™ objects in a program should be replaceable with instances of their subtypes without altering the correctness of that program. ç¨‹åºä¸­çš„å¯¹è±¡åº”è¯¥æ˜¯å¯ä»¥åœ¨ä¸æ”¹å˜ç¨‹åºæ­£ç¡®æ€§çš„å‰æä¸‹è¢«å®ƒçš„å­ç±»æ‰€æ›¿æ¢çš„ã€‚ç®€å•ç‚¹ï¼Œå°±æ˜¯æˆ‘ç”¨åŸºç±»ä»£æ›¿å­ç±»çš„è¯ï¼Œç¨‹åºè¿˜æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯å¯¹çš„ã€‚ Liskov substitution principleæœ‰è®²æ˜é‡Œæ°æ›¿æ¢åŸåˆ™çš„æ¥è·¯ã€‚Barbara Liskovå¥³å£«æå‡ºæ¥çš„ã€‚ PDFä¸­æœ‰ç›¸å…³çš„ä»‹ç» æ˜¯è¿™ä¹ˆå®šä¹‰çš„ï¼š å®šä¹‰1ï¼šå¦‚æœå¯¹æ¯ä¸€ä¸ªç±»å‹ä¸º T1çš„å¯¹è±¡ o1ï¼Œéƒ½æœ‰ç±»å‹ä¸º T2 çš„å¯¹è±¡o2ï¼Œä½¿å¾—ä»¥ T1å®šä¹‰çš„æ‰€æœ‰ç¨‹åº P åœ¨æ‰€æœ‰çš„å¯¹è±¡ o1 éƒ½ä»£æ¢æˆ o2 æ—¶ï¼Œç¨‹åº P çš„è¡Œä¸ºæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç±»å‹ T2 æ˜¯ç±»å‹ T1 çš„å­ç±»å‹ã€‚ å®šä¹‰2ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚ é€šä¿—ç‚¹ç†è§£ï¼š ä¾‹å¦‚æœ‰ä¸¤ä¸ªç±»ï¼Œä¸€ä¸ªç±»ä¸ºBaseClassï¼Œå¦ä¸€ä¸ªæ˜¯SubClassç±»ï¼Œå¹¶ä¸”SubClassç±»æ˜¯BaseClassç±»çš„å­ç±»ï¼Œé‚£ä¹ˆä¸€ä¸ªæ–¹æ³•å¦‚æœå¯ä»¥æ¥å—ä¸€ä¸ªBaseClassç±»å‹çš„åŸºç±»å¯¹è±¡baseçš„è¯ï¼Œå¦‚ï¼šmethod1(base)ï¼Œé‚£ä¹ˆå®ƒå¿…ç„¶å¯ä»¥æ¥å—ä¸€ä¸ªBaseClassç±»å‹çš„å­ç±»å¯¹è±¡subï¼Œmethod1(sub)èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚åè¿‡æ¥çš„ä»£æ¢ä¸æˆç«‹ï¼Œå¦‚ä¸€ä¸ªæ–¹æ³•method2æ¥å—BaseClassç±»å‹çš„å­ç±»å¯¹è±¡subä¸ºå‚æ•°ï¼šmethod2(sub)ï¼Œé‚£ä¹ˆä¸€èˆ¬è€Œè¨€ä¸å¯ä»¥æœ‰method2(base)ï¼Œé™¤éæ˜¯é‡è½½æ–¹æ³•ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å®ç°å¼€é—­åŸåˆ™çš„é‡è¦æ–¹å¼ä¹‹ä¸€ï¼Œç”±äºä½¿ç”¨åŸºç±»å¯¹è±¡çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å­ç±»å¯¹è±¡ï¼Œå› æ­¤åœ¨ç¨‹åºä¸­å°½é‡ä½¿ç”¨åŸºç±»ç±»å‹æ¥å¯¹å¯¹è±¡è¿›è¡Œå®šä¹‰ï¼Œè€Œåœ¨è¿è¡Œæ—¶å†ç¡®å®šå…¶å­ç±»ç±»å‹ï¼Œç”¨å­ç±»å¯¹è±¡æ¥æ›¿æ¢çˆ¶ç±»å¯¹è±¡ã€‚ åœ¨ä½¿ç”¨é‡Œæ°ä»£æ¢åŸåˆ™æ—¶éœ€è¦æ³¨æ„å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š (1)å­ç±»çš„æ‰€æœ‰æ–¹æ³•å¿…é¡»åœ¨çˆ¶ç±»ä¸­å£°æ˜ï¼Œæˆ–å­ç±»å¿…é¡»å®ç°çˆ¶ç±»ä¸­å£°æ˜çš„æ‰€æœ‰æ–¹æ³•ã€‚æ ¹æ®é‡Œæ°ä»£æ¢åŸåˆ™ï¼Œä¸ºäº†ä¿è¯ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œåœ¨ç¨‹åºä¸­é€šå¸¸ä½¿ç”¨çˆ¶ç±»æ¥è¿›è¡Œå®šä¹‰ï¼Œå¦‚æœä¸€ä¸ªæ–¹æ³•åªå­˜åœ¨å­ç±»ä¸­ï¼Œåœ¨çˆ¶ç±»ä¸­ä¸æä¾›ç›¸åº”çš„å£°æ˜ï¼Œåˆ™æ— æ³•åœ¨ä»¥çˆ¶ç±»å®šä¹‰çš„å¯¹è±¡ä¸­ä½¿ç”¨è¯¥æ–¹æ³•ã€‚ (2) æˆ‘ä»¬åœ¨è¿ç”¨é‡Œæ°ä»£æ¢åŸåˆ™æ—¶ï¼Œå°½é‡æŠŠçˆ¶ç±»è®¾è®¡ä¸ºæŠ½è±¡ç±»æˆ–è€…æ¥å£ï¼Œè®©å­ç±»ç»§æ‰¿çˆ¶ç±»æˆ–å®ç°çˆ¶æ¥å£ï¼Œå¹¶å®ç°åœ¨çˆ¶ç±»ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œè¿è¡Œæ—¶ï¼Œå­ç±»å®ä¾‹æ›¿æ¢çˆ¶ç±»å®ä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ‰©å±•ç³»ç»Ÿçš„åŠŸèƒ½ï¼ŒåŒæ—¶æ— é¡»ä¿®æ”¹åŸæœ‰å­ç±»çš„ä»£ç ï¼Œå¢åŠ æ–°çš„åŠŸèƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªæ–°çš„å­ç±»æ¥å®ç°ã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¼€é—­åŸåˆ™çš„å…·ä½“å®ç°æ‰‹æ®µä¹‹ä¸€ã€‚ (3) Javaè¯­è¨€ä¸­ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µï¼ŒJavaç¼–è¯‘å™¨ä¼šæ£€æŸ¥ä¸€ä¸ªç¨‹åºæ˜¯å¦ç¬¦åˆé‡Œæ°ä»£æ¢åŸåˆ™ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸å®ç°æ— å…³çš„ã€çº¯è¯­æ³•æ„ä¹‰ä¸Šçš„æ£€æŸ¥ï¼Œä½†Javaç¼–è¯‘å™¨çš„æ£€æŸ¥æ˜¯æœ‰å±€é™çš„ã€‚ é‡Œæ°æ›¿æ¢åŸåˆ™é€šä¿—çš„æ¥è®²å°±æ˜¯ï¼šå­ç±»å¯ä»¥æ‰©å±•çˆ¶ç±»çš„åŠŸèƒ½ï¼Œä½†ä¸èƒ½æ”¹å˜çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ã€‚ 12345678910111213class A&#123; public int func1(int a, int b)&#123; return a-b; &#125;&#125;public class Client&#123; public static void main(String[] args)&#123; A a = new A(); System.out.println("100-50="+a.func1(100, 50)); System.out.println("100-80="+a.func1(100, 80)); &#125;&#125; è¿è¡Œç»“æœï¼š 100-50=50 100-80=20 123456789101112131415161718class B extends A&#123; public int func1(int a, int b)&#123; return a+b; &#125; public int func2(int a, int b)&#123; return func1(a,b)+100; &#125;&#125;public class Client&#123; public static void main(String[] args)&#123; B b = new B(); System.out.println("100-50="+b.func1(100, 50)); System.out.println("100-80="+b.func1(100, 80)); System.out.println("100+20+100="+b.func2(100, 20)); &#125;&#125; ç±»Bå®Œæˆåï¼Œè¿è¡Œç»“æœï¼š 100-50=150 100-80=180 100+20+100=220 é€šè¿‡è¿™ä¸ªä¸¾ä¾‹å¯ä»¥çœ‹å‡ºå­ç±»æ”¹å˜äº†çˆ¶ç±»åŸæœ‰çš„åŠŸèƒ½ï¼Œå­ç±»æ— æ„æˆ–è€…æœ‰æ„é‡å†™äº†çˆ¶ç±»çš„æ–¹æ³•ã€‚å¯¼è‡´æœ¬æ¥çš„å‡æ³•å˜æˆäº†åŠ æ³•ã€‚ æ¥å£éš”ç¦»åŸåˆ™ many client-specific interfaces are better than one general-purpose interface. å¤šä¸ªç‰¹å®šå®¢æˆ·ç«¯æ¥å£è¦å¥½äºä¸€ä¸ªå®½æ³›ç”¨é€”çš„æ¥å£ã€‚ å»ºç«‹å•ä¸€æ¥å£ï¼Œä¸è¦å»ºç«‹åºå¤§è‡ƒè‚¿çš„æ¥å£ï¼Œå°½é‡ç»†åŒ–æ¥å£ï¼Œæ¥å£ä¸­çš„æ–¹æ³•å°½é‡å°‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦ä¸ºå„ä¸ªç±»å»ºç«‹ä¸“ç”¨çš„æ¥å£ï¼Œè€Œä¸è¦è¯•å›¾å»å»ºç«‹ä¸€ä¸ªå¾ˆåºå¤§çš„æ¥å£ä¾›æ‰€æœ‰ä¾èµ–å®ƒçš„ç±»å»è°ƒç”¨ã€‚å°†ä¸€ä¸ªåºå¤§çš„æ¥å£å˜æ›´ä¸ºå¤šä¸ªä¸“ç”¨çš„æ¥å£æ‰€é‡‡ç”¨çš„å°±æ˜¯æ¥å£éš”ç¦»åŸåˆ™ã€‚ ä¾‹å¦‚ï¼šæ¥å£Iæœ‰5ä¸ªæ–¹æ³•M1,M2,M3,M4,M5ï¼Œå‡è®¾ç°åœ¨æœ‰3ä¸ªå®ç°ç±»C1å®ç°5åˆ†æ–¹æ³•ï¼Œå®ç°ç±»C2åªå®ç°å‰é¢3ä¸ªæ–¹æ³•M1,M2,M3å…¶ä»–2ä¸ªåˆ™æ˜¯ç©ºå®ç°ï¼Œå®ç°ç±»C3åªå®ç°M4,M5å…¶ä»–3ä¸ªåˆ™æ˜¯ç©ºå®ç°ã€‚è¿™ä¸ªæ—¶å€™å°±ä½“ç°å‡ºæ¥å£åºå¤§äº†ã€‚æ­¤æ—¶åº”å°†æ¥å£Iæ‹†åˆ†æˆæ¥å£I1æœ‰æ–¹æ³•M1,M2,M3ï¼Œæ¥å£I2æœ‰æ–¹æ³•M4,M5ã€‚è€Œå®ç°ç±»C1å®ç°æ¥å£I1å’ŒI2ï¼Œå®ç°ç±»C2å®ç°æ¥å£I1ï¼Œå®ç°ç±»C3å®ç°æ¥å£I2ã€‚ æ¥å£éš”ç¦»åŸåˆ™è·Ÿå•ä¸€èŒè´£åŸåˆ™å¾ˆç›¸ä¼¼ã€‚å…¶å®ä¸ç„¶ã€‚å…¶ä¸€ï¼Œå•ä¸€èŒè´£åŸåˆ™åŸæ³¨é‡çš„æ˜¯èŒè´£ï¼›è€Œæ¥å£éš”ç¦»åŸåˆ™æ³¨é‡å¯¹æ¥å£ä¾èµ–çš„éš”ç¦»ã€‚å…¶äºŒï¼Œå•ä¸€èŒè´£åŸåˆ™ä¸»è¦æ˜¯çº¦æŸç±»ï¼Œå…¶æ¬¡æ‰æ˜¯æ¥å£å’Œæ–¹æ³•ï¼Œå®ƒé’ˆå¯¹çš„æ˜¯ç¨‹åºä¸­çš„å®ç°å’Œç»†èŠ‚ï¼›è€Œæ¥å£éš”ç¦»åŸåˆ™ä¸»è¦çº¦æŸæ¥å£æ¥å£ï¼Œä¸»è¦é’ˆå¯¹æŠ½è±¡ï¼Œé’ˆå¯¹ç¨‹åºæ•´ä½“æ¡†æ¶çš„æ„å»ºã€‚ é‡‡ç”¨æ¥å£éš”ç¦»åŸåˆ™å¯¹æ¥å£è¿›è¡Œçº¦æŸæ—¶ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š æ¥å£å°½é‡å°ï¼Œä½†æ˜¯è¦æœ‰é™åº¦ã€‚å¯¹æ¥å£è¿›è¡Œç»†åŒ–å¯ä»¥æé«˜ç¨‹åºè®¾è®¡çµæ´»æ€§æ˜¯ä¸æŒ£çš„äº‹å®ï¼Œä½†æ˜¯å¦‚æœè¿‡å°ï¼Œåˆ™ä¼šé€ æˆæ¥å£æ•°é‡è¿‡å¤šï¼Œä½¿è®¾è®¡å¤æ‚åŒ–ã€‚æ‰€ä»¥ä¸€å®šè¦é€‚åº¦ã€‚ ä¸ºä¾èµ–æ¥å£çš„ç±»å®šåˆ¶æœåŠ¡ï¼Œåªæš´éœ²ç»™è°ƒç”¨çš„ç±»å®ƒéœ€è¦çš„æ–¹æ³•ï¼Œå®ƒä¸éœ€è¦çš„æ–¹æ³•åˆ™éšè—èµ·æ¥ã€‚åªæœ‰ä¸“æ³¨åœ°ä¸ºä¸€ä¸ªæ¨¡å—æä¾›å®šåˆ¶æœåŠ¡ï¼Œæ‰èƒ½å»ºç«‹æœ€å°çš„ä¾èµ–å…³ç³»ã€‚ æé«˜å†…èšï¼Œå‡å°‘å¯¹å¤–äº¤äº’ã€‚ä½¿æ¥å£ç”¨æœ€å°‘çš„æ–¹æ³•å»å®Œæˆæœ€å¤šçš„äº‹æƒ…ã€‚ è¿ç”¨æ¥å£éš”ç¦»åŸåˆ™ï¼Œä¸€å®šè¦é€‚åº¦ï¼Œæ¥å£è®¾è®¡çš„è¿‡å¤§æˆ–è¿‡å°éƒ½ä¸å¥½ã€‚è®¾è®¡æ¥å£çš„æ—¶å€™ï¼Œåªæœ‰å¤šèŠ±äº›æ—¶é—´å»æ€è€ƒå’Œç­¹åˆ’ï¼Œæ‰èƒ½å‡†ç¡®åœ°å®è·µè¿™ä¸€åŸåˆ™ã€‚ ä¾èµ–å€’ç½®åŸåˆ™ one should â€œdepend upon abstractions, [not] concretions. ä¾èµ–äºæŠ½è±¡è€Œä¸æ˜¯ä¸€ä¸ªå®ä¾‹ã€‚å…¶å®æƒ³æƒ³ä¾èµ–æ³¨å…¥æ˜¯è¯¥åŸåˆ™çš„ä¸€ç§å®ç°æ–¹å¼ã€‚ The principle states: High-level modules should not depend on low-level modules. Both should depend on abstractions). Abstractions should not depend on details. Details should depend on abstractions. ç¿»è¯‘è¿‡æ¥æ˜¯ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ã€‚ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ åœ¨Javaè¯­è¨€ä¸­çš„è¡¨ç°å°±æ˜¯ï¼šæ¨¡å—é—´çš„ä¾èµ–é€šè¿‡æŠ½è±¡å‘ç”Ÿï¼Œå®ç°ç±»ä¹‹é—´ä¸å‘ç”Ÿç›´æ¥çš„ä¾èµ–å…³ç³»ï¼Œå…¶ä¾èµ–å…³ç³»æ˜¯é€šè¿‡æ¥å£æˆ–æŠ½è±¡ç±»äº§ç”Ÿçš„ã€‚æ¥å£æˆ–æŠ½è±¡ç±»ä¸ä¾èµ–äºå®ç°ç±»ã€‚å®ç°ç±»ä¾èµ–äºæ¥å£æˆ–æŠ½è±¡ç±»ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå³æ‰€è°“çš„é¢å‘æ¥å£ç¼–ç¨‹ã€‚ ä¾èµ–å€’è½¬åŸåˆ™è¦æ±‚æˆ‘ä»¬åœ¨ç¨‹åºä»£ç ä¸­ä¼ é€’å‚æ•°æ—¶æˆ–åœ¨å…³è”å…³ç³»ä¸­ï¼Œå°½é‡å¼•ç”¨å±‚æ¬¡é«˜çš„æŠ½è±¡å±‚ç±»ï¼Œå³ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»è¿›è¡Œå˜é‡ç±»å‹å£°æ˜ã€å‚æ•°ç±»å‹å£°æ˜ã€æ–¹æ³•è¿”å›ç±»å‹å£°æ˜ï¼Œä»¥åŠæ•°æ®ç±»å‹çš„è½¬æ¢ç­‰ï¼Œè€Œä¸è¦ç”¨å…·ä½“ç±»æ¥åšè¿™äº›äº‹æƒ…ã€‚ä¸ºäº†ç¡®ä¿è¯¥åŸåˆ™çš„åº”ç”¨ï¼Œä¸€ä¸ªå…·ä½“ç±»åº”å½“åªå®ç°æ¥å£æˆ–æŠ½è±¡ç±»ä¸­å£°æ˜è¿‡çš„æ–¹æ³•ï¼Œè€Œä¸è¦ç»™å‡ºå¤šä½™çš„æ–¹æ³•ï¼Œå¦åˆ™å°†æ— æ³•è°ƒç”¨åˆ°åœ¨å­ç±»ä¸­å¢åŠ çš„æ–°æ–¹æ³•ã€‚ è¿™å¼ å›¾ï¼Œå…¶å®å°±å¾ˆå¥½çš„è¡¨è¾¾äº†ä¾èµ–å€’ç½®åŸåˆ™ï¼ŒObjectBåº”è¯¥ä¾èµ–InterfaceAå»ç”³æ˜ObjectAè€Œéç›´æ¥å»ä¾èµ–ObjectAï¼Œè€ŒObjectAä¹Ÿåº”è¯¥ä¾èµ–InterfaceAï¼Œè¿™å°±æ˜¯é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–åº•å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡å’Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä¸‹çš„ç¤ºä¾‹ï¼Œåˆšå¼€å§‹ï¼Œå­¦ç”Ÿåªæ˜¯ç®€å•çš„å®Œæˆå­¦æ ¡é‡Œçš„ç™½å¤©è¯¾å ‚ä½œä¸šã€‚ 12345678910111213141516public class SchoolWork &#123; public void work() &#123; System.out.println("å­¦ç”Ÿæ¯å¤©åœ¨å­¦æ ¡å°±å®Œæˆè¯¾å ‚ä½œä¸šäº†"); &#125;&#125;public class Student &#123; public void work(SchoolWork schoolWork) &#123; schoolWork.work(); &#125;&#125;//å®¢æˆ·ç«¯è°ƒç”¨Student student = new Student();SchoolWork work = new SchoolWork();student.work(work); æˆ‘ä»¬å‘ç°ï¼Œå­¦ç”Ÿæ¯å¤©éƒ½åœ¨è¯¾å ‚ä¸Šå°±å®Œæˆäº†ä½œä¸šï¼Œä½†æ˜¯éšç€æ—¶é—´æ…¢æ…¢çš„è¿‡å»ï¼Œå­¦ç”Ÿä»¬ï¼Œè¯¾å ‚ä½œä¸šå˜å¤šäº†ï¼Œè€å¸ˆå¼€å§‹å¸ƒç½®å®¶åº­ä½œä¸šäº†ã€‚é‚£ä¹ˆStudentç±»ä¸­å†å†™ä¸€ä¸ªå†™å®¶åº­ä½œä¸šçš„æ–¹æ³•å˜›ï¼Œä¸‡ä¸€è€å¸ˆåˆç»™å­¦ç”Ÿå¸ƒç½®å…¶ä»–ä½œä¸šåˆå†™ä¸€ç§æ–¹æ³•å—ï¼Œè‚¯å®šä¸æ˜¯çš„å•¦ã€‚ è¿™ä¸ªæ—¶å€™å°±éœ€è¦æŠŠä½œä¸šæŠ½è±¡èµ·æ¥äº†ï¼Œç”¨æ¥å£æˆ–è€…æŠ½è±¡ç±»éƒ½å¯ä»¥ã€‚ 12345678910111213141516171819202122232425262728public interface Work &#123; public void work();&#125;public class SchoolWork implements Work &#123; public void work() &#123; System.out.println("å­¦ç”Ÿæ¯å¤©åœ¨å­¦æ ¡å°±å®Œæˆè¯¾å ‚ä½œä¸šäº†"); &#125;&#125;public class HomeWork implements Work &#123; public void work() &#123; System.out.println("å­¦ç”Ÿæ¯å¤©åœ¨å®¶å°±å®Œæˆå®¶åº­ä½œä¸šäº†"); &#125;&#125;public class Student &#123; public void work(Work work) &#123; work.work(); &#125;&#125;//å®¢æˆ·ç«¯è°ƒç”¨Student student = new Student();Work work = new SchoolWork();student.work(work);work = new HomeWork();student.work(work); è¿™å°±æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚Work work = new SchoolWork();å’Œwork = new HomeWork();å°±æ˜¯å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æŠ½è±¡ç±»æˆ–è€…æ¥å£ã€‚ åœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éœ€è¦åšåˆ°å¦‚ä¸‹3ç‚¹ï¼š ä½å±‚æ¨¡å—å°½é‡éƒ½è¦æœ‰æŠ½è±¡ç±»æˆ–æ¥å£ï¼Œæˆ–è€…ä¸¤è€…éƒ½æœ‰ã€‚ å˜é‡çš„å£°æ˜ç±»å‹å°½é‡æ˜¯æŠ½è±¡ç±»æˆ–æ¥å£ã€‚ ä½¿ç”¨ç»§æ‰¿æ—¶éµå¾ªé‡Œæ°æ›¿æ¢åŸåˆ™ã€‚ è¿ªç±³ç‰¹æ³•åˆ™From Wikipedia, the free encyclopedia Each unit should have only limited knowledge about other units: only units â€œcloselyâ€ related to the current unit.Each unit should only talk to its friends; donâ€™t talk to strangers.Only talk to your immediate friends. æ¯ä¸ªå•ä½å¯¹å…¶ä»–å•ä½çš„äº†è§£åº”è¯¥æ˜¯æœ‰é™ï¼Œé™¤äº†è·Ÿè‡ªå·±ç›¸å¯¹å¯†åˆ‡çš„å•ä½ã€‚çš„ä¸è¦å’Œé™Œç”Ÿäººè¯´è¯å•Šï¼Œåªä¸ç›´æ¥çš„æœ‹å‹é€šä¿¡ã€‚ çœ‹å®Œä¹‹åï¼Œæ˜¯ä¸æ˜¯äº‘é‡Œé›¾é‡Œï¼Œä¸çŸ¥é“è¯´ä»€ä¹ˆé¸Ÿè¯­èŠ±é¦™ã€‚å…¶å®å°±æ˜¯ï¼Œä¸€ä¸ªå¯¹è±¡åº”è¯¥å¯¹å…¶ä»–å¯¹è±¡ä¿æŒæœ€å°‘çš„äº†è§£ã€‚å•Šï¼Œä½ è¿˜æ˜¯ä¸çŸ¥é“å®ƒè¯´äº†ä¸ªå•¥ã€‚é€šä¿—çš„è®²å°±æ˜¯ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šå°‘è¶Šå¥½ï¼Œä¹Ÿå°±æ˜¯å¯¹äºè¢«ä¾èµ–çš„ç±»ï¼Œå‘å¤–å…¬å¼€çš„æ–¹æ³•åº”è¯¥å°½å¯èƒ½çš„å°‘(å°½å¯èƒ½çš„ä¸ç”¨ç”¨publicä¿®é¥°æ–¹æ³•)ã€‚å¯¹äºä¸Šé¢çš„æœ‹å‹çš„å®šä¹‰æ¥è®²ï¼Œä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„è€¦åˆå…³ç³»ç§°ä¹‹ä¸ºæœ‹å‹ï¼Œé€šå¸¸æœ‰ä¾èµ–ã€å…³è”ã€èšåˆå’Œç»„æˆç­‰ã€‚è€Œç›´æ¥æœ‹å‹åˆ™é€šå¸¸è¡¨ç°ä¸ºå…³è”ã€èšåˆå’Œç»„æˆå…³ç³»ï¼Œå³ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´è”ç³»æ›´ä¸ºç´§å¯†ï¼Œé€šå¸¸ä»¥æˆå‘˜å˜é‡ã€æ–¹æ³•çš„å‚æ•°å’Œè¿”å›å€¼çš„å½¢å¼å‡ºç°ã€‚åŒæ—¶äº†é™Œç”Ÿçš„ç±»æœ€å¥½ä¸è¦ä½œä¸ºå±€éƒ¨å˜é‡çš„å½¢å¼å‡ºç°åœ¨ç±»çš„å†…éƒ¨ã€‚ æœ‹å‹äº†ä¹Ÿæ˜¯æœ‰è¿™æ ·å‡ ç§å®šä¹‰çš„ å½“å‰å¯¹è±¡æœ¬èº«(this)ï¼› ä»¥å‚æ•°å½¢å¼ä¼ å…¥åˆ°å½“å‰å¯¹è±¡æ–¹æ³•ä¸­çš„å¯¹è±¡ï¼› å½“å‰å¯¹è±¡çš„æˆå‘˜å¯¹è±¡ï¼Œå¦‚æœå½“å‰å¯¹è±¡çš„æˆå‘˜å¯¹è±¡æ˜¯ä¸€ä¸ªé›†åˆï¼Œé‚£ä¹ˆé›†åˆä¸­çš„å…ƒç´ ä¹Ÿéƒ½æ˜¯æœ‹å‹ï¼› å½“å‰å¯¹è±¡æ‰€åˆ›å»ºçš„å¯¹è±¡ã€‚ æ¥çœ‹ä¸ªç¤ºä¾‹ï¼Œå…³è®¡ç®—æœºçš„ä¸šåŠ¡ã€‚ ä¸»è¦æ˜¯é’ˆå¯¹åªæš´éœ²åº”è¯¥æš´éœ²çš„æ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647//è®¡ç®—æœºç±»public class Computer&#123; public void saveCurrentTask()&#123; //do something &#125; public void closeService()&#123; //do something &#125; public void closeScreen()&#123; //do something &#125; public void closePower()&#123; //do something &#125; public void close()&#123; saveCurrentTask(); closeService(); closeScreen(); closePower(); &#125;&#125;//äººpublic class Person&#123; private Computer c; ... public void clickCloseButton()&#123; //ç°åœ¨ä½ è¦å¼€å§‹å…³é—­è®¡ç®—æœºäº†ï¼Œæ­£å¸¸æ¥è¯´ä½ åªéœ€è¦è°ƒç”¨closeï¼ˆï¼‰æ–¹æ³•å³å¯ï¼Œ //ä½†æ˜¯ä½ å‘ç°Computeræ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯å…¬å¼€çš„ï¼Œè¯¥æ€ä¹ˆå…³é—­å‘¢ï¼Ÿäºæ˜¯ä½ å†™ä¸‹äº†ä»¥ä¸‹å…³é—­çš„æµç¨‹ï¼š c.saveCurrentTask(); c.closePower(); c.close(); //äº¦æˆ–æ˜¯ä»¥ä¸‹çš„æ“ä½œ c.closePower(); //è¿˜å¯èƒ½æ˜¯ä»¥ä¸‹çš„æ“ä½œ c.close(); c.closePower(); &#125;&#125; ä»è¢«ä¾èµ–è€…çš„è§’åº¦ï¼Œåªåº”è¯¥æš´éœ²åº”è¯¥æš´éœ²çš„æ–¹æ³•ã€‚é‚£ä¹ˆè¿™é‡Œçš„cå¯¹è±¡åº”è¯¥å“ªäº›æ–¹æ³•åº”è¯¥æ˜¯è¢«æš´éœ²çš„å‘¢ï¼Ÿå¾ˆæ˜¾ç„¶ï¼Œå¯¹äºPersonæ¥è¯´ï¼Œåªéœ€è¦å…³æ³¨è®¡ç®—æœºçš„å…³é—­æ“ä½œï¼Œè€Œä¸å…³å¿ƒè®¡ç®—æœºä¼šå¦‚ä½•å¤„ç†è¿™ä¸ªå…³é—­æ“ä½œï¼Œå› æ­¤åªéœ€è¦æš´éœ²closeï¼ˆï¼‰æ–¹æ³•å³å¯ã€‚ 1234567891011121314151617181920212223242526272829303132333435//è®¡ç®—æœºç±»public class Computer&#123; private void saveCurrentTask()&#123; //do something &#125; private void closeService()&#123; //do something &#125; private void closeScreen()&#123; //do something &#125; private void closePower()&#123; //do something &#125; public void close()&#123; saveCurrentTask(); closeService(); closeScreen(); closePower(); &#125;&#125;//äººpublic class Person&#123; private Computer c; ... public void clickCloseButton()&#123; c.close(); &#125;&#125; å†æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œåªä¾èµ–åº”è¯¥ä¾èµ–çš„å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536373839public class A &#123; public D do(B b) &#123; C c = b.getC().; c.doSomething(); D d = c.getResult() return d; &#125;&#125;@Datapublic class B &#123; private C c;&#125;@Datapublic class C &#123; public void doSomething() &#123; //..... &#125; public D getResult() &#123; //..... return new D(); &#125;&#125;@Datapublic class D &#123; //.......&#125;public class Client &#123; public void main(String[] args) &#123; A a = new A(); B b = new B(); System.out.println(a.do(b)); &#125;&#125; ä»ä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œåœ¨Aç±»çš„doæ–¹æ³•ä¸­ï¼Œç±»Cå…¶å®ç›¸å¯¹äºç±»Aæ¥è¯´å°±æ˜¯é™Œç”Ÿäººï¼Œé«˜è€¦åˆåœ¨Aç±»ä¸­ã€‚å‡è®¾æ—¥åï¼Œæˆ‘ä»¬å¯¹Cç±»çš„doSomethingå’ŒgetResultæ–¹æ³•æ”¹åŠ¨æ—¶ï¼Œå°±ä¼šå½±å“åˆ°ç±»Aã€‚ è‡³äºå¦‚ä½•ä¿®æ”¹ï¼Œæƒ³çœ‹çœ‹çœ‹å®˜ä»¬æœ‰ä»€ä¹ˆå»ºè®®æˆ–è€…å®ç°ï¼Œæ¬¢è¿ç•™è¨€ã€‚ æ€»çš„æ¥è¯´ï¼Œåœ¨å°†è¿ªç±³ç‰¹æ³•åˆ™è¿ç”¨åˆ°ç³»ç»Ÿè®¾è®¡ä¸­æ—¶ï¼Œè¦æ³¨æ„ä¸‹é¢çš„å‡ ç‚¹ï¼šåœ¨ç±»çš„åˆ’åˆ†ä¸Šï¼Œåº”å½“å°½é‡åˆ›å»ºæ¾è€¦åˆçš„ç±»ï¼Œç±»ä¹‹é—´çš„è€¦åˆåº¦è¶Šä½ï¼Œå°±è¶Šæœ‰åˆ©äºå¤ç”¨ï¼Œä¸€ä¸ªå¤„åœ¨æ¾è€¦åˆä¸­çš„ç±»ä¸€æ—¦è¢«ä¿®æ”¹ï¼Œä¸ä¼šå¯¹å…³è”çš„ç±»é€ æˆå¤ªå¤§æ³¢åŠï¼›åœ¨ç±»çš„ç»“æ„è®¾è®¡ä¸Šï¼Œæ¯ä¸€ä¸ªç±»éƒ½åº”å½“å°½é‡é™ä½å…¶æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°çš„è®¿é—®æƒé™ï¼›åœ¨ç±»çš„è®¾è®¡ä¸Šï¼Œåªè¦æœ‰å¯èƒ½ï¼Œä¸€ä¸ªç±»å‹åº”å½“è®¾è®¡æˆä¸å˜ç±»ï¼›åœ¨å¯¹å…¶ä»–ç±»çš„å¼•ç”¨ä¸Šï¼Œä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä»–å¯¹è±¡çš„å¼•ç”¨åº”å½“é™åˆ°æœ€ä½ã€‚é«˜å†…èšï¼Œä½è€¦åˆã€‚ åˆæˆå¤ç”¨åŸåˆ™ä¹Ÿç§°ä¸ºåˆæˆ/èšåˆå¤ç”¨åŸåˆ™ï¼Œè¦å°½é‡å…ˆä½¿ç”¨ç»„åˆæˆ–è€…èšåˆç­‰å…³è”å…³ç³»æ¥å®ç°ï¼Œå…¶æ¬¡æ‰è€ƒè™‘ä½¿ç”¨ç»§æ‰¿å…³ç³»æ¥å®ç°ã€‚ å…¶åŸåˆ™å°±æ˜¯åœ¨ä¸€ä¸ªæ–°çš„å¯¹è±¡é‡Œé¢ä½¿ç”¨ä¸€äº›å·²æœ‰çš„å¯¹è±¡ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼›æ–°çš„å¯¹è±¡é€šè¿‡å‘è¿™äº›å¯¹è±¡çš„å§”æ´¾è¾¾åˆ°å¤ç”¨å·²æœ‰åŠŸèƒ½çš„ç›®çš„ã€‚ å¦‚æœä¸¤ä¸ªç±»ä¹‹é—´æ˜¯â€œHas-Aâ€çš„å…³ç³»åº”ä½¿ç”¨ç»„åˆæˆ–èšåˆï¼Œå¦‚æœæ˜¯â€œIs-Aâ€å…³ç³»å¯ä½¿ç”¨ç»§æ‰¿ã€‚â€Is-Aâ€æ˜¯ä¸¥æ ¼çš„åˆ†ç±»å­¦æ„ä¹‰ä¸Šçš„å®šä¹‰ï¼Œæ„æ€æ˜¯ä¸€ä¸ªç±»æ˜¯å¦ä¸€ä¸ªç±»çš„â€ä¸€ç§â€ï¼›è€Œâ€Has-Aâ€åˆ™ä¸åŒï¼Œå®ƒè¡¨ç¤ºæŸä¸€ä¸ªè§’è‰²å…·æœ‰æŸä¸€é¡¹è´£ä»»ã€‚ èšåˆï¼ˆAggregationï¼‰è¡¨ç¤ºä¸€ç§å¼±çš„â€˜æ‹¥æœ‰â€™å…³ç³»ï¼Œä½“ç°çš„æ˜¯Aå¯¹è±¡å¯ä»¥åŒ…å«Bå¯¹è±¡ä½†Bå¯¹è±¡ä¸æ˜¯Aå¯¹è±¡çš„ä¸€éƒ¨åˆ†ã€‚å¦‚ä¸Šå›¾ä¸­çš„å¤§é›å±äºé›ç¾¤çš„ï¼Œä¸€ä¸ªé›ç¾¤æ˜¯æœ‰å¾ˆå¤šå¤§é›ã€‚èšåˆå…³ç³»ç”¨ç©ºå¿ƒçš„è±å½¢+å®çº¿æ¥è¡¨ç¤ºã€‚ åˆæˆï¼ˆCompositionï¼‰åˆ™æ˜¯ä¸€ç§å¼ºçš„â€™æ‹¥æœ‰â€™å…³ç³»ï¼Œä½“ç°äº†ä¸¥æ ¼çš„éƒ¨åˆ†å’Œæ•´ä½“å…³ç³»ï¼Œéƒ¨åˆ†å’Œæ•´ä½“çš„ç”Ÿå‘½å‘¨æœŸä¸€æ ·ã€‚ä¾‹å¦‚ä¸Šå›¾å¤§é›äººæ˜¯æœ‰å¤´ã€ç¿…è†€ç­‰åˆæˆçš„ï¼Œå¤§é›å’Œå¤´ã€ç¿…è†€çš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä¸€æ ·çš„ï¼Œå¤§å®¶ä¸€èµ·ç©å®Œã€‚åˆæˆå…³ç³»ç”¨å®å¿ƒçš„è±å½¢+å®çº¿æ¥è¡¨ç¤ºã€‚ é€šå¸¸ç±»çš„å¤ç”¨åˆ†ä¸ºç»§æ‰¿å¤ç”¨å’Œåˆæˆå¤ç”¨ ä¸¤ç§ï¼Œç»§æ‰¿å¤ç”¨è™½ç„¶æœ‰ç®€å•å’Œæ˜“å®ç°çš„ä¼˜ç‚¹ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä»¥ä¸‹ç¼ºç‚¹ã€‚ ç»§æ‰¿å¤ç”¨ç ´åäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºç»§æ‰¿ä¼šå°†çˆ¶ç±»çš„å®ç°ç»†èŠ‚æš´éœ²ç»™å­ç±»ï¼Œçˆ¶ç±»å¯¹å­ç±»æ˜¯é€æ˜çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œç™½ç®±â€å¤ç”¨ã€‚ å­ç±»ä¸çˆ¶ç±»çš„è€¦åˆåº¦é«˜ã€‚çˆ¶ç±»çš„å®ç°çš„ä»»ä½•æ”¹å˜éƒ½ä¼šå¯¼è‡´å­ç±»çš„å®ç°å‘ç”Ÿå˜åŒ–ï¼Œè¿™ä¸åˆ©äºç±»çš„æ‰©å±•ä¸ç»´æŠ¤ã€‚ å®ƒé™åˆ¶äº†å¤ç”¨çš„çµæ´»æ€§ã€‚ä»çˆ¶ç±»ç»§æ‰¿è€Œæ¥çš„å®ç°æ˜¯é™æ€çš„ï¼Œåœ¨ç¼–è¯‘æ—¶å·²ç»å®šä¹‰ï¼Œæ‰€ä»¥åœ¨è¿è¡Œæ—¶ä¸å¯èƒ½å‘ç”Ÿå˜åŒ–ã€‚ é‡‡ç”¨ç»„åˆæˆ–èšåˆå¤ç”¨æ—¶ï¼Œå¯ä»¥å°†å·²æœ‰å¯¹è±¡çº³å…¥æ–°å¯¹è±¡ä¸­ï¼Œä½¿ä¹‹æˆä¸ºæ–°å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œæ–°å¯¹è±¡å¯ä»¥è°ƒç”¨å·²æœ‰å¯¹è±¡çš„åŠŸèƒ½ï¼Œå®ƒæœ‰ä»¥ä¸‹ä¼˜ç‚¹ã€‚ å®ƒç»´æŒäº†ç±»çš„å°è£…æ€§ã€‚å› ä¸ºæˆåˆ†å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚æ˜¯æ–°å¯¹è±¡çœ‹ä¸è§çš„ï¼Œæ‰€ä»¥è¿™ç§å¤ç”¨åˆç§°ä¸ºâ€œé»‘ç®±â€å¤ç”¨ã€‚ æ–°æ—§ç±»ä¹‹é—´çš„è€¦åˆåº¦ä½ã€‚è¿™ç§å¤ç”¨æ‰€éœ€çš„ä¾èµ–è¾ƒå°‘ï¼Œæ–°å¯¹è±¡å­˜å–æˆåˆ†å¯¹è±¡çš„å”¯ä¸€æ–¹æ³•æ˜¯é€šè¿‡æˆåˆ†å¯¹è±¡çš„æ¥å£ã€‚ å¤ç”¨çš„çµæ´»æ€§é«˜ã€‚è¿™ç§å¤ç”¨å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€è¿›è¡Œï¼Œæ–°å¯¹è±¡å¯ä»¥åŠ¨æ€åœ°å¼•ç”¨ä¸æˆåˆ†å¯¹è±¡ç±»å‹ç›¸åŒçš„å¯¹è±¡ã€‚ æ€»ç»“å•ä¸€èŒè´£åŸåˆ™å‘Šè¯‰æˆ‘ä»¬å®ç°ç±»è¦èŒè´£å•ä¸€ï¼›é‡Œæ°æ›¿æ¢åŸåˆ™å‘Šè¯‰æˆ‘ä»¬ä¸è¦ç ´åç»§æ‰¿ä½“ç³»ï¼›ä¾èµ–å€’ç½®åŸåˆ™å‘Šè¯‰æˆ‘ä»¬è¦é¢å‘æ¥å£ç¼–ç¨‹ï¼›æ¥å£éš”ç¦»åŸåˆ™å‘Šè¯‰æˆ‘ä»¬åœ¨è®¾è®¡æ¥å£çš„æ—¶å€™è¦ç²¾ç®€å•ä¸€ï¼›è¿ªç±³ç‰¹æ³•åˆ™å‘Šè¯‰æˆ‘ä»¬è¦é™ä½è€¦åˆã€‚è€Œå¼€é—­åŸåˆ™æ˜¯æ€»çº²ï¼Œä»–å‘Šè¯‰æˆ‘ä»¬è¦å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚ å‚è€ƒSOLID Design Principles Explained The SOLID Principles in Real Life S.O.L.I.D: The First 5 Principles of Object Oriented Design SOLID è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™â€”â€”SOLID è½¯ä»¶è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™ æµ…è°ˆ SOLID åŸåˆ™çš„å…·ä½“ä½¿ç”¨ ç™½è¯è®¾è®¡â€”â€”æµ…è°ˆè¿ªç±³ç‰¹æ³•åˆ™ åˆæˆå¤ç”¨åŸåˆ™â€”â€”é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹è¿­ä»£å™¨æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F02%2Fdesign-pattern-iterator%2F</url>
    <content type="text"><![CDATA[è¿­ä»£å™¨æ¨¡å¼ Provide a way to access the elements of an aggregate object sequentially without exposing its underlying representation. æä¾›ä¸€ç§ä¸å…¬ç¤ºå…¶åº•å±‚ç»†èŠ‚(ç»“æ„)çš„æƒ…å†µä¸‹èƒ½é¡ºåºè®¿é—®èšåˆå¯¹è±¡å…ƒç´ çš„æ–¹æ³•ã€‚å…¶å®åœ¨javaä½“ç³»ä¸­ï¼Œjdkå·²ç»å¼•å…¥äº†è¿­ä»£å™¨æ¥å£ä»¥åŠå¯¹äºçš„å®¹å™¨æ¥å£ç­‰ã€‚å°±æ‹¿è¿­ä»£å™¨ä¸­çš„è§’è‰²ï¼Œåœ¨javaä¸­æ‰¾å‡ºå…¶å¯¹åº”çš„ç±»ã€‚ å…·ä½“è§’è‰² (1)è¿­ä»£å™¨è§’è‰²(Iterator)ï¼šå®šä¹‰éå†å…ƒç´ æ‰€éœ€è¦çš„æ–¹æ³•ï¼Œä¸€èˆ¬æ¥è¯´ä¼šæœ‰è¿™ä¹ˆä¸‰ä¸ªæ–¹æ³•ï¼šå–å¾—ä¸‹ä¸€ä¸ªå…ƒç´ çš„æ–¹æ³•next()ï¼Œåˆ¤æ–­æ˜¯å¦éå†ç»“æŸçš„æ–¹æ³•hasNext()ï¼‰ï¼Œç§»å‡ºå½“å‰å¯¹è±¡çš„æ–¹æ³•remove(), (2)å…·ä½“è¿­ä»£å™¨è§’è‰²(Concrete Iterator)ï¼šå®ç°è¿­ä»£å™¨æ¥å£ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå®Œæˆé›†åˆçš„è¿­ä»£ã€‚ (3)å®¹å™¨è§’è‰²(Aggregate): ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ¥å£ï¼Œæä¾›ä¸€ä¸ªiterator()æ–¹æ³•ï¼Œä¾‹å¦‚javaä¸­çš„Collectionæ¥å£ï¼ŒListæ¥å£ï¼ŒSetæ¥å£ç­‰ (4)å…·ä½“å®¹å™¨è§’è‰²(ConcreteAggregate)ï¼šå°±æ˜¯æŠ½è±¡å®¹å™¨çš„å…·ä½“å®ç°ç±»ï¼Œæ¯”å¦‚Listæ¥å£çš„æœ‰åºåˆ—è¡¨å®ç°ArrayListï¼ŒListæ¥å£çš„é“¾è¡¨å®ç°LinkListï¼ŒSetæ¥å£çš„å“ˆå¸Œåˆ—è¡¨çš„å®ç°HashSetç­‰ã€‚ å•ç‹¬ä¸¾å‡ºArrayListçš„è§’è‰²ï¼Œ è¿­ä»£å™¨è§’è‰²å¯¹åº”javaä¸­çš„java.lang.Iteratorï¼Œè¿™ä¸ªè¿­ä»£å™¨æ˜¯javaå®¹å™¨å…¬ç”¨çš„ã€‚ å®¹å™¨è§’è‰²å¯¹åº”java.lang.Iterableï¼Œå…¶è¿˜æœ‰Iterator iterator()æ–¹æ³•è·å–è¿­ä»£å™¨ã€‚ å…·ä½“è¿­ä»£å™¨è§’è‰²å¯¹åº”java.lang.ArrayList.Itrï¼Œå®ç°äº†å¯¹åº”çš„hasNextã€nextã€removeæ–¹æ³•ã€‚ å…·ä½“å®¹å™¨è§’è‰²é‚£å°±æ˜¯java.lang.ArrayListäº†ï¼Œå®ç°iteratoræ–¹æ³•è¿”å›Itrå…·ä½“è¿­ä»£å™¨ï¼Œç”¨æ¸¸æ ‡å½¢å¼å®ç°ã€‚ å†çœ‹çœ‹UMLç±» é¡¹ç›®å®ä¾‹æºç åœ¨Github é¡¹ç›®ä¸­å¾ˆç®€å•çš„å®ç°äº†ä¸€ä¸ªå®¹å™¨å’Œè¿­ä»£å™¨ã€‚å¤§è‡´å‚è€ƒäº†ArrayListå®ç°ï¼Œä½†æ˜¯æ˜¯ç®€æ´ç‰ˆæœ¬ï¼Œå»é™¤å¾ˆå¤šæ— å…³ä»¥åŠæ€§èƒ½ä¸Šçš„ä¸œè¥¿ï¼Œåªä¿ç•™æœ€åŸºæœ¬çš„è¿­ä»£å™¨å…ƒç´ ã€‚ 12345678910111213141516@Slf4jpublic class Application &#123; public static void main(String[] args) &#123; Aggregate&lt;Integer&gt; aggregate = new ConcreteAggregate&lt;&gt;(); aggregate.add(1); aggregate.add(2); aggregate.add(3); aggregate.add(4); Iterator&lt;Integer&gt; iterator = aggregate.iterator(); while (iterator.hasNext()) &#123; log.info("å¾ªç¯æ•°æ®&#123;&#125;", iterator.next()); &#125; &#125;&#125; æ‰§è¡Œç»“æœå¦‚ä¸‹ ç®€å•çš„è¿­ä»£å™¨å®šä¹‰ 1234567public interface Iterator&lt;E&gt; &#123; boolean hasNext(); E next();&#125; ç®€å•å®¹å™¨å®šä¹‰ 1234567public interface Aggregate&lt;T&gt; &#123; Iterator&lt;T&gt; iterator(); void add(T t);&#125; å…·ä½“å®¹å™¨å’Œå…·ä½“çš„è¿­ä»£å™¨å®šä¹‰ 123456789101112131415161718192021222324252627282930313233343536373839404142public class ConcreteAggregate&lt;E&gt; implements Aggregate&lt;E&gt; &#123; private Object[] elements; private int size = 0; public ConcreteAggregate() &#123; elements = new Object[16]; &#125; public int getSize() &#123; return size; &#125; public void add(E e) &#123; elements[size++] = e; &#125; @Override public Iterator&lt;E&gt; iterator() &#123; return new ConcreteIterator&lt;E&gt;(); &#125; private class ConcreteIterator&lt;E&gt; implements Iterator&lt;E&gt; &#123; int cursor; @Override public boolean hasNext() &#123; return cursor != size; &#125; @Override public E next() &#123; if (cursor &gt;= size) &#123; return null; &#125; return (E) elements[cursor++]; &#125; &#125;&#125; å…·ä½“å®¹å™¨ä¸­ç”¨æ•°ç»„æ¥ä½œä¸ºå®¹å™¨æ¥å­˜å‚¨å…ƒç´ ï¼Œè€Œä¸”æœ€ç®€å•çš„å®¹å™¨ï¼Œå›ºå®šäº†å¤§å°ï¼Œå¹¶æ²¡æœ‰å®ç°æ‰©å®¹çš„ç®—æ³•ç­‰ç­‰ï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„æ ·ä¾‹ï¼Œä½†æ˜¯å¤§éƒ¨åˆ†ä¸Šï¼Œéƒ½æ˜¯ç›´æ¥ä½¿ç”¨javaå¸¦æœ‰çš„è¿­ä»£å™¨ã€‚ ä¼˜ç‚¹ ç®€åŒ–äº†éå†æ–¹å¼ï¼Œå¯¹äºå¯¹è±¡é›†åˆçš„éå†ï¼Œè¿˜æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå¯¹äºæ•°ç»„æˆ–è€…æœ‰åºåˆ—è¡¨ï¼Œæˆ‘ä»¬å°šå¯ä»¥é€šè¿‡æ¸¸æ ‡æ¥å–å¾—ï¼Œä½†ç”¨æˆ·éœ€è¦åœ¨å¯¹é›†åˆäº†è§£å¾ˆæ¸…æ¥šçš„å‰æä¸‹ï¼Œè‡ªè¡Œéå†å¯¹è±¡ï¼Œä½†æ˜¯å¯¹äºhashè¡¨æ¥è¯´ï¼Œç”¨æˆ·éå†èµ·æ¥å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚è€Œå¼•å…¥äº†è¿­ä»£å™¨æ–¹æ³•åï¼Œç”¨æˆ·ç”¨èµ·æ¥å°±ç®€å•çš„å¤šäº†ã€‚ å¯ä»¥æä¾›å¤šç§éå†æ–¹å¼ï¼Œæ¯”å¦‚è¯´å¯¹æœ‰åºåˆ—è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®éœ€è¦æä¾›æ­£åºéå†ï¼Œå€’åºéå†ä¸¤ç§è¿­ä»£å™¨ï¼Œç”¨æˆ·ç”¨èµ·æ¥åªéœ€è¦å¾—åˆ°æˆ‘ä»¬å®ç°å¥½çš„è¿­ä»£å™¨ï¼Œå°±å¯ä»¥æ–¹ä¾¿çš„å¯¹é›†åˆè¿›è¡Œéå†äº†ã€‚ å°è£…æ€§è‰¯å¥½ï¼Œç”¨æˆ·åªéœ€è¦å¾—åˆ°è¿­ä»£å™¨å°±å¯ä»¥éå†ï¼Œè€Œå¯¹äºéå†ç®—æ³•åˆ™ä¸ç”¨å»å…³å¿ƒã€‚ ç¼ºç‚¹ç”±äºè¿­ä»£å™¨æ¨¡å¼å°†å­˜å‚¨æ•°æ®å’Œéå†æ•°æ®çš„èŒè´£åˆ†ç¦»ï¼Œå¢åŠ æ–°çš„èšåˆç±»éœ€è¦å¯¹åº”å¢åŠ æ–°çš„è¿­ä»£å™¨ç±»ï¼Œç±»çš„ä¸ªæ•°æˆå¯¹å¢åŠ ï¼Œè¿™åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚æ€§ã€‚ å¯¹äºæ¯”è¾ƒç®€å•çš„éå†ï¼ˆåƒæ•°ç»„æˆ–è€…æœ‰åºåˆ—è¡¨ï¼‰ï¼Œä½¿ç”¨è¿­ä»£å™¨æ–¹å¼éå†è¾ƒä¸ºç¹çï¼Œå¤§å®¶å¯èƒ½éƒ½æœ‰æ„Ÿè§‰ï¼ŒåƒArrayListï¼Œæˆ‘ä»¬å®å¯æ„¿æ„ä½¿ç”¨forå¾ªç¯å’Œgetæ–¹æ³•æ¥éå†é›†åˆã€‚ æ€»ç»“è¿­ä»£å™¨æ¨¡å¼æ˜¯ä¸é›†åˆå…±ç”Ÿå…±æ­»çš„ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åªè¦å®ç°ä¸€ä¸ªé›†åˆï¼Œå°±éœ€è¦åŒæ—¶æä¾›è¿™ä¸ªé›†åˆçš„è¿­ä»£å™¨ï¼Œå°±åƒjavaä¸­çš„Collectionï¼ŒListã€Setã€Mapç­‰ï¼Œè¿™äº›é›†åˆéƒ½æœ‰è‡ªå·±çš„è¿­ä»£å™¨ã€‚å‡å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªè¿™æ ·çš„æ–°çš„å®¹å™¨ï¼Œå½“ç„¶ä¹Ÿéœ€è¦å¼•å…¥è¿­ä»£å™¨æ¨¡å¼ï¼Œç»™æˆ‘ä»¬çš„å®¹å™¨å®ç°ä¸€ä¸ªè¿­ä»£å™¨ã€‚ å‚è€ƒwikiçš„è¿­ä»£å™¨æ¨¡å¼ è¿­ä»£å™¨æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Javaè®¾è®¡æ¨¡å¼ç³»åˆ—ä¹‹è¿­ä»£å™¨æ¨¡å¼]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>è¿­ä»£å™¨</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼]]></title>
    <url>%2F2019%2F01%2F02%2Fdesign-pattern-command%2F</url>
    <content type="text"><![CDATA[å‘½ä»¤æ¨¡å¼ wikiä¸Šçš„æè¿° Encapsulate a request as an object, thereby allowing for the parameterization of clients with different requests, and the queuing or logging of requests. It also allows for the support of undoable operations. ç¿»è¯‘æ„æ€ï¼ŒæŠŠè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œå…è®¸æˆ‘ä»¬å¯ä»¥å¯¹å®¢æˆ·ç«¯çš„ä¸åŒè¯·æ±‚è¿›è¡Œå‚æ•°åŒ–ï¼Œä»¥åŠå¯¹è¯·æ±‚è¿›è¡Œæ’é˜Ÿæˆ–è®°å½•ã€‚è¿˜å…è®¸æ”¯æŒæ’¤é”€æ“ä½œã€‚çœ‹èµ·æ¥å¥½åƒå¾ˆå¤æ‚ï¼Œå¾ˆéš¾ç†è§£ã€‚ é€šä¿—ç®€å•ç†è§£ï¼Œå®ƒå°±æ˜¯å°†è¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨è¿™é‡Œå°±æ˜¯è¿™ä¸ªå¯¹è±¡å°±æ˜¯å‘½ä»¤ï¼Œè€Œè¿™ä¸ªå‘½ä»¤å°±æ˜¯å°†è¯·æ±‚æ–¹å’Œæ‰§è¡Œæ–¹åˆ†ç¦»éš”å¼€ã€‚ä»è€Œæ¯ä¸€ä¸ªå‘½ä»¤å…¶å®å°±æ˜¯æ“ä½œï¼Œè€Œè¿™æ ·çš„æµç¨‹å°±æ˜¯è¯·æ±‚æ–¹å‘å‡ºè¯·æ±‚è¦æ±‚æ‰§è¡ŒæŸæ“ä½œï¼Œæ¥æ”¶æ–¹æ”¶åˆ°è¯·æ±‚åå¹¶æ‰§è¡Œå¯¹åº”çš„æ“ä½œã€‚è¿™æ ·ä¸‹æ¥ï¼Œè¯·æ±‚æ–¹å’Œæ¥æ”¶æ–¹å°±è§£è€¦äº†ï¼Œä½¿å¾—è¯·æ±‚æ–¹å®Œå…¨ä¸çŸ¥é“æ¥å—çš„æ“ä½œæ–¹æ³•ï¼Œä»ä¹Ÿä¸ä¼šçŸ¥é“æ¥æ”¶æ–¹æ˜¯ä½•æ—¶æ¥å—åˆ°è¯·æ±‚çš„ï¼Œåˆæ˜¯ä½•æ—¶æ‰§è¡Œæ“ä½œçš„ï¼Œåˆæ˜¯æ€ä¹ˆæ‰§è¡Œæ“ä½œçš„ã€‚ å…·ä½“çš„è§’è‰² Commandï¼ˆæŠ½è±¡å‘½ä»¤ç±»ï¼‰ï¼šæŠ½è±¡å‘½ä»¤ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œåœ¨å…¶ä¸­å£°æ˜äº†ç”¨äºæ‰§è¡Œè¯·æ±‚çš„execute()ç­‰æ–¹æ³•ï¼Œé€šè¿‡è¿™äº›æ–¹æ³•å¯ä»¥è°ƒç”¨è¯·æ±‚æ¥æ”¶è€…çš„ç›¸å…³æ“ä½œã€‚ ConcreteCommandï¼ˆå…·ä½“å‘½ä»¤ç±»ï¼‰ï¼šå…·ä½“å‘½ä»¤ç±»æ˜¯æŠ½è±¡å‘½ä»¤ç±»çš„å­ç±»ï¼Œå®ç°äº†åœ¨æŠ½è±¡å‘½ä»¤ç±»ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œå®ƒå¯¹åº”å…·ä½“çš„æ¥æ”¶è€…å¯¹è±¡ï¼Œå°†æ¥æ”¶è€…å¯¹è±¡çš„åŠ¨ä½œç»‘å®šå…¶ä¸­ã€‚åœ¨å®ç°execute()æ–¹æ³•æ—¶ï¼Œå°†è°ƒç”¨æ¥æ”¶è€…å¯¹è±¡çš„ç›¸å…³æ“ä½œ(Action)ã€‚ Invokerï¼ˆè¯·æ±‚æ–¹ï¼‰ï¼šè°ƒç”¨è€…å³è¯·æ±‚å‘é€è€…ï¼Œå®ƒé€šè¿‡å‘½ä»¤å¯¹è±¡æ¥æ‰§è¡Œè¯·æ±‚ã€‚ä¸€ä¸ªè°ƒç”¨è€…å¹¶ä¸éœ€è¦åœ¨è®¾è®¡æ—¶ç¡®å®šå…¶æ¥æ”¶è€…ï¼Œå› æ­¤å®ƒåªä¸æŠ½è±¡å‘½ä»¤ç±»ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ã€‚åœ¨ç¨‹åºè¿è¡Œæ—¶å¯ä»¥å°†ä¸€ä¸ªå…·ä½“å‘½ä»¤å¯¹è±¡æ³¨å…¥å…¶ä¸­ï¼Œå†è°ƒç”¨å…·ä½“å‘½ä»¤å¯¹è±¡çš„execute()æ–¹æ³•ï¼Œä»è€Œå®ç°é—´æ¥è°ƒç”¨è¯·æ±‚æ¥æ”¶è€…çš„ç›¸å…³æ“ä½œã€‚ Receiverï¼ˆæ¥æ”¶æ–¹ï¼‰ï¼šæ¥æ”¶è€…æ‰§è¡Œä¸è¯·æ±‚ç›¸å…³çš„æ“ä½œï¼Œå®ƒå…·ä½“å®ç°å¯¹è¯·æ±‚çš„ä¸šåŠ¡å¤„ç†ã€‚ Clientï¼ˆå®¢æˆ·ç«¯ï¼‰ï¼šåˆ›å»ºå…·ä½“å‘½ä»¤çš„å¯¹è±¡å¹¶ä¸”è®¾ç½®å‘½ä»¤å¯¹è±¡çš„æ¥å—è€…ã€‚ å†æ¥çœ‹çœ‹UMLå›¾ ä»ä¸Šæ–¹çš„æ—¶åºå›¾ä¸­å¯ä»¥çœ‹å‡ºè¿è¡Œçš„é¡ºåºï¼ŒInvokeræ‰§è¡Œexecuteæ–¹æ³•ï¼Œè°ƒç”¨Command1å¯¹è±¡ï¼ŒCommand1æ‰§è¡Œaction1æ–¹æ³•è°ƒç”¨Receiver1å¯¹è±¡ã€‚ å¹²è´§ä»£ç æºç åœ¨æˆ‘çš„GitHubåœ°å€ æ™®é€šçš„å‘½ä»¤æ¨¡å¼ç°åœ¨ç»“åˆä¸‹ä¸Šå›è¯´åˆ°çš„çŠ¶æ€æ¨¡å¼ä¸€èµ·æ¥å®ç°è¿™ä¸ªé£æ‰‡çš„å·¦è½¬å’Œå³è½¬åŠŸèƒ½ï¼Œè¿™æ¬¡æŠŠä»–ç”¨å‘½ä»¤æ¨¡å¼æ¥ä»£æ›¿ä¹‹å‰é£æ‰‡çš„è½¬åŠ¨ï¼ŒæŠŠå®ƒå½“åšå‘½ä»¤æ¥ã€‚ å®¢æˆ·ç«¯ç®€å•çš„å®šä¹‰è¯·æ±‚æ–¹å’Œæ¥æ”¶æ–¹ä»¥åŠå¯¹äºçš„å·¦è½¬å‘½ä»¤å’Œå³è½¬å‘½ä»¤ï¼Œè®¾ç½®å‘½ä»¤åå¯¹åº”çš„æ‰§è¡Œå‘½ä»¤ã€‚ 123456789101112131415161718public class Client &#123; public static void main(String[] args) &#123; Invoker invoker = new Invoker(); Receiver receiver = new Receiver(); Command leftCommand = new LeftCommand(receiver); Command rightCommand = new RightCommand(receiver); invoker.setCommand(rightCommand); invoker.execute(); invoker.execute(); invoker.execute(); invoker.setCommand(leftCommand); invoker.execute(); invoker.execute(); &#125;&#125; è¯·æ±‚æ–¹ 123456789101112@Data@AllArgsConstructor@NoArgsConstructorpublic class Invoker &#123; private Command command; public void execute() &#123; command.execute(); &#125;&#125; æŠ½è±¡å‘½ä»¤ 1234public interface Command &#123; void execute();&#125; å¼€å…³å·¦è½¬ 123456789101112@Data@AllArgsConstructor@NoArgsConstructorpublic class LeftCommand implements Command &#123; private Receiver receiver; @Override public void execute() &#123; receiver.left(); &#125;&#125; å¼€å…³å³è½¬ 123456789101112@Data@AllArgsConstructor@NoArgsConstructorpublic class RightCommand implements Command &#123; private Receiver receiver; @Override public void execute() &#123; receiver.right(); &#125;&#125; æ¥æ”¶æ–¹ 123456789101112public class Receiver &#123; private Context context = new Context(new CloseLevelState()); public void left() &#123; context.left(); &#125; public void right() &#123; context.right(); &#125;&#125; é€šè¿‡å‘½ä»¤æ¨¡å¼æŠŠå·¦è½¬å’Œå³è½¬å°è£…æˆå‘½ä»¤ï¼Œä»¥åŠä¹‹å‰çš„çŠ¶æ€æ¨¡å¼å˜æ›´é£æ‰‡çš„çŠ¶æ€ã€‚æœ¬æ¬¡å°±æ˜¯é€šè¿‡çŠ¶æ€æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼å®ç°äº†ä¸€ä¸ªé£æ‰‡å¼€å…³å·¦å³è½¬çš„åŠŸèƒ½ã€‚ å®å‘½ä»¤æˆ–è€…å«åšç»„åˆå‘½ä»¤è®¾è®¡ä¸€ç»„å‘½ä»¤ï¼Œç®€å•çš„å¤„ç†äº‹æƒ…ï¼Œæ‰“å°ä¸€å¥è¯ï¼Œå°è£…æˆä¸€ç»„å‘½ä»¤ã€‚è¿™æ¬¡æˆ‘ä»¬ç”¨äº†Java8æ¥å†™ï¼Œå¯ä»¥ä½¿ç”¨lambdaã€‚ 12345678910111213141516171819202122232425262728@Slf4jpublic class Client &#123; public static void main(String[] args) &#123; Invoker invoker = new Invoker(); log.info("åˆå§‹åŒ–ABC3ä¸ªå‘½ä»¤"); Command aCommand = () -&gt; log.info("Aå¤„ç†è¿™ä¸ªè¯·æ±‚"); invoker.addCommand(aCommand); invoker.addCommand(() -&gt; log.info("Bå¤„ç†è¿™ä¸ªè¯·æ±‚")); invoker.addCommand(() -&gt; log.info("Cå¤„ç†è¿™ä¸ªè¯·æ±‚")); invoker.execute(); log.info("---------------------------"); log.info("åŠ å…¥æ–°å‘½ä»¤D"); invoker.addCommand(() -&gt; log.info("Då¤„ç†è¿™ä¸ªè¯·æ±‚")); invoker.execute(); log.info("---------------------------"); log.info("åŠ å…¥æ–°å‘½ä»¤E"); invoker.addCommand(() -&gt; log.info("Eå¤„ç†è¿™ä¸ªè¯·æ±‚")); invoker.execute(); log.info("---------------------------"); log.info("ç§»é™¤å‘½ä»¤A"); invoker.removeCommand(aCommand); invoker.execute(); &#125;&#125; æ‰“å°è¯­å¥ã€‚ æŠ½è±¡å‘½ä»¤ 12345@FunctionalInterfacepublic interface Command &#123; void execute();&#125; è¯·æ±‚æ–¹ 1234567891011121314151617181920212223@Data@AllArgsConstructor@NoArgsConstructorpublic class Invoker &#123; private List&lt;Command&gt; commandList = Lists.newArrayList(); public void addCommand(Command command) &#123; commandList.add(command); &#125; public void removeCommand(Command command) &#123; commandList.remove(command); &#125; public void execute() &#123; if(CollectionUtils.isEmpty(commandList)) &#123; return; &#125; commandList.stream().forEach(command -&gt; command.execute()); &#125;&#125; æ’¤é”€æ“ä½œåœ¨æ™®é€šçš„å‘½ä»¤æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†æ’¤é”€æ“ä½œï¼Œåœ¨è¿™é‡Œçš„æ’¤é”€æ“ä½œï¼Œå…¶å®å³ä¸ºå·¦è½¬æ—¶çš„å³è½¬ï¼Œå³è½¬æ—¶çš„å·¦è½¬ã€‚ 123456789101112131415161718192021@Slf4jpublic class Client &#123; public static void main(String[] args) &#123; Invoker invoker = new Invoker(); Receiver receiver = new Receiver(); Command leftCommand = new LeftCommand(receiver); Command rightCommand = new RightCommand(receiver); invoker.setCommand(rightCommand); invoker.execute(); invoker.execute(); invoker.execute(); invoker.undo(); invoker.undo(); invoker.setCommand(leftCommand); invoker.execute(); invoker.undo(); &#125;&#125; æŠ½è±¡å‘½ä»¤å¢åŠ äº†æ’¤é”€æ“ä½œ 123456public interface Command &#123; void execute(); void undo();&#125; å…·ä½“å·¦è½¬æ—¶ 1234567891011121314151617@Data@AllArgsConstructor@NoArgsConstructorpublic class LeftCommand implements Command &#123; private Receiver receiver; @Override public void execute() &#123; receiver.left(); &#125; @Override public void undo() &#123; receiver.right(); &#125;&#125; å³è½¬æ—¶ 1234567891011121314151617@Data@AllArgsConstructor@NoArgsConstructorpublic class RightCommand implements Command &#123; private Receiver receiver; @Override public void execute() &#123; receiver.right(); &#125; @Override public void undo() &#123; receiver.left(); &#125;&#125; è¯·æ±‚æ–¹ 12345678910111213141516@Data@AllArgsConstructor@NoArgsConstructorpublic class Invoker &#123; private Command command; public void execute() &#123; command.execute(); &#125; public void undo() &#123; command.undo(); &#125;&#125; æ¥æ”¶æ–¹ 123456789101112public class Receiver &#123; private Context context = new Context(new CloseLevelState()); public void left() &#123; context.left(); &#125; public void right() &#123; context.right(); &#125;&#125; å‘½ä»¤æ¨¡å¼æ€»ç»“ä¼˜ç‚¹ (1) é™ä½ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ç”±äºè¯·æ±‚è€…ä¸æ¥æ”¶è€…ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥å¼•ç”¨ï¼Œå› æ­¤è¯·æ±‚è€…ä¸æ¥æ”¶è€…ä¹‹é—´å®ç°å®Œå…¨è§£è€¦ï¼Œç›¸åŒçš„è¯·æ±‚è€…å¯ä»¥å¯¹åº”ä¸åŒçš„æ¥æ”¶è€…ï¼ŒåŒæ ·ï¼Œç›¸åŒçš„æ¥æ”¶è€…ä¹Ÿå¯ä»¥ä¾›ä¸åŒçš„è¯·æ±‚è€…ä½¿ç”¨ï¼Œä¸¤è€…ä¹‹é—´å…·æœ‰è‰¯å¥½çš„ç‹¬ç«‹æ€§ã€‚ (2) æ–°çš„å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“åœ°åŠ å…¥åˆ°ç³»ç»Ÿä¸­ã€‚ç”±äºå¢åŠ æ–°çš„å…·ä½“å‘½ä»¤ç±»ä¸ä¼šå½±å“åˆ°å…¶ä»–ç±»ï¼Œå› æ­¤å¢åŠ æ–°çš„å…·ä½“å‘½ä»¤ç±»å¾ˆå®¹æ˜“ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ç³»ç»Ÿæºä»£ç ï¼Œç”šè‡³å®¢æˆ·ç±»ä»£ç ï¼Œæ»¡è¶³â€œå¼€é—­åŸåˆ™â€çš„è¦æ±‚ã€‚ (3) å¯ä»¥æ¯”è¾ƒå®¹æ˜“åœ°è®¾è®¡ä¸€ä¸ªå‘½ä»¤é˜Ÿåˆ—æˆ–å®å‘½ä»¤ï¼ˆç»„åˆå‘½ä»¤ï¼‰ã€‚ (4) ä¸ºè¯·æ±‚çš„æ’¤é”€(Undo)å’Œæ¢å¤(Redo)æ“ä½œæä¾›äº†ä¸€ç§è®¾è®¡å’Œå®ç°æ–¹æ¡ˆã€‚ ç¼ºç‚¹ ä½¿ç”¨å‘½ä»¤æ¨¡å¼å¯èƒ½ä¼šå¯¼è‡´æŸäº›ç³»ç»Ÿæœ‰è¿‡å¤šçš„å…·ä½“å‘½ä»¤ç±»ã€‚å› ä¸ºé’ˆå¯¹æ¯ä¸€ä¸ªå¯¹è¯·æ±‚æ¥æ”¶è€…çš„è°ƒç”¨æ“ä½œéƒ½éœ€è¦è®¾è®¡ä¸€ä¸ªå…·ä½“å‘½ä»¤ç±»ï¼Œå› æ­¤åœ¨æŸäº›ç³»ç»Ÿä¸­å¯èƒ½éœ€è¦æä¾›å¤§é‡çš„å…·ä½“å‘½ä»¤ç±»ï¼Œè¿™å°†å½±å“å‘½ä»¤æ¨¡å¼çš„ä½¿ç”¨ã€‚ é€‚ç”¨åœºæ™¯ (1) ç³»ç»Ÿéœ€è¦å°†è¯·æ±‚è°ƒç”¨è€…å’Œè¯·æ±‚æ¥æ”¶è€…è§£è€¦ï¼Œä½¿å¾—è°ƒç”¨è€…å’Œæ¥æ”¶è€…ä¸ç›´æ¥äº¤äº’ã€‚è¯·æ±‚è°ƒç”¨è€…æ— é¡»çŸ¥é“æ¥æ”¶è€…çš„å­˜åœ¨ï¼Œä¹Ÿæ— é¡»çŸ¥é“æ¥æ”¶è€…æ˜¯è°ï¼Œæ¥æ”¶è€…ä¹Ÿæ— é¡»å…³å¿ƒä½•æ—¶è¢«è°ƒç”¨ã€‚ (2) ç³»ç»Ÿéœ€è¦åœ¨ä¸åŒçš„æ—¶é—´æŒ‡å®šè¯·æ±‚ã€å°†è¯·æ±‚æ’é˜Ÿå’Œæ‰§è¡Œè¯·æ±‚ã€‚ä¸€ä¸ªå‘½ä»¤å¯¹è±¡å’Œè¯·æ±‚çš„åˆå§‹è°ƒç”¨è€…å¯ä»¥æœ‰ä¸åŒçš„ç”Ÿå‘½æœŸï¼Œæ¢è¨€ä¹‹ï¼Œæœ€åˆçš„è¯·æ±‚å‘å‡ºè€…å¯èƒ½å·²ç»ä¸åœ¨äº†ï¼Œè€Œå‘½ä»¤å¯¹è±¡æœ¬èº«ä»ç„¶æ˜¯æ´»åŠ¨çš„ï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤å¯¹è±¡å»è°ƒç”¨è¯·æ±‚æ¥æ”¶è€…ï¼Œè€Œæ— é¡»å…³å¿ƒè¯·æ±‚è°ƒç”¨è€…çš„å­˜åœ¨æ€§ï¼Œå¯ä»¥é€šè¿‡è¯·æ±‚æ—¥å¿—æ–‡ä»¶ç­‰æœºåˆ¶æ¥å…·ä½“å®ç°ã€‚ (3) ç³»ç»Ÿéœ€è¦æ”¯æŒå‘½ä»¤çš„æ’¤é”€(Undo)æ“ä½œå’Œæ¢å¤(Redo)æ“ä½œã€‚ (4) ç³»ç»Ÿéœ€è¦å°†ä¸€ç»„æ“ä½œç»„åˆåœ¨ä¸€èµ·å½¢æˆå®å‘½ä»¤ã€‚ (5)çº¿ç¨‹æ± æœ‰ä¸€ä¸ªaddTashæ–¹æ³•ï¼Œå°†ä»»åŠ¡æ·»åŠ åˆ°å¾…å®Œæˆçš„é˜Ÿåˆ—ä¸­ï¼Œé˜Ÿåˆ—ä¸­çš„å…ƒç´ å°±æ˜¯å‘½ä»¤å¯¹è±¡ï¼Œé€šå¸¸çš„å°±æ˜¯ä¸€ä¸ªå…¬å…±æ¥å£ï¼Œåƒæˆ‘ä»¬å¸¸ç”¨çš„java.lang.Runnableæ¥å£ã€‚ (6)java8ä¹‹åï¼Œæœ€å¥½åœ¨Commandæ¥å£ä¸­@FunctionalInterfaceä¿®é¥°ï¼Œè¿™æ ·å…·ä½“çš„å‘½ä»¤å°±å¯ä»¥ä½¿ç”¨lambdaè¡¨è¾¾å¼å•¦ã€‚ Javaä¸­çš„ä½¿ç”¨å°†æ“ä½œå°è£…åˆ°å¯¹è±¡å†…ï¼Œä»¥ä¾¿å­˜å‚¨ï¼Œä¼ é€’å’Œè¿”å›ã€‚ java.lang.Runnable javax.swing.Action æ–‡ç« å‚è€ƒjavaè®¾è®¡æ¨¡å¼ä¹‹å‘½ä»¤æ¨¡å¼ ç»†æ•°JDKé‡Œçš„è®¾è®¡æ¨¡å¼ wikiçš„å‘½ä»¤æ¨¡å¼]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>å‘½ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹çŠ¶æ€æ¨¡å¼]]></title>
    <url>%2F2018%2F12%2F24%2Fdesign-pattern-state%2F</url>
    <content type="text"><![CDATA[çŠ¶æ€æ¨¡å¼ åœ¨çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰ä¸­ï¼Œç±»çš„è¡Œä¸ºæ˜¯åŸºäºå®ƒçš„çŠ¶æ€æ”¹å˜çš„ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚åœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºè¡¨ç¤ºå„ç§çŠ¶æ€çš„å¯¹è±¡å’Œä¸€ä¸ªè¡Œä¸ºéšç€çŠ¶æ€å¯¹è±¡æ”¹å˜è€Œæ”¹å˜çš„ context å¯¹è±¡ã€‚é€šä¿—ç‚¹å°±æ˜¯ä¸€ä¸ªå¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºã€‚ ä»‹ç»æ„å›¾ å…è®¸å¯¹è±¡åœ¨å†…éƒ¨çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶æ”¹å˜å®ƒçš„è¡Œä¸ºï¼Œå¯¹è±¡çœ‹èµ·æ¥å¥½åƒä¿®æ”¹äº†å®ƒçš„ç±»ã€‚ ä¸»è¦è§£å†³ å¯¹è±¡çš„è¡Œä¸ºä¾èµ–äºå®ƒçš„çŠ¶æ€ï¼ˆå±æ€§ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®å®ƒçš„çŠ¶æ€æ”¹å˜è€Œæ”¹å˜å®ƒçš„ç›¸å…³è¡Œä¸ºã€‚ ä½•æ—¶ä½¿ç”¨ ä»£ç ä¸­åŒ…å«å¤§é‡ä¸å¯¹è±¡çŠ¶æ€æœ‰å…³çš„æ¡ä»¶è¯­å¥ã€‚ å¦‚ä½•è§£å†³ å°†å„ç§å…·ä½“çš„çŠ¶æ€ç±»æŠ½è±¡å‡ºæ¥ã€‚ å…³é”®ä»£ç  é€šå¸¸å‘½ä»¤æ¨¡å¼çš„æ¥å£ä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•ã€‚è€ŒçŠ¶æ€æ¨¡å¼çš„æ¥å£ä¸­æœ‰ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ–¹æ³•ã€‚è€Œä¸”ï¼ŒçŠ¶æ€æ¨¡å¼çš„å®ç°ç±»çš„æ–¹æ³•ï¼Œä¸€èˆ¬è¿”å›å€¼ï¼Œæˆ–è€…æ˜¯æ”¹å˜å®ä¾‹å˜é‡çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒçŠ¶æ€æ¨¡å¼ä¸€èˆ¬å’Œå¯¹è±¡çš„çŠ¶æ€æœ‰å…³ã€‚å®ç°ç±»çš„æ–¹æ³•æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œè¦†ç›–æ¥å£ä¸­çš„æ–¹æ³•ã€‚çŠ¶æ€æ¨¡å¼å’Œå‘½ä»¤æ¨¡å¼ä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ¶ˆé™¤ ifâ€¦else ç­‰æ¡ä»¶é€‰æ‹©è¯­å¥ã€‚ UMLå›¾ ä¸»è¦è§’è‰² 1ï¼‰Context(ç¯å¢ƒç±»)ï¼šç¯å¢ƒç±»æ‹¥æœ‰å„ç§ä¸åŒçŠ¶æ€çš„å¯¹è±¡ï¼Œä½œä¸ºå¤–éƒ¨ä½¿ç”¨çš„æ¥å£ï¼Œè´Ÿè´£è°ƒç”¨çŠ¶æ€ç±»æ¥å£ã€‚ 2ï¼‰State(æŠ½è±¡çŠ¶æ€)ï¼šæŠ½è±¡çŠ¶æ€æ—¢å¯ä»¥ä¸ºæŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®šä¹‰æˆæ¥å£ã€‚ä¸»è¦ç”¨äºå®šä¹‰çŠ¶æ€æŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“å®ç°ç”±å­ç±»è´Ÿè´£ã€‚ 3ï¼‰ConcreteState(å…·ä½“çŠ¶æ€ç±»):å…·ä½“çŠ¶æ€ç±»ä¸ºæŠ½è±¡çŠ¶æ€çš„å®ç°è€…ï¼Œä¸åŒçš„çŠ¶æ€ç±»å¯¹åº”è¿™ä¸åŒçš„çŠ¶æ€ï¼Œå…¶å†…éƒ¨å®ç°ä¹Ÿä¸ç›¸åŒã€‚ç¯å¢ƒç±»ä¸­ä½¿ç”¨ä¸åŒçŠ¶æ€çš„å¯¹è±¡æ—¶ï¼Œèƒ½å®ç°ä¸åŒçš„å¤„ç†é€»è¾‘ åº”ç”¨å®ä¾‹ 1ã€æ‰“ç¯®çƒçš„æ—¶å€™è¿åŠ¨å‘˜å¯ä»¥æœ‰æ­£å¸¸çŠ¶æ€ã€ä¸æ­£å¸¸çŠ¶æ€å’Œè¶…å¸¸çŠ¶æ€ã€‚ 2ã€æ›¾ä¾¯ä¹™ç¼–é’Ÿä¸­ï¼Œâ€™é’Ÿæ˜¯æŠ½è±¡æ¥å£â€™,â€™é’ŸAâ€™ç­‰æ˜¯å…·ä½“çŠ¶æ€ï¼Œâ€™æ›¾ä¾¯ä¹™ç¼–é’Ÿâ€™æ˜¯å…·ä½“ç¯å¢ƒï¼ˆContextï¼‰ã€‚ ä¼˜ç‚¹ 1ã€å°è£…äº†è½¬æ¢è§„åˆ™ã€‚ 2ã€æšä¸¾å¯èƒ½çš„çŠ¶æ€ï¼Œåœ¨æšä¸¾çŠ¶æ€ä¹‹å‰éœ€è¦ç¡®å®šçŠ¶æ€ç§ç±»ã€‚ 3ã€å°†æ‰€æœ‰ä¸æŸä¸ªçŠ¶æ€æœ‰å…³çš„è¡Œä¸ºæ”¾åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œå¹¶ä¸”å¯ä»¥æ–¹ä¾¿åœ°å¢åŠ æ–°çš„çŠ¶æ€ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡çŠ¶æ€å³å¯æ”¹å˜å¯¹è±¡çš„è¡Œä¸ºã€‚ 4ã€å…è®¸çŠ¶æ€è½¬æ¢é€»è¾‘ä¸çŠ¶æ€å¯¹è±¡åˆæˆä¸€ä½“ï¼Œè€Œä¸æ˜¯æŸä¸€ä¸ªå·¨å¤§çš„æ¡ä»¶è¯­å¥å—ã€‚ 5ã€å¯ä»¥è®©å¤šä¸ªç¯å¢ƒå¯¹è±¡å…±äº«ä¸€ä¸ªçŠ¶æ€å¯¹è±¡ï¼Œä»è€Œå‡å°‘ç³»ç»Ÿä¸­å¯¹è±¡çš„ä¸ªæ•°ã€‚ ç¼ºç‚¹ 1ã€çŠ¶æ€æ¨¡å¼çš„ä½¿ç”¨å¿…ç„¶ä¼šå¢åŠ ç³»ç»Ÿç±»å’Œå¯¹è±¡çš„ä¸ªæ•°ã€‚ 2ã€çŠ¶æ€æ¨¡å¼çš„ç»“æ„ä¸å®ç°éƒ½è¾ƒä¸ºå¤æ‚ï¼Œå¦‚æœä½¿ç”¨ä¸å½“å°†å¯¼è‡´ç¨‹åºç»“æ„å’Œä»£ç çš„æ··ä¹±ã€‚ 3ã€çŠ¶æ€æ¨¡å¼å¯¹â€å¼€é—­åŸåˆ™â€çš„æ”¯æŒå¹¶ä¸å¤ªå¥½ï¼Œå¯¹äºå¯ä»¥åˆ‡æ¢çŠ¶æ€çš„çŠ¶æ€æ¨¡å¼ï¼Œå¢åŠ æ–°çš„çŠ¶æ€ç±»éœ€è¦ä¿®æ”¹é‚£äº›è´Ÿè´£çŠ¶æ€è½¬æ¢çš„æºä»£ç ï¼Œå¦åˆ™æ— æ³•åˆ‡æ¢åˆ°æ–°å¢çŠ¶æ€ï¼Œè€Œä¸”ä¿®æ”¹æŸä¸ªçŠ¶æ€ç±»çš„è¡Œä¸ºä¹Ÿéœ€ä¿®æ”¹å¯¹åº”ç±»çš„æºä»£ç ã€‚ ä½¿ç”¨åœºæ™¯ è¡Œä¸ºéšçŠ¶æ€æ”¹å˜è€Œæ”¹å˜çš„åœºæ™¯ã€‚ æ¡ä»¶ã€åˆ†æ”¯è¯­å¥çš„ä»£æ›¿è€…ã€‚ çŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„å¯¹æ¯”ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼ŒçŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„ç»“æ„æ˜¯ç›¸ä¼¼çš„ï¼Œä½†å®ƒä»¬çš„æ„å›¾ä¸åŒã€‚è®©æˆ‘ä»¬é‡æ¸©ä¸€ä¸‹å®ƒä»¬çš„ä¸»è¦ä¸åŒä¹‹å¤„ï¼š ç­–ç•¥æ¨¡å¼å°è£…äº†ä¸€ç»„ç›¸å…³ç®—æ³•ï¼Œå®ƒå…è®¸Clientåœ¨è¿è¡Œæ—¶ä½¿ç”¨å¯äº’æ¢çš„è¡Œä¸ºï¼›çŠ¶æ€æ¨¡å¼å¸®åŠ©ä¸€ä¸ªç±»åœ¨ä¸åŒçš„çŠ¶æ€æ˜¾ç¤ºä¸åŒçš„è¡Œä¸ºã€‚ çŠ¶æ€æ¨¡å¼å°è£…äº†å¯¹è±¡çš„çŠ¶æ€ï¼Œè€Œç­–ç•¥æ¨¡å¼å°è£…ç®—æ³•æˆ–ç­–ç•¥ã€‚å› ä¸ºçŠ¶æ€æ˜¯è·Ÿå¯¹è±¡å¯†åˆ‡ç›¸å…³çš„ï¼Œå®ƒä¸èƒ½è¢«é‡ç”¨ï¼›è€Œé€šè¿‡ä»Contextä¸­åˆ†ç¦»å‡ºç­–ç•¥æˆ–ç®—æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é‡ç”¨å®ƒä»¬ã€‚ åœ¨çŠ¶æ€æ¨¡å¼ä¸­ï¼Œæ¯ä¸ªçŠ¶æ€é€šè¿‡æŒæœ‰Contextçš„å¼•ç”¨ï¼Œæ¥å®ç°çŠ¶æ€è½¬ç§»ï¼›ä½†æ˜¯æ¯ä¸ªç­–ç•¥éƒ½ä¸æŒæœ‰Contextçš„å¼•ç”¨ï¼Œå®ƒä»¬åªæ˜¯è¢«Contextä½¿ç”¨ã€‚ ç­–ç•¥å®ç°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä½¿ç”¨å®ƒçš„å¯¹è±¡ï¼Œä¾‹å¦‚Collections.sort()ï¼Œå®ƒçš„å‚æ•°åŒ…å«ä¸€ä¸ªComparatorç­–ç•¥ã€‚å¦ä¸€æ–¹é¢ï¼ŒçŠ¶æ€æ˜¯Contextå¯¹è±¡è‡ªå·±çš„ä¸€éƒ¨åˆ†ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼ŒContextå¯¹è±¡ä»ä¸€ä¸ªçŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªçŠ¶æ€ã€‚ è™½ç„¶å®ƒä»¬éƒ½ç¬¦åˆOCPåŸåˆ™ï¼Œç­–ç•¥æ¨¡å¼ä¹Ÿç¬¦åˆSRPåŸåˆ™ï¼ˆå•ä¸€èŒè´£åŸåˆ™ï¼‰ï¼Œå› ä¸ºæ¯ä¸ªç­–ç•¥éƒ½å°è£…è‡ªå·±çš„ç®—æ³•ï¼Œä¸”ä¸ä¾èµ–å…¶ä»–ç­–ç•¥ã€‚ä¸€ä¸ªç­–ç•¥çš„æ”¹å˜ï¼Œå¹¶ä¸ä¼šå¯¼è‡´å…¶ä»–ç­–ç•¥çš„å˜åŒ–ã€‚ å¦ä¸€ä¸ªç†è®ºä¸Šçš„ä¸åŒï¼šç­–ç•¥æ¨¡å¼å®šä¹‰äº†å¯¹è±¡â€œæ€ä¹ˆåšâ€çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œæ’åºå¯¹è±¡æ€ä¹ˆå¯¹æ•°æ®æ’åºã€‚çŠ¶æ€æ¨¡å¼å®šä¹‰äº†å¯¹è±¡â€œæ˜¯ä»€ä¹ˆâ€å’Œâ€œä»€ä¹ˆæ—¶å€™åšâ€çš„éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œå¯¹è±¡å¤„äºä»€ä¹ˆçŠ¶æ€ï¼Œä»€ä¹ˆæ—¶å€™å¤„åœ¨æŸä¸ªç‰¹å®šçš„çŠ¶æ€ã€‚ çŠ¶æ€æ¨¡å¼ä¸­å¾ˆå¥½çš„å®šä¹‰äº†çŠ¶æ€è½¬ç§»çš„æ¬¡åºï¼›è€Œç­–ç•¥æ¨¡å¼å¹¶æ— æ­¤éœ€è¦ï¼šClientå¯ä»¥è‡ªç”±çš„é€‰æ‹©ä»»ä½•ç­–ç•¥ã€‚ ä¸€äº›å¸¸è§çš„ç­–ç•¥æ¨¡å¼çš„ä¾‹å­æ˜¯å°è£…ç®—æ³•ï¼Œä¾‹å¦‚æ’åºç®—æ³•ï¼ŒåŠ å¯†ç®—æ³•æˆ–è€…å‹ç¼©ç®—æ³•ã€‚å¦‚æœä½ çœ‹åˆ°ä½ çš„ä»£ç éœ€è¦ä½¿ç”¨ä¸åŒç±»å‹çš„ç›¸å…³ç®—æ³•ï¼Œé‚£ä¹ˆè€ƒè™‘ä½¿ç”¨ç­–ç•¥æ¨¡å¼å§ã€‚è€Œè¯†åˆ«ä½•æ—¶ä½¿ç”¨çŠ¶æ€æ¨¡å¼æ˜¯å¾ˆç®€å•çš„ï¼šå¦‚æœä½ éœ€è¦ç®¡ç†çŠ¶æ€å’ŒçŠ¶æ€è½¬ç§»ï¼Œä½†ä¸æƒ³ä½¿ç”¨å¤§é‡åµŒå¥—çš„æ¡ä»¶è¯­å¥ï¼Œé‚£ä¹ˆå°±æ˜¯å®ƒäº†ã€‚ æœ€åä½†æœ€é‡è¦çš„ä¸€ä¸ªä¸åŒä¹‹å¤„æ˜¯ï¼Œç­–ç•¥çš„æ”¹å˜ç”±Clientå®Œæˆï¼›è€ŒçŠ¶æ€çš„æ”¹å˜ï¼Œç”±Contextæˆ–çŠ¶æ€è‡ªå·±ã€‚ é¡¹ç›®å®ä¾‹è·³è½¬åˆ°æˆ‘çš„æºç åœ°å€ simple1åŒ…ä¸­ä¸»è¦æ˜¯å¯¹é£æ‰‡çš„å¼€å…³çŠ¶æ€è¿›è¡Œè½¬æ¢ï¼Œå…¶å®æˆ‘ä»¬æ˜¯æŠŠçŠ¶æ€æ”¾åœ¨çŠ¶æ€ç±»ä¸­è¿›è¡ŒæŒ‰ç…§å›ºå®šçš„é€»è¾‘è½¬æ¢ï¼Œä½†æ˜¯è¿™ç§æ¨¡å¼å…¶å®ä»–ä¸ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œä¸ºä»€ä¹ˆäº†ï¼Œå› ä¸ºä¸€æ—¦æˆ‘ä»¬å‘ç”Ÿæ–°å¢ã€ä¿®æ”¹æˆ–è€…åˆ é™¤çŠ¶æ€çš„æ—¶å€™ï¼Œå°±éœ€è¦ä¿®æ”¹çŠ¶æ€ç±»ä¸­çš„çŠ¶æ€è½¬æ¢ã€‚ 123456789101112public class Application &#123; public static void main(String[] args) &#123; Context context = new Context(new CloseLevelState()); context.right(); context.right(); context.right(); context.left(); context.right(); context.right(); &#125;&#125; æŠ½è±¡çŠ¶æ€ 12345678910111213141516171819202122public interface LevelState &#123; /** * å·¦è½¬ * * @param context */ void left(Context context); /** * å³è½¬ * * @param context */ void right(Context context); /** * å½“å‰æ¡£ä½ * @return */ String info();&#125; å…·ä½“æ¡£ä½çŠ¶æ€ï¼Œæˆ‘åªåˆ—äº†2ä¸ªï¼Œå…¶ä»–çš„ç±»ä¼¼ 12345678910111213141516171819202122@Slf4jpublic class OneLevelState implements LevelState &#123; @Override public void left(Context context) &#123; LevelState levelState = new CloseLevelState(); context.setLevelState(levelState); log.info("é£æ‰‡å·¦è½¬åˆ°&#123;&#125;", levelState.info()); &#125; @Override public void right(Context context) &#123; LevelState levelState = new TwoLevelState(); context.setLevelState(levelState); log.info("é£æ‰‡å³è½¬åˆ°&#123;&#125;", levelState.info()); &#125; @Override public String info() &#123; return "1æ¡£"; &#125;&#125; 1234567891011121314151617181920212223@Slf4jpublic class CloseLevelState implements LevelState &#123; @Override public void left(Context context) &#123; LevelState levelState = new ForeLevelState(); context.setLevelState(levelState); log.info("é£æ‰‡å·¦è½¬åˆ°&#123;&#125;", levelState.info()); &#125; @Override public void right(Context context) &#123; LevelState levelState = new OneLevelState(); context.setLevelState(levelState); log.info("é£æ‰‡å³è½¬åˆ°&#123;&#125;", levelState.info()); &#125; @Override public String info() &#123; return "0æ¡£"; &#125;&#125; çœŸæ­£çš„å¼€å…³ä¹Ÿå°±æ˜¯ä¸Šä¸‹æ–‡ 123456789101112131415161718@Data@AllArgsConstructorpublic class Context &#123; private LevelState levelState; public void left() &#123; levelState.left(this); &#125; public void right() &#123; levelState.right(this); &#125; public String info() &#123; return levelState.info(); &#125;&#125; å‚è€ƒJavaä¸­ï¼ŒçŠ¶æ€æ¨¡å¼å’Œç­–ç•¥æ¨¡å¼çš„åŒºåˆ« çŠ¶æ€æ¨¡å¼|èœé¸Ÿæ•™ç¨‹]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>çŠ¶æ€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹è´£ä»»é“¾æ¨¡å¼]]></title>
    <url>%2F2018%2F12%2F21%2Fdesign-pattern-chain%2F</url>
    <content type="text"><![CDATA[è´£ä»»é“¾æ¨¡å¼ é¡¾åæ€ä¹‰ï¼Œè´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰ä¸ºè¯·æ±‚åˆ›å»ºäº†ä¸€ä¸ªæ¥æ”¶è€…å¯¹è±¡çš„é“¾ã€‚è¿™ç§æ¨¡å¼ç»™äºˆè¯·æ±‚çš„ç±»å‹ï¼Œå¯¹è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è¿›è¡Œè§£è€¦ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œé€šå¸¸æ¯ä¸ªæ¥æ”¶è€…éƒ½åŒ…å«å¯¹å¦ä¸€ä¸ªæ¥æ”¶è€…çš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä¸èƒ½å¤„ç†è¯¥è¯·æ±‚ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç›¸åŒçš„è¯·æ±‚ä¼ ç»™ä¸‹ä¸€ä¸ªæ¥æ”¶è€…ï¼Œä¾æ­¤ç±»æ¨ã€‚ ç®€ä»‹æ„å›¾ é¿å…è¯·æ±‚å‘é€è€…ä¸æ¥æ”¶è€…è€¦åˆåœ¨ä¸€èµ·ï¼Œè®©å¤šä¸ªå¯¹è±¡éƒ½æœ‰å¯èƒ½æ¥æ”¶è¯·æ±‚ï¼Œå°†è¿™äº›å¯¹è±¡è¿æ¥æˆä¸€æ¡é“¾ï¼Œå¹¶ä¸”æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼Œç›´åˆ°æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ ä¸»è¦è§£å†³ èŒè´£é“¾ä¸Šçš„å¤„ç†è€…è´Ÿè´£å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·åªéœ€è¦å°†è¯·æ±‚å‘é€åˆ°èŒè´£é“¾ä¸Šå³å¯ï¼Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†ç»†èŠ‚å’Œè¯·æ±‚çš„ä¼ é€’ï¼Œæ‰€ä»¥èŒè´£é“¾å°†è¯·æ±‚çš„å‘é€è€…å’Œè¯·æ±‚çš„å¤„ç†è€…è§£è€¦äº†ã€‚ ä½•æ—¶ä½¿ç”¨ åœ¨å¤„ç†æ¶ˆæ¯çš„æ—¶å€™ä»¥è¿‡æ»¤å¾ˆå¤šé“ã€‚ å¦‚ä½•è§£å†³ æ‹¦æˆªçš„ç±»éƒ½å®ç°ç»Ÿä¸€æ¥å£ã€‚ å…³é”®ä»£ç  Handler é‡Œé¢èšåˆå®ƒè‡ªå·±ï¼Œåœ¨ handleRequest é‡Œåˆ¤æ–­æ˜¯å¦åˆé€‚ï¼Œå¦‚æœæ²¡è¾¾åˆ°æ¡ä»¶åˆ™å‘ä¸‹ä¼ é€’ã€‚ çº¯è´£ä»»é“¾ä¸ä¸çº¯è´£ä»»é“¾ çº¯ï¼šçº¯è´£ä»»é“¾ä¸­çš„èŠ‚ç‚¹åªæœ‰ä¸¤ç§è¡Œä¸ºï¼Œä¸€å¤„ç†è´£ä»»ï¼ŒäºŒå°†è´£ä»»ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä¸å…è®¸å‡ºç°æŸä¸€ä¸ªèŠ‚ç‚¹å¤„ç†éƒ¨åˆ†æˆ–å…¨éƒ¨è´£ä»»ååˆå°†è´£ä»»å‘ä¸‹ä¼ é€’çš„æƒ…å†µã€‚ ä¸çº¯ï¼šå…è®¸æŸä¸ªè¯·æ±‚è¢«ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†éƒ¨åˆ†è´£ä»»åå†å‘ä¸‹ä¼ é€’ï¼Œæˆ–è€…å¤„ç†å®Œåå…¶åç»­èŠ‚ç‚¹å¯ä»¥ç»§ç»­å¤„ç†è¯¥è´£ä»»ï¼Œè€Œä¸”ä¸€ä¸ªè´£ä»»å¯ä»¥æœ€ç»ˆä¸è¢«ä»»ä½•èŠ‚ç‚¹æ‰€å¤„ç†ã€‚ ä¸»è¦è§’è‰² Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰ï¼š å®šä¹‰ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œæä¾›å¯¹åç»­å¤„ç†è€…çš„å¼•ç”¨ ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰ï¼š æŠ½è±¡å¤„ç†è€…çš„å­ç±»ï¼Œå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œå¯é€‰å°†è¯·æ±‚å¤„ç†æ‰è¿˜æ˜¯ä¼ ç»™ä¸‹å®¶ï¼›åœ¨å…·ä½“å¤„ç†è€…ä¸­å¯ä»¥è®¿é—®é“¾ä¸­ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿è¯·æ±‚çš„è½¬å‘ åº”ç”¨å®ä¾‹ 1ã€çº¢æ¥¼æ¢¦ä¸­çš„â€å‡»é¼“ä¼ èŠ±â€ã€‚ 2ã€JS ä¸­çš„äº‹ä»¶å†’æ³¡ã€‚ 3ã€JAVA WEB ä¸­ Apache Tomcat å¯¹ Encoding çš„å¤„ç†ï¼ŒStruts2 çš„æ‹¦æˆªå™¨ï¼Œjsp servlet çš„ Filterã€‚ ä¼˜ç‚¹ 1ã€é™ä½è€¦åˆåº¦ã€‚å®ƒå°†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…è§£è€¦ã€‚ 2ã€ç®€åŒ–äº†å¯¹è±¡ã€‚ä½¿å¾—å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ã€‚ 3ã€å¢å¼ºç»™å¯¹è±¡æŒ‡æ´¾èŒè´£çš„çµæ´»æ€§ã€‚é€šè¿‡æ”¹å˜é“¾å†…çš„æˆå‘˜æˆ–è€…è°ƒåŠ¨å®ƒä»¬çš„æ¬¡åºï¼Œå…è®¸åŠ¨æ€åœ°æ–°å¢æˆ–è€…åˆ é™¤è´£ä»»ã€‚ 4ã€å¢åŠ æ–°çš„è¯·æ±‚å¤„ç†ç±»å¾ˆæ–¹ä¾¿ã€‚ ç¼ºç‚¹ 1ã€ä¸èƒ½ä¿è¯è¯·æ±‚ä¸€å®šè¢«æ¥æ”¶ã€‚ 2ã€ç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œè€Œä¸”åœ¨è¿›è¡Œä»£ç è°ƒè¯•æ—¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯èƒ½ä¼šé€ æˆå¾ªç¯è°ƒç”¨ã€‚ 3ã€å¯èƒ½ä¸å®¹æ˜“è§‚å¯Ÿè¿è¡Œæ—¶çš„ç‰¹å¾ï¼Œæœ‰ç¢äºé™¤é”™ã€‚ ä½¿ç”¨åœºæ™¯ 1ã€æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚ç”±è¿è¡Œæ—¶åˆ»è‡ªåŠ¨ç¡®å®šã€‚ 2ã€åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ 3ã€å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ã€‚ Githubé¡¹ç›®æè¿°è·³è½¬åˆ°æˆ‘çš„è´£ä»»é“¾è®¾è®¡æ¨¡å¼æºç  1.å‡ºè¡Œæ–¹å¼travelåŒ…é‡Œä¸»è¦å¯¹å‡ºè¡Œæ–¹å¼çš„è´£ä»»é“¾æ¨¡å¼ã€‚è·Ÿè¿›ç”¨æˆ·èº«ä¸Šçš„é’±ï¼Œåœ¨ä¼˜å…ˆçº§å¦‚é£æœº-&gt;ç«è½¦-&gt;å¤§å·´çš„é¡ºåºä¸‹é€‰æ‹©å¯¹åº”çš„å‡ºè¡Œæ¨¡å¼ã€‚ 123456789101112131415public class Application &#123; public static void main(String[] args) &#123; Handler planeHandler = new PlaneHandler(); Handler trainHandler = new TrainHandler(); Handler busHandler = new BusHandler(); planeHandler.setNext(trainHandler); trainHandler.setNext(busHandler); planeHandler.handleRequest("è€ç‹", 40d); planeHandler.handleRequest("å¼ ä¸‰", 140d); planeHandler.handleRequest("æå››", 240d); planeHandler.handleRequest("å´è€äº”", 340d); &#125;&#125; æŠ½è±¡å¤„ç† 12345678910@Datapublic abstract class Handler &#123; /** * ä¸‹ä¸€ä¸ªé“¾èŠ‚ç‚¹ */ protected Handler next; public abstract void handleRequest(String name, Double wallet);&#125; å…·ä½“çš„å¤„ç†è€…ï¼ˆé£æœºã€ç«è½¦ã€å¤§å·´ï¼‰ 123456789101112131415161718@Slf4jpublic class PlaneHandler extends Handler &#123; private double price = 280d; @Override public void handleRequest(String name, Double wallet) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±å¯ä»¥åé£æœºã€‚", name); return; &#125; if (Objects.nonNull(next)) &#123; next.handleRequest(name, wallet); return; &#125; log.info("&#123;&#125;é’±ä¸å¤Ÿï¼Œåªèƒ½å¾’æ­¥å•¦", name); &#125;&#125; 123456789101112131415161718@Slf4jpublic class TrainHandler extends Handler &#123; private double price = 149.99d; @Override public void handleRequest(String name, Double wallet) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±åªèƒ½åç«è½¦ã€‚", name); return; &#125; if (Objects.nonNull(next)) &#123; next.handleRequest(name, wallet); return; &#125; log.info("&#123;&#125;é’±ä¸å¤Ÿï¼Œåªèƒ½å¾’æ­¥å•¦", name); &#125;&#125; 123456789101112131415161718@Slf4jpublic class BusHandler extends Handler &#123; private double price = 59.99d; @Override public void handleRequest(String name, Double wallet) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±åªèƒ½åå¤§å·´ã€‚", name); return; &#125; if (Objects.nonNull(next)) &#123; next.handleRequest(name, wallet); return; &#125; log.info("&#123;&#125;é’±ä¸å¤Ÿï¼Œåªèƒ½å¾’æ­¥å•¦", name); &#125;&#125; 2.å‡ºè¡Œæ–¹å¼2ï¼Œå‚è€ƒFilteré“¾çš„å†™æ³•travel2åŒ…æ˜¯å¯¹travelåŒ…çš„é‡æ–°å†™æ³•ã€‚ 1234567891011121314151617public class Application &#123; public static void main(String[] args) &#123; HandlerChain chain = new HandlerChain(); Handler planeHandler = new PlaneHandler(); Handler trainHandler = new TrainHandler(); Handler busHandler = new BusHandler(); chain.addHandler(planeHandler); chain.addHandler(trainHandler); chain.addHandler(busHandler); chain.handle("è€ç‹", 40d); chain.handle("å¼ ä¸‰", 140d); chain.handle("æå››", 240d); chain.handle("å´è€äº”", 340d); &#125;&#125; æŠ½è±¡å¤„ç†è€… 1234public interface Handler &#123; void handleRequest(String name, Double wallet, HandlerChain chain);&#125; å…·ä½“å¤„ç†è€…ï¼ˆé£æœºã€ç«è½¦ã€å¤§å·´ï¼‰ 123456789101112131415@Slf4jpublic class PlaneHandler implements Handler &#123; private double price = 280d; @Override public void handleRequest(String name, Double wallet, HandlerChain chain) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±å¯ä»¥åé£æœºã€‚", name); chain.reuse(); return; &#125; chain.handle(name, wallet); &#125;&#125; 123456789101112131415@Slf4jpublic class TrainHandler implements Handler &#123; private double price = 149.99d; @Override public void handleRequest(String name, Double wallet, HandlerChain chain) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±åªèƒ½åç«è½¦ã€‚", name); chain.reuse(); return; &#125; chain.handle(name, wallet); &#125;&#125; 123456789101112131415@Slf4jpublic class BusHandler implements Handler &#123; private double price = 59.99d; @Override public void handleRequest(String name, Double wallet, HandlerChain chain) &#123; if (price &lt;= wallet) &#123; log.info("&#123;&#125;èº«ä¸Šçš„é’±åªèƒ½åå¤§å·´ã€‚", name); chain.reuse(); return; &#125; chain.handle(name, wallet); &#125;&#125; è´£ä»»é“¾ç®¡ç†è€… 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647@Slf4jpublic class HandlerChain &#123; private List&lt;Handler&gt; handlerList = new ArrayList&lt;&gt;(); /** * ç»´æŠ¤å½“å‰é“¾ä¸Šä½ç½® */ private int pos; /** * é“¾çš„é•¿åº¦ */ private int handlerLength; public void addHandler(Handler handler) &#123; handlerList.add(handler); handlerLength = handlerList.size(); &#125; public void handle(String name, double wallet) &#123; if (CollectionUtils.isEmpty(handlerList)) &#123; log.error("æœ‰é’±ï¼Œä½†æ²¡æä¾›æœåŠ¡ï¼Œ&#123;&#125;ä¹Ÿä¼°è®¡å°±åªèƒ½æ­¥è¡Œäº†ã€‚", name); return; &#125; if (pos &gt;= handlerLength) &#123; log.error("èº«ä¸Šé’±ä¸å¤Ÿï¼Œ&#123;&#125;ä¹Ÿä¼°è®¡å°±åªèƒ½æ­¥è¡Œäº†ã€‚", name); reuse(); return; &#125; Handler handler = handlerList.get(pos++); if (Objects.isNull(handler)) &#123; log.error("å‡æœåŠ¡ï¼Œ&#123;&#125;ä¹Ÿä¼°è®¡å°±åªèƒ½æ­¥è¡Œäº†ã€‚", name); reuse(); return; &#125; handler.handleRequest(name, wallet, this); &#125; /** * é“¾é‡æ–°ä½¿ç”¨ */ public void reuse() &#123; pos = 0; &#125;&#125; å­¦ä¹ Webé¡¹ç›®çš„Filterå¾…è¡¥å……â€¦ è¡¥å……è¡¥å……é—ç•™çš„Filterè¿‡æ»¤å™¨ä¸­çš„è´£ä»»é“¾å¤„ç†ã€‚ æœ¬æ¬¡ä¸»è¦æ˜¯å¯¹Tomcatä¸­çš„Filterå¤„ç†ç®€å•çš„æ¢³ç†ï¼Œå¦‚æœ‰ä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œè¿˜æœ›æŒ‡å‡ºæ¥ï¼Œå¤§å®¶äº’å‹‰ï¼Œå…±è¿›ã€‚ è€é¡¹ç›®å¤§å®¶å¯ä»¥åœ¨web.xmlä¸­é…ç½®filterï¼Œç°ä½¿ç”¨Springbootåï¼Œä¹Ÿæœ‰ä¸¤ç§é…ç½®filteræ–¹å¼ï¼Œé€šè¿‡åˆ›å»ºFilterRegistrationBeançš„æ–¹å¼å’Œé€šè¿‡æ³¨è§£@WebFilter+@ServletComponentScançš„æ–¹å¼ã€‚ ä¸‰ä¸ªä¸»è¦çš„è§’è‰² FIlterï¼Œä¸å¤šä»‹ç»äº†ã€‚ FilterChain servletå®¹å™¨æä¾›çš„å¼€å‘è°ƒç”¨é“¾çš„è¿‡æ»¤è¯·æ±‚çš„èµ„æºã€‚é€šè¿‡è°ƒç”¨ä¸‹ä¸€ä¸ªfilterå®ç°è¿‡æ»¤ï¼Œåœ¨æ•´ä½“é“¾ä¸Šã€‚ FilterConfig filterçš„é…ç½®å™¨ï¼Œåœ¨servletå®¹å™¨åœ¨Filteråˆå§‹åŒ–çš„æ—¶å€™ä¼ é€’ä¿¡æ¯ã€‚ å…·ä½“çš„filterï¼Œä¸»è¦è¯´è¯´Springä¸­çš„ä¸¤ä¸ªæŠ½è±¡Filterï¼ŒGenericFilterBeanå’ŒOncePerRequestFilterã€‚ å‰è€…ä¸»è¦æ˜¯åšinitå’Œdestroyçš„æ“ä½œï¼Œé‡ç‚¹è¿˜æ˜¯initæ–¹æ³•ï¼Œdestroyåªæ˜¯ç©ºå®ç°è€Œå·²ã€‚ åè€…ä¸»è¦æ˜¯åšçœŸæ­£çš„doFilteræ“ä½œï¼Œä¹Ÿæ˜¯æˆ‘ä»¬åœ¨Springä¸­åˆ›å»ºFilteré€šå¸¸ç»§æ‰¿çš„ã€‚ è€ŒApplicationFilterChainå°±ç®—Tomcatä¸­çš„FilterChainå®ç°ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137 /** * The int which is used to maintain the current position * in the filter chain. */ private int pos = 0; /** * The int which gives the current number of filters in the chain. */ private int n = 0;@Overridepublic void doFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException &#123; //å®‰å…¨ç›¸å…³çš„ï¼Œæš‚ä¸å…³æ³¨ if( Globals.IS_SECURITY_ENABLED ) &#123; final ServletRequest req = request; final ServletResponse res = response; try &#123; java.security.AccessController.doPrivileged( new java.security.PrivilegedExceptionAction&lt;Void&gt;() &#123; @Override public Void run() throws ServletException, IOException &#123; internalDoFilter(req,res); return null; &#125; &#125; ); &#125; catch( PrivilegedActionException pe) &#123; Exception e = pe.getException(); if (e instanceof ServletException) throw (ServletException) e; else if (e instanceof IOException) throw (IOException) e; else if (e instanceof RuntimeException) throw (RuntimeException) e; else throw new ServletException(e.getMessage(), e); &#125; &#125; else &#123; //çœŸæ­£çš„doFilter internalDoFilter(request,response); &#125;&#125;private void internalDoFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException &#123; //pos è°ƒç”¨é“¾ä¸­å½“å‰è¿æ¥ç‚¹æ‰€åœ¨çš„ä½ç½® //n è°ƒç”¨é“¾æ€»èŠ‚ç‚¹é•¿åº¦ // Call the next filter if there is one if (pos &lt; n) &#123; //å¯¹èŠ‚ç‚¹è¿›è¡Œè‡ªå¢ pos++ ApplicationFilterConfig filterConfig = filters[pos++]; try &#123; //å½“å‰èŠ‚ç‚¹å°äºæ€»é•¿åº¦åï¼Œä»filteré…ç½®ç±»ä¸­å–å‡ºfilter Filter filter = filterConfig.getFilter(); if (request.isAsyncSupported() &amp;&amp; "false".equalsIgnoreCase( filterConfig.getFilterDef().getAsyncSupported())) &#123; request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR, Boolean.FALSE); &#125; if( Globals.IS_SECURITY_ENABLED ) &#123; final ServletRequest req = request; final ServletResponse res = response; Principal principal = ((HttpServletRequest) req).getUserPrincipal(); Object[] args = new Object[]&#123;req, res, this&#125;; SecurityUtil.doAsPrivilege ("doFilter", filter, classType, args, principal); &#125; else &#123; //çœŸæ­£çš„filter filter.doFilter(request, response, this); &#125; &#125; catch (IOException | ServletException | RuntimeException e) &#123; throw e; &#125; catch (Throwable e) &#123; e = ExceptionUtils.unwrapInvocationTargetException(e); ExceptionUtils.handleThrowable(e); throw new ServletException(sm.getString("filterChain.filter"), e); &#125; return; &#125; // We fell off the end of the chain -- call the servlet instance //åˆ°äº†è°ƒç”¨é“¾ç»“å°¾å¤„ï¼Œå°±çœŸæ­£è°ƒç”¨servletå®ä¾‹çš„servlet.service(request, response); try &#123; if (ApplicationDispatcher.WRAP_SAME_OBJECT) &#123; lastServicedRequest.set(request); lastServicedResponse.set(response); &#125; if (request.isAsyncSupported() &amp;&amp; !servletSupportsAsync) &#123; request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR, Boolean.FALSE); &#125; // Use potentially wrapped request from this point if ((request instanceof HttpServletRequest) &amp;&amp; (response instanceof HttpServletResponse) &amp;&amp; Globals.IS_SECURITY_ENABLED ) &#123; final ServletRequest req = request; final ServletResponse res = response; Principal principal = ((HttpServletRequest) req).getUserPrincipal(); Object[] args = new Object[]&#123;req, res&#125;; SecurityUtil.doAsPrivilege("service", servlet, classTypeUsedInService, args, principal); &#125; else &#123; servlet.service(request, response); &#125; &#125; catch (IOException | ServletException | RuntimeException e) &#123; throw e; &#125; catch (Throwable e) &#123; e = ExceptionUtils.unwrapInvocationTargetException(e); ExceptionUtils.handleThrowable(e); throw new ServletException(sm.getString("filterChain.servlet"), e); &#125; finally &#123; if (ApplicationDispatcher.WRAP_SAME_OBJECT) &#123; lastServicedRequest.set(null); lastServicedResponse.set(null); &#125; &#125;&#125;/*** Prepare for reuse of the filters and wrapper executed by this chain.* é‡å¤ä½¿ç”¨filterè°ƒç”¨é“¾ï¼Œposé‡è®¾ä¸º0*/void reuse() &#123; pos = 0;&#125; é‡ç‚¹ä»ApplicationFilterChainä¸­æŒ‘å‡ºå‡ ä¸ªé‡è¦çš„æ–¹æ³•æ‹¿å‡ºæ¥åˆ†æä¸‹Filterçš„è°ƒç”¨é“¾ï¼Œå…¶å®è¿˜æœ‰å‡ å¤„æ²¡æœ‰å…·ä½“è®²åˆ°ï¼ŒApplicationFilterChainæ˜¯åˆé€‚åˆ›å»ºçš„ï¼ŒFilteræ˜¯æ€ä¹ˆåŠ å…¥åˆ°ApplicationFilterChainä¸­çš„ã€‚è¿™æ¶‰åŠåˆ°Tomcatæ˜¯æ€æ ·åŠ è½½Contentçš„ï¼Œä¸‹æ¬¡åˆ†æTomcatçš„æ—¶å€™ï¼Œå†æ¥å…·ä½“åˆ†æï¼Œå®ƒæ˜¯å¦‚ä½•è¿ä½œçš„ï¼Œå¦‚ä½•åŠ è½½web.xmlã€‚ å‚è€ƒç»´åŸºçš„è´£ä»»é“¾æ¨¡å¼ è´£ä»»é“¾æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ Filterã€FilterConfigã€FilterChain|èœé¸Ÿæ•™ç¨‹ å—ä¹¡æ¸…æ°´çš„å®é™…é¡¹ç›®è¿ç”¨ä¹‹Responsibility-Chainæ¨¡å¼ ä¸€èµ·å­¦è®¾è®¡æ¨¡å¼ - è´£ä»»é“¾æ¨¡å¼]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>è´£ä»»é“¾</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŠ˜è…¾Javaè®¾è®¡æ¨¡å¼ä¹‹ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2F2018%2F12%2F20%2Fdesign-pattern-strategy%2F</url>
    <content type="text"><![CDATA[ç­–ç•¥æ¨¡å¼ åœ¨ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ä¸­ï¼Œä¸€ä¸ªç±»çš„è¡Œä¸ºæˆ–å…¶ç®—æ³•å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹ã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚ç®€å•ç†è§£å°±æ˜¯ä¸€ç»„ç®—æ³•ï¼Œå¯ä»¥äº’æ¢ï¼Œå†ç®€å•ç‚¹ç­–ç•¥å°±æ˜¯å°è£…ç®—æ³•ã€‚ æ„å›¾ å®šä¹‰ä¸€ç³»åˆ—çš„ç®—æ³•,æŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥, å¹¶ä¸”ä½¿å®ƒä»¬å¯ç›¸äº’æ›¿æ¢ã€‚ ä¸»è¦è§£å†³ åœ¨æœ‰å¤šç§ç®—æ³•ç›¸ä¼¼çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨ ifâ€¦else æ‰€å¸¦æ¥çš„å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚ ä½•æ—¶ä½¿ç”¨ ä¸€ä¸ªç³»ç»Ÿæœ‰è®¸å¤šè®¸å¤šç±»ï¼Œè€ŒåŒºåˆ†å®ƒä»¬çš„åªæ˜¯ä»–ä»¬ç›´æ¥çš„è¡Œä¸ºã€‚ å¦‚ä½•è§£å†³ å°†è¿™äº›ç®—æ³•å°è£…æˆä¸€ä¸ªä¸€ä¸ªçš„ç±»ï¼Œä»»æ„åœ°æ›¿æ¢ã€‚ ä¸»è¦è§’è‰² ä¸Šä¸‹æ–‡Contextï¼Œæ‹¥æœ‰ä¸€ä¸ªStrategyçš„å¼•ç”¨ æŠ½è±¡ç­–ç•¥Strategyï¼Œå¾€å¾€æ˜¯ä¸€ä¸ªæ¥å£(å å¤§éƒ¨åˆ†æƒ…å†µ)æˆ–è€…æŠ½è±¡ç±»ï¼Œé€šå¸¸æä¾›å„ç§å…·ä½“ç­–ç•¥çš„æ¥å£ å…·ä½“ç­–ç•¥ï¼Œè¿™å°±æ˜¯é‡ç‚¹äº†ï¼Œå°è£…äº†å„ç§å…·ä½“çš„ç®—æ³• UML åº”ç”¨å®ä¾‹ è¯¸è‘›äº®çš„é”¦å›Šå¦™è®¡ï¼Œæ¯ä¸€ä¸ªé”¦å›Šå°±æ˜¯ä¸€ä¸ªç­–ç•¥ï¼› æ—…è¡Œçš„å‡ºæ¸¸æ–¹å¼ï¼Œé€‰æ‹©éª‘è‡ªè¡Œè½¦ã€åæ±½è½¦ï¼Œæ¯ä¸€ç§æ—…è¡Œæ–¹å¼éƒ½æ˜¯ä¸€ä¸ªç­–ç•¥ï¼› JAVA AWT ä¸­çš„ LayoutManagerï¼› ä¼˜ç‚¹ 1ã€ç®—æ³•å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ 2ã€é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶åˆ¤æ–­ã€‚ 3ã€æ‰©å±•æ€§è‰¯å¥½ã€‚ ç¼ºç‚¹ 1ã€ç­–ç•¥ç±»ä¼šå¢å¤šã€‚ 2ã€æ‰€æœ‰ç­–ç•¥ç±»éƒ½éœ€è¦å¯¹å¤–æš´éœ²ã€‚ ä½¿ç”¨åœºæ™¯ å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚ æ³¨æ„äº‹é¡¹ï¼š å¦‚æœä¸€ä¸ªç³»ç»Ÿçš„ç­–ç•¥å¤šäºå››ä¸ªï¼Œå°±éœ€è¦è€ƒè™‘ä½¿ç”¨æ··åˆæ¨¡å¼ï¼Œè§£å†³ç­–ç•¥ç±»è†¨èƒ€çš„é—®é¢˜ã€‚ é¡¹ç›®æè¿°è·³è½¬åˆ°æˆ‘çš„ç­–ç•¥æ¨¡å¼GitHub 1.æ“ä½œè¡Œä¸ºsimple1åŒ…ï¼Œä¸»è¦å¯¹æ“ä½œè¡Œä¸ºåŒ…è£…äº†åŠ å‡ä¹˜é™¤æ–¹æ³•ã€‚ 1234567891011121314151617@Slf4jpublic class Application &#123; public static void main(String[] args) &#123; Context context = new Context(new AddStrategy()); log.info("10 + 5 = &#123;&#125;", context.executeStrategy(10, 5)); context.setStrategy(new SubstractStrategy()); log.info("10 - 5 = &#123;&#125;", context.executeStrategy(10, 5)); context.setStrategy(new MultiplyStrategy()); log.info("10 * 5 = &#123;&#125;", context.executeStrategy(10, 5)); context.setStrategy(new DivideStrategy()); log.info("10 / 5 = &#123;&#125;", context.executeStrategy(10, 5)); &#125;&#125; æ‰§è¡Œç»“æœ 2.å‡ºç°æ–¹å¼simple2åŒ…æè¿°ï¼Œä¸»è¦å¯¹å‡ºè¡Œæ–¹å¼çš„åŒ…è£…ï¼ŒåŒ…è£…äº†3ç§å‡ºè¡Œæ–¹å¼ï¼Œ æ‰§è¡Œç±» 12345678910111213public class TravelApplication &#123; public static void main(String[] args) &#123; Context context = new Context(new BusStrategy()); context.executeStrategy("è€ç‹"); context.setStrategy(new BicycleStrategy()); context.executeStrategy("è€å¼ "); context.setStrategy(new WalkStrategy()); context.executeStrategy("è€æ"); &#125;&#125; æ‰§è¡Œç»“æœ ç­–ç•¥ä¸Šä¸‹æ–‡ 12345678910111213141516171819@Datapublic class Context &#123; private Strategy strategy; public Context(Strategy strategy) &#123; this.strategy = strategy; &#125; /** * å‡ºè¡Œ * * @return */ public void executeStrategy(String name) &#123; strategy.travel(name); &#125;&#125; æŠ½è±¡ç­–ç•¥ 123456789public interface Strategy &#123; /** * å‡ºç°æ–¹æ³• * * @return */ void travel(String name);&#125; å‚è€ƒç­–ç•¥æ¨¡å¼|èœé¸Ÿæ•™ç¨‹ ç»´åŸºé‡Œçš„ç­–ç•¥æ¨¡å¼ å—ä¹¡æ¸…æ°´çš„å®é™…é¡¹ç›®è¿ç”¨ä¹‹Strategyæ¨¡å¼]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>ç­–ç•¥</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼æ±‡æ€»]]></title>
    <url>%2F2018%2F12%2F19%2Fdesign-pattern%2F</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼23ç§è®¾è®¡æ¨¡å¼å¤§çº²â€¦ è½¯ä»¶è®¾è®¡æ¨¡å¼åŸåˆ™ æ„å»ºæ¨¡å¼ Builder ï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰ Abstract Factory ï¼ˆæŠ½è±¡å·¥å‚æ¨¡å¼ï¼‰ Factory Method ï¼ˆå·¥å‚æ–¹æ³•ï¼‰ Prototype ï¼ˆåŸå‹æ¨¡å¼ï¼‰ Singleton ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ ç»“æ„æ¨¡å¼ Adapter ï¼ˆé€‚é…å™¨æ¨¡å¼ï¼‰ Bridge ï¼ˆæ¡¥æ¥æ¨¡å¼ï¼‰ Composite ï¼ˆç»„åˆæ¨¡å¼ï¼‰ Decorator ï¼ˆè£…é¥°æ¨¡å¼ï¼‰ Facade ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰ Flyweight ï¼ˆäº«å…ƒæ¨¡å¼ï¼‰ Proxy ï¼ˆä»£ç†æ¨¡å¼ï¼‰ è¡Œä¸ºæ¨¡å¼ Chain of Responsibilityï¼ˆè´£ä»»é“¾æ¨¡å¼ï¼‰ Command ï¼ˆå‘½ä»¤æ¨¡å¼ï¼‰ Interpreter ï¼ˆè§£é‡Šå™¨æ¨¡å¼ï¼‰ Iteratorï¼ˆè¿­ä»£å™¨æ¨¡å¼ï¼‰ Mediatorï¼ˆä¸­ä»‹è€…æ¨¡å¼ï¼‰ Mementoï¼ˆå¤‡å¿˜å½•æ¨¡å¼ï¼‰ Observerï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰ Stateï¼ˆçŠ¶æ€æ¨¡å¼ï¼‰ Strategy (ç­–ç•¥æ¨¡å¼) Template Method ï¼ˆæ¨¡æ¿æ–¹æ³•ï¼‰ Visitorï¼ˆè®¿é—®è€…æ¨¡å¼ï¼‰]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
        <category>æ±‡æ€»</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æµ‹è¯•è¯„è®º]]></title>
    <url>%2F2018%2F12%2F18%2Ftest%2F</url>
    <content type="text"><![CDATA[æµ‹è¯•è¯„è®º]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
</search>
